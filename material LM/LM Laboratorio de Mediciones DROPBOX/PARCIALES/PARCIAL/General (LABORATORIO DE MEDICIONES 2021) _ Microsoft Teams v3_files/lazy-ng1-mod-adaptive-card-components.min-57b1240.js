webpackJsonp([11],{140:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e.Persona="graph.microsoft.com/user",e.PersonaSet="graph.microsoft.com/users"}(t.ComponentName||(t.ComponentName={}));!function(e){e.Compact="compact"}(t.ComponentViewType||(t.ComponentViewType={})),t.isPersonaProperties=function(e){return void 0!==e.userPrincipalName},t.isPersonaSetProperties=function(e){return void 0!==e.users}},2707:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(322),n(323),n(325),n(324),n(58),n(326),n(328),n(329),n(330),n(331),n(332),n(44)},2708:function(e,t){e.exports='<div class="ts-adaptive-card card-acc-border" ng-click="ctrl.onCardClicked()" data-tid="{{::ctrl.dateTid}}" tabindex="-1" track-click-silent="true" do-not-decorate-click-for-acc>\n\n  <div style="position:relative;">\n    \x3c!--\n      Additional layer of wrapper element for card border is required for card copy & paste\n      (If border is at the most top level, pasting would be broken in OWA)\n    --\x3e\n    <div class="card-border-placeholder">\n      <div class="card-header" ng-show="!ctrl.showCardOverflowActions">\n        \x3c!-- App attribution --\x3e\n        <div class="card-app-attribution"></div>\n\n        <div class="card-header-buttons">\n          \x3c!-- Collapse button --\x3e\n          <button class="hide ts-sym card-collapse app-icons-fill-hover" tabindex="-1">\n            <ng-include src="\'svg/icons-collapse.html\'"></ng-include>\n          </button>\n\n          \x3c!-- Close button --\x3e\n          <button class="hide ts-sym card-close app-icons-fill-hover" tabindex="-1">\n            <ng-include src="\'svg/icons-close.html\'"></ng-include>\n          </button>\n\n          \x3c!-- Copy button --\x3e\n          <button class="hide ts-sym power-bar-card-copy app-icons-fill-hover" tabindex="-1">\n            <ng-include src="\'svg/icons-copy.html\'"></ng-include>\n          </button>\n\n          \x3c!-- Header button --\x3e\n          <button class="ts-sym card-header-button card-header app-icons-fill-hover focus-round-border" tabindex="-1" title="{{ctrl.cardHeaderTitle}}" ng-if="ctrl.showCardHeader" ng-click="ctrl.handleCardHeaderMenu($event)">\n            <ng-include src="\'svg/icons-more.html\'"></ng-include>\n          </button>\n          \x3c!-- Refresh button --\x3e\n          <button class="ts-sym icons card-refresh" tabindex="0" ng-click="ctrl.handleRefreshButtonClick($event)" ng-if="ctrl.showRefreshButtonInAdaptiveCard" aria-label="{{::$root.resources.strings.icons_refresh|translate}}" title="{{::$root.resources.strings.icons_refresh|translate}}">\n              <ng-include src="\'svg/icons-refresh.html\'"></ng-include>\n          </button>\n        </div>\n      </div>\n      <div class="card-overflow-actions" ng-if="ctrl.showCardOverflowActions">\n        <div class="card-overflow-buttons">\n          \x3c!-- Overflow action button --\x3e\n          <button class="ts-sym card-overflow-button card-overflow-actions app-icons-fill-hover focus-round-border" tabindex="-1" title="{{ctrl.cardHeaderTitle}}" ng-click="ctrl.handleOverflowActionsMenu($event)">\n            <ng-include src="\'svg/icons-more.html\'"></ng-include>\n          </button>\n        </div>\n      </div>\n\n      \x3c!-- Adaptive card body --\x3e\n      <div class="card-body"></div>\n\n      \x3c!-- Feedback --\x3e\n      <div class="action-feedback">\n        <ng-include src="\'svg/icons-error-small.html\'" class="error-icon"></ng-include>\n        <span class="error-text feedback-text" ng-non-bindable></span>\n        <button class="ts-sym app-icons-fill-hover close-button" tabindex="-1" ng-click="ctrl.showFeedback = false">\n          <ng-include src="\'svg/icons-close.html\'"></ng-include>\n        </button>\n      </div>\n    </div>\n    <div class="ngdialog-overlay ac-overlay" ng-show="ctrl.isCardRefreshing">\n      <busy-animation size="small" style="margin: 0;"></busy-animation>\n    </div>\n  </div>\n</div>\n'},2709:function(e,t){e.exports='<div class="card-header-menu popover minwidth-sm maxwidth-common app-default-menu" data-tid="cardHeaderMenu" ng-keydown="ctrl.handleMenuKeyDown($event)" id="cardHeaderMenu">\n     <div class="scroll-container">\n      <div class="simple-scrollbar" simple-scrollbar>\n        <div>\n          <ul acc-role="menu" class="app-default-menu-ul">\n            <li class="card-header-menu-items">\n              <button tabindex="-1" ng-if="ctrl.showRefreshButtonInCardHeader" ng-click="ctrl.handleRefreshButtonClick($event)" class="ts-sym card-header-button" title="{{::$root.resources.strings.messages_refresh|translate}}" acc-role="menu-item focus-default" do-not-decorate-click-for-acc>\n                <ng-include src="\'svg/icons-recurrence.html\'"></ng-include>\n                <span class="ts-popover-label" translate-once="{{::$root.resources.strings.messages_refresh}}"></span>\n             </button>\n              <button tabindex="-1" ng-if="!ctrl.disableCardCopy" ng-click="ctrl.handleOnCopy($event)" class="ts-sym card-header-button" title="{{::$root.resources.strings.icons_copy|translate}}" acc-role="menu-item focus-default" do-not-decorate-click-for-acc>\n                <ng-include src="\'svg/icons-copy.html\'"></ng-include>\n                <span class="ts-popover-label" translate-once="{{::$root.resources.strings.botcards_card_header_menu_copy_option}}"></span>\n             </button>\n             <button tabindex="-1" ng-click="ctrl.handleAppInstall($event)" class="ts-sym card-header-button" ng-if="ctrl.showAppDetails" title="{{::$root.resources.strings.icons_apps|translate}}" acc-role="menu-item focus-default" do-not-decorate-click-for-acc>\n              <ng-include src="\'svg/icons-apps.html\'"></ng-include>\n              <span class="ts-popover-label" translate-once="{{::$root.resources.strings.botcards_card_header_menu_app_details_option}}"></span>\n            </button>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n</div>'},2710:function(e,t){e.exports='<div class="card-overflow-menu popover minwidth-sm maxwidth-common app-default-menu" data-tid="cardOverflowMenu" ng-keydown="ctrl.handleMenuKeyDown($event)" id="cardOverflowMenu">\n     <div class="scroll-container">\n      <div class="simple-scrollbar" simple-scrollbar>\n        <div>\n          <ul acc-role="menu" class="app-default-menu-ul">\n              <li class="card-overflow-menu-items" ng-repeat="action in ctrl.overflowActions">\n                <button tabindex="-1" ng-click="ctrl.handleOnExecuteAction(action)" class="ts-sym card-overflow-button" title="{{::action.title}}" acc-role="menu-item focus-default" do-not-decorate-click-for-acc>\n                  <img ng-src="{{::action.iconUrl}}" class="card-overflow-icon" ng-if="::!ctrl.isPinTabAction(action)"/>\n                  <ng-include src="svg/icons-compose-extension-pin.html" class="card-overflow-icon" ng-if="::ctrl.isPinTabAction(action)"></ng-include>\n                  <span class="ts-popover-label" translate-once="{{::action.title}}"></span>\n              </button>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n</div>\n'},2711:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(2712))},2712:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=n(140),o=n(2713),s=n(2714),c=function(e){function t(t,n,r,i,o,s,c,l,p,d,u,h,m){var f=e.call(this)||this;return f.eventingService=t,f.messagingTelemetryService=n,f.peopleService=r,f.tooltipService=i,f.tooltipCssApplicators=o,f.constants=s,f.$timeout=c,f.$compile=l,f.$scope=p,f.$translate=d,f.resources=u,f.loggingService=h,f.featureEnablingMap={},f.waitForMessageListRenderedComponents=[a.ComponentName.Persona,a.ComponentName.PersonaSet],f.featureEnablingMap[a.ComponentName.Persona]=m.valueAsBoolean(s.settings.names.enableAdaptiveCardPersona),f.featureEnablingMap[a.ComponentName.PersonaSet]=m.valueAsBoolean(s.settings.names.enableAdaptiveCardPersonaSet),f}return r(t,e),t.prototype.internalRender=function(){var e=this,t=this.getPlaceholderComponent();return this.featureEnablingMap[this.componentName]&&this.waitForChannelSwitch().then(function(){return e.loadComponent()}),this.componentElement=document.createElement("div"),t&&this.componentElement.append(t),this.componentElement},t.prototype.getJsonTypeName=function(){return this.component&&this.component.getJsonTypeName?this.component.getJsonTypeName():"Component"},t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.componentName=t.name,this.componentPayload=t},t.prototype.getPlaceholderComponent=function(){var e=document.createElement("div");switch(this.componentName&&this.componentName.toLowerCase()){case a.ComponentName.Persona:case a.ComponentName.PersonaSet:e.style.height="20px"}return e},t.prototype.loadComponent=function(){var e=this;switch(this.componentName&&this.componentName.toLowerCase()){case a.ComponentName.Persona:this.component=new o.Persona(this.componentPayload,function(t){return e.renderAfterLoaded(t)},this.peopleService,this.$scope.$new(),this.$compile,this.loggingService,this.constants);break;case a.ComponentName.PersonaSet:this.component=new s.PersonaSet(this.componentPayload,function(t){return e.renderAfterLoaded(t)},this.peopleService,this.tooltipService,this.tooltipCssApplicators,this.constants,this.$timeout,this.$scope.$new(),this.$translate,this.resources,this.$compile,this.loggingService);break;default:this.component=null}},t.prototype.renderAfterLoaded=function(e){$(this.componentElement).empty().append(e)},t.prototype.waitForChannelSwitch=function(){var e=this;return new Promise(function(t){var n=e.waitForMessageListRenderedComponents.indexOf(e.componentName)>-1;if(e.messagingTelemetryService.activeChannelSwitchScenario&&n)var r=e.eventingService.$on(e.$scope,e.constants.events.messages.messageListRenderStateChanged,function(e,n){n.state>=teamspace.components.MessageListRenderState.Rendered&&(r&&r(),t())});else t()})},t}(i.CardElement);t.Component=c},2713:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(327),i=n(140),a=function(){function e(e,t,n,r,i,a,o){this.payload=e,this.renderAfterLoadedCallback=t,this.peopleService=n,this.$scope=r,this.$compile=i,this.loggingService=a,this.constants=o,this.render()}return e.prototype.getJsonTypeName=function(){return"Persona"},e.prototype.render=function(){if(this.payload){var e=this.payload.properties;if(e&&i.isPersonaProperties(e)&&(e.userPrincipalName||e.displayName)){var t=e.userPrincipalName,n=e.displayName;this.loadPeopleDisplayName(t,n)}}},e.prototype.loadPeopleDisplayName=function(e,t){var n=this,r=this.loggingService.newScenario(this.constants.scenarios.extensibility.bots.adaptiveCardComponent.personaLoadUserProfile);this.peopleService.getPeopleProfileFromAAD(e,"adaptive card persona",!0).then(function(i){n.persona={upn:e,displayName:i.displayName||t},r.stop()}).catch(function(){n.persona={upn:e,displayName:t},r.fail({error:"failed to fetch user profile"})}).finally(function(){n.renderAfterLoaded()})},e.prototype.renderAfterLoaded=function(){var e,t=this.payload.view;switch(this.$scope.persona=this.persona,"string"==typeof t?t.toLowerCase():t){case i.ComponentViewType.Compact:default:e=r.AdaptiveCardComponentUtils.getPersonaCompactHtmlString(!0)}this.renderAfterLoadedCallback(this.$compile(e)(this.$scope)[0])},e}();t.Persona=a},2714:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(327),i=n(140),a=function(){function e(e,t,n,r,i,a,o,s,c,l,p,d){this.payload=e,this.renderAfterLoadedCallback=t,this.peopleService=n,this.tooltipService=r,this.tooltipCssApplicators=i,this.constants=a,this.$timeout=o,this.$scope=s,this.$translate=c,this.resources=l,this.$compile=p,this.loggingService=d,this.render()}return e.prototype.getJsonTypeName=function(){return"PersonaSet"},e.prototype.render=function(){if(this.payload){var e=this.payload.properties;if(e&&i.isPersonaSetProperties(e)&&e.users&&e.users.length){var t=e.users.filter(function(e){return e.userPrincipalName||e.displayName});t.length&&this.loadPeopleDisplayNames(t)}}},e.prototype.morePersonasIconMouseenterHandler=function(e){var t=this;this.$timeout.cancel(this.timer),this.isMorePersonasIconHovered=!0,this.isMorePersonasListVisible||(this.timer=this.$timeout(function(){var n={templateUrl:"components/threads/thread/cards/adaptive-card-more-personas-list.html",trigger:"manual",container:"body",scope:t.$scope,autoClose:!0,placement:"right",onHide:function(){t.isMorePersonasListVisible=!1}},r={sourceElement:$(e.target),tooltipType:teamspace.services.TooltipType.Popover,options:n,tooltipId:"adaptiveCardMorePersonasTooltip",cssApplicator:function(){t.tooltipCssApplicators.contextMenu(e)}};t.tooltipService.showTooltip(r),t.isMorePersonasListVisible=!0},200,!1))},e.prototype.morePersonasIconMouseleaveHandler=function(){var e=this;this.$timeout.cancel(this.timer),this.isMorePersonasIconHovered=!1,this.timer=this.$timeout(function(){e.isMorePersonasListHovered||e.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,"adaptiveCardMorePersonasTooltip")},500,!1)},e.prototype.morePersonasListMouseenterHandler=function(){this.$timeout.cancel(this.timer),this.isMorePersonasListHovered=!0},e.prototype.morePersonasListMouseleaveHandler=function(){var e=this;this.$timeout.cancel(this.timer),this.isMorePersonasListHovered=!1,this.timer=this.$timeout(function(){e.isMorePersonasIconHovered||e.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,"adaptiveCardMorePersonasTooltip")},500,!1)},e.prototype.morePersonasIconKeydownHandler=function(e){var t=e.keyCode;t!==this.constants.keyCodes.space&&t!==this.constants.keyCodes.enter||this.morePersonasIconMouseenterHandler(e)},e.prototype.loadPeopleDisplayNames=function(e){var t=this,n=_.map(e,function(e){return e.userPrincipalName}),r=this.loggingService.newScenario(this.constants.scenarios.extensibility.bots.adaptiveCardComponent.personaSetLoadUserProfiles);this.peopleService.getAllShortPeopleProfileFromAAD(n,"adaptive card persona set",!0).then(function(n){var i={};_.each(n,function(e){i[e.userPrincipalName]=e.displayName}),t.personas=_.map(e,function(e){return{upn:e.userPrincipalName,displayName:i[e.userPrincipalName]||e.displayName}}),r.stop()}).catch(function(){t.personas=_.map(e,function(e){return{upn:e.userPrincipalName,displayName:e.displayName}}),r.fail({error:"failed to fetch user profiles"})}).finally(function(){t.renderAfterLoaded()})},e.prototype.renderAfterLoaded=function(){var e=4,t="";if(this.personas.length>4){e=3;var n=this.personas.length-4+1;t=1===n?this.$translate.instant(this.resources.strings.botcards_adaptiveCard_more_personas_icon_aria_label_single):this.$translate.instant(this.resources.strings.botcards_adaptiveCard_more_personas_icon_aria_label_multiple,{morePersonasCount:n})}1===this.personas.length?this.$scope.persona=this.personas[0]:this.$scope.personas=this.personas,this.$scope.morePersonas=this.personas.slice(e),this.$scope.ctrl=this;var a,o=this.payload.view;switch("string"==typeof o?o.toLowerCase():o){case i.ComponentViewType.Compact:default:a=r.AdaptiveCardComponentUtils.getPersonaSetCompactHtmlString(this.personas,4,t)}this.renderAfterLoadedCallback(this.$compile(a)(this.$scope)[0])},e}();t.PersonaSet=a},2715:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=n(44),o=function(e){function t(t,n,r,i,a,o,s,c){var l=e.call(this)||this;return l.constants=t,l.enableExpandingImagesInAdaptiveCards=n,l.enlargeImageLabel=r,l.htmlSanitizer=i,l.settingsService=a,l.amsUrlService=o,l.utilityService=s,l.logger=c,l}return r(t,e),t.prototype.internalRender=function(){var t=e.prototype.internalRender.call(this);return a.AdaptiveCardHelper.addImagePostProcessingForImages(this.constants,[this.isAllowImageExpand],this.enlargeImageLabel,this.htmlSanitizer,t,this.settingsService,this.amsUrlService,this.utilityService,this.logger),t},t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.isAllowImageExpand=this.enableExpandingImagesInAdaptiveCards&&t&&t.msTeams&&t.msTeams.allowExpand},t}(i.Image);t.Image=o},2716:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=n(44),o=function(e){function t(t,n,r,i,a,o,s,c){var l=e.call(this)||this;return l.constants=t,l.enableExpandingImagesInAdaptiveCards=n,l.enlargeImageLabel=r,l.htmlSanitizer=i,l.settingsService=a,l.amsUrlService=o,l.utilityService=s,l.logger=c,l.isAllowImagesToExpand=[],l}return r(t,e),t.prototype.internalRender=function(){var t=e.prototype.internalRender.call(this);return a.AdaptiveCardHelper.addImagePostProcessingForImages(this.constants,this.isAllowImagesToExpand,this.enlargeImageLabel,this.htmlSanitizer,t,this.settingsService,this.amsUrlService,this.utilityService,this.logger),t},t.prototype.parse=function(t){var n=this;e.prototype.parse.call(this,t),this.enableExpandingImagesInAdaptiveCards&&t&&t.images&&t.images.forEach(function(e){e.msTeams&&e.msTeams.allowExpand?n.isAllowImagesToExpand.push(!0):n.isAllowImagesToExpand.push(!1)})},t}(i.ImageSet);t.ImageSet=o},2717:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n,r,i,a,o){this.$compile=e,this.$scope=t,this.inputElement=n,this.visibleSvgHtml=r.trustAsHtml(i.get("svg/icons-show-input.html")),this.maskedSvgHtml=r.trustAsHtml(i.get("svg/icons-hide-input.html")),this.hideLabel=a.instant(o.strings.botcards_adaptiveCard_password_input_icon_hide_aria_label),this.revealLabel=a.instant(o.strings.botcards_adaptiveCard_password_input_icon_reveal_aria_label)}return e.prototype.internalRender=function(){this.inputType="password",this.inputElement.setAttribute("autocomplete","off"),this.$scope.ctrl=this;var e=angular.element(this.getIconElement());return this.$compile(e)(this.$scope),e.prepend(this.inputElement),e[0]},Object.defineProperty(e.prototype,"icon",{get:function(){return"text"===this.inputType?this.visibleSvgHtml:this.maskedSvgHtml},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputType",{get:function(){return this.inputElement.getAttribute("type")},set:function(e){this.inputElement.setAttribute("type",e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buttonLabel",{get:function(){return"text"===this.inputType?this.hideLabel:this.revealLabel},enumerable:!0,configurable:!0}),e.prototype.getIconElement=function(){var e=angular.element("<div />");e.attr("class","password-input-reveal");var t=angular.element("<button />");t.attr("aria-label","{{ctrl.buttonLabel}}"),t.attr("class","btn btn-default app-icons-fill-hover"),t.attr("ng-click","ctrl.toggleReveal()");var n=angular.element('<ng-bind-html ng-bind-html="ctrl.icon"></ng-bind-html>');return t.append(n),e.append(t),e},e.prototype.toggleReveal=function(){this.inputType="text"===this.inputType?"password":"text"},e}();t.TextInputPassword=r},2718:function(e,t){e.exports='<div class="ac-people-picker">\n  <div class="ts-select-people">\n    <recipient-line class="ts-teammates" placeholder="{{::placeholder}}" recipients="selections" type="search" picker-usage-area="AdaptiveCard" aria-labelledby="tag-add-members-label" show-logged-in-user="true" use-people-provider="acPpCtrl.directorySearchMode !== 2" people-provider="acPpCtrl.fetchAllowedUsers(filter)" people-picker-filters="{{acPpCtrl.peoplePickerFilterScenario}}" people-picker-filters-for-initial-search="{{acPpCtrl.peoplePickerFilterScenario}}" people-picker-filters-for-subsequent-search="{{acPpCtrl.peoplePickerFilterScenario}}" choices="acPpCtrl.choices" filter-selected-contacts="true">\n    </recipient-line>\n  </div>\n</div>'},2719:function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(93)),r(n(2720))},2720:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__decorate||function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=n(2721),c=n(93),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"refresh",{get:function(){return this.getValue(t.refreshProperty)},set:function(e){this.setValue(t.refreshProperty,e),e&&(e.parent=this)},enumerable:!0,configurable:!0}),t.prototype.getSchemaKey=function(){return"AdaptiveAppletCard"},t.initialize=function(){o.GlobalRegistry.actions.register(c.ACTION_EXECUTE_TYPE,c.ExecuteAction)},t.cleanup=function(){o.GlobalRegistry.actions.unregister(c.ACTION_EXECUTE_TYPE)},t.refreshProperty=new o.SerializableObjectProperty(o.Versions.v1_0,"refresh",s.RefreshDefinition),i([o.property(t.refreshProperty),a("design:type",s.RefreshDefinition),a("design:paramtypes",[s.RefreshDefinition])],t.prototype,"refresh",null),t}(o.AdaptiveCard);t.AdaptiveAppletCard=l},2721:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__decorate||function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=n(93),c=n(2722),l=n(2723),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"action",{get:function(){return this.getValue(t.actionProperty)},set:function(e){this.setValue(t.actionProperty,e),e.setParent(this.parent)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userIds",{get:function(){return this.getValue(t.userIdsProperty)},set:function(e){this.setValue(t.userIdsProperty,e)},enumerable:!0,configurable:!0}),t.prototype.getSchemaKey=function(){return"RefreshDefinition"},t.actionProperty=new c.RefreshActionProperty(o.Versions.v1_0,"action"),t.userIdsProperty=new l.RefreshUserIdsProperty(o.Versions.v1_0,"userIds"),i([o.property(t.actionProperty),a("design:type",s.ExecuteAction),a("design:paramtypes",[s.ExecuteAction])],t.prototype,"action",null),i([o.property(t.userIdsProperty),a("design:type",Array),a("design:paramtypes",[Array])],t.prototype,"userIds",null),t}(o.SerializableObject);t.RefreshDefinition=p},2722:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=n(93),o=function(e){function t(t,n){var r=e.call(this,t,n,void 0)||this;return r.targetVersion=t,r.name=n,r}return r(t,e),t.prototype.parse=function(e,t,n){var r=n.parseAction(e.parent,t[this.name],[],!1);return r&&r instanceof a.ExecuteAction?r:void n.logParseEvent(e,i.ValidationEvent.ActionTypeNotAllowed,'The "refresh" property must have its "action" field defined set to an Action.Execute object')},t.prototype.toJSON=function(e,t,n,r){r.serializeValue(t,this.name,n?n.toJSON(r):void 0)},t}(i.PropertyDefinition);t.RefreshActionProperty=o},2723:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=function(e){function t(t,n){var r=e.call(this,t,n,void 0)||this;return r.targetVersion=t,r.name=n,r}return r(t,e),t.prototype.parse=function(e,t,n){var r=t[this.name];if(r)return r instanceof Array&&r.reduce(function(e,t){return e&&"string"==typeof t},!0)?r:void n.logParseEvent(e,i.ValidationEvent.InvalidPropertyValue,'The "refresh" property must have optional its "userIds" field if defined, set to an array of strings')},t.prototype.toJSON=function(e,t,n,r){r.serializeValue(t,this.name,n)},t}(i.PropertyDefinition);t.RefreshUserIdsProperty=a},322:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},a=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r};Object.defineProperty(t,"__esModule",{value:!0});var s,c=n(34),l=n(12),p=n(2708),d=n(2709),u=n(2710),h=n(7),m=n(71),f=n(44),v=n(180),g=n(113),y=n(2719);!function(e){e.None="none",e.Manual="manual",e.Auto="automatic"}(s=t.CardRefreshType||(t.CardRefreshType={}));var b;!function(e){e[e.SHOW=0]="SHOW",e[e.HIDE=1]="HIDE",e[e.IN_PROGRESS=2]="IN_PROGRESS",e[e.COMPLETE=3]="COMPLETE"}(b||(b={}));var C=function(e){function t(t,n,r,i,a,o,s,c,l,p,d,u,m,f,v,g,C,S,A,x,w,I,P,k,E,$,T,O,R,M,H,B,D){var L=e.call(this,t,n,r,i,R)||this;return L.$scope=i,L.$element=a,L.$compile=o,L.$window=s,L.$translate=c,L.$templateCache=l,L.$timeout=p,L.constants=d,L.localizationService=u,L.ariaLiveService=m,L.eventingService=f,L.botCardFactory=v,L.htmlSanitizer=g,L.resources=C,L.loggingService=S,L.utilityService=A,L.peopleService=x,L.settingsService=w,L.tooltipService=I,L.tooltipCssApplicators=P,L.appsService=k,L.dialogService=E,L.semanticObjectService=$,L.htmlMessageBodyAdapterService=T,L.messagingTelemetryService=O,L.conversationsService=M,L.$q=H,L.amsUrlService=B,L.routeUtilityService=D,L.cardHeaderTitle="",L.overflowActions=[],L.showCardOverflowActions=!1,L.isCardRefreshing=!1,L.disableCardCopy=!1,L.cardBodyClass="card-body",L.cardBorderClass="card-border",L.cardRefreshClass="card-refresh",L.cardResponsiveWidthClass="adaptive-card-responsive",L.cardFullWidthClass="adaptive-card-fullwidth",L.cardErrorClass="error",L.cardInfoClass="info",L.clientObservers={},L.refreshButtonState=b.HIDE,L.defaultFontSizeAndFontWeightPayload={fontFamily:'"Segoe UI", "Helvetica Neue", "Apple Color Emoji", "Segoe UI Emoji", Helvetica, Arial, sans-serif',fontSizes:{small:12,default:14,medium:14,large:18,extraLarge:24},fontWeights:{lighter:300,default:400,bolder:600}},L.userCountInConversation=-1,L.processMarkDown=function(e,t){var n;n=L.enableSharedMarkdownInstance?L.botCardService.processMarkdown(e):L.markdownIt.render(e),L.isAtMentionsEnabledInAdaptiveCards&&(n=L.populateAtMentionsSemanticObjects(e,n));var r=L.htmlSanitizer.sanitizeHtml(n);return t.didProcess=!0,t.outputHtml=r,r},L.mergePayload=function(e,t){var n=_.cloneDeep(e);delete n[L.constants.bots.cards.adaptiveCard.teamsActionWrapperName];try{var r=_.isString(t)?JSON.parse(t):t;r instanceof Object&&!(r instanceof Array)?n=_.defaults(n,r):L.logger.error("invoke payload must be an object (and array is not supported). Will ignore.")}catch(e){L.logger.error("embeddedActionValue must be either a JSON object OR stringified JSON")}return JSON.stringify(n)},L.logger=S.newLogger("AdaptiveCardController"),L.objectId=A.generateUUIDNormalized(),L.cardHeaderMenuId=A.generateUUID(),L.cardHeaderTitle=c.instant(C.strings.botcards_card_header_menu_more_options),L.acSerializationContext=new h.SerializationContext,i.onReady&&L.subscribe("onReady",i.onReady),i.onWillExecuteAction&&L.subscribe("onWillExecuteAction",i.onWillExecuteAction),i.onDidExecuteAction&&L.subscribe("onDidExecuteAction",i.onDidExecuteAction),i.onPostProcessingStyling&&L.subscribe("onPostProcessingStyling",i.onPostProcessingStyling),i.onCopy&&L.subscribe("onCopy",i.onCopy),i.onPreInit&&L.subscribe("onPreInit",i.onPreInit),f.$on(i,d.events.layout.themeChanged,function(e){return L.setupHostConfig(!0)}),L.cardEventHandler=function(e,t){L.handleCardEvent(e,t)},L.card&&L.card.subscribeForChanges(L.cardEventHandler),L.enlargeImageLabel=c.instant(C.strings.botcards_enlarge_image),L.enableExpandingImagesInAdaptiveCards=w.valueAsBoolean(d.settings.names.enableExpandingImagesInAdaptiveCards),L.isAtMentionsEnabledInAdaptiveCards=w.valueAsBoolean(d.settings.names.enableAtMentionsAdaptiveCardsMessaging),L.shouldDisableRerenderingForAdaptiveCards=w.valueAsBoolean(d.settings.names.disableRerenderingForAdaptiveCards),L.emailCardImprovementsEnabled=w.valueAsBoolean(d.settings.names.enableEmailAdaptiveCardImprovements),L.emailCardHackEnabled=w.valueAsBoolean(d.settings.names.enableEmailAdaptiveCardHack),L.variableCardWidthEnabled=w.valueAsBoolean(d.settings.names.enableAdaptiveCardVariableWidth),L.enableSharedMarkdownInstance=w.valueAsBoolean(d.settings.names.enableSharedMarkdownInstance),L.enableACv2RefreshButtonInMessageActionsMenu=w.valueAsBoolean(d.settings.names.enableACv2RefreshButtonInMessageActionsMenu),L.enableActionExecuteFromInputExtension=w.valueAsBoolean(d.settings.names.enableActionExecuteFromInputExtension),L.initializeMarkdownLibrary(),h.GlobalSettings.useMarkdownInRadioButtonAndCheckbox=!1,h.AdaptiveCard.onProcessMarkdown=L.processMarkDown,i.$on("$destroy",function(){L.card&&L.card.unsubscribeForChanges(L.cardEventHandler),L.updateRefreshButtonState(b.HIDE)}),L.card&&L.isActionExecuteEnabledForCard()&&y.AdaptiveAppletCard.initialize(),f.$on(i,d.events.bots.adaptiveCard.cardUpdate,function(e,t){return L.handleCardUpdate(t)}),f.$on(i,d.events.bots.adaptiveCard.triggerCardRefresh,function(e,t){return L.handleCardRefreshEvent(t)}),L}return r(t,e),t.$inject=["botCardService","uiOrchestrator","$sce","$scope","$element","$compile","$window","$translate","$templateCache","$timeout","constants","localizationService","ariaLiveService","eventingService","botCardFactory","htmlSanitizer","resources","loggingService","utilityService","peopleService","settingsService","tooltipService","tooltipCssApplicators","appsService","dialogService","semanticObjectService","htmlMessageBodyAdapterService","messagingTelemetryService","mruServiceV2","conversationsService","$q","amsUrlService","routeUtilityService"],Object.defineProperty(t.prototype,"adaptiveCardObject",{get:function(){return this.adaptiveCard},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"adaptiveCardElement",{get:function(){return this.$element.find("."+this.cardBodyClass)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"adaptiveCardRefreshElement",{get:function(){return this.$element.find("."+this.cardRefreshClass)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cardContentElement",{get:function(){return this.$element.find(".ts-adaptive-card")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cardBorderElement",{get:function(){return this.cardContentElement.find(".card-border-placeholder")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"appAttributionElement",{get:function(){return this.cardContentElement.find(".card-app-attribution")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cardCopyElement",{get:function(){return this.$element.find(".power-bar-card-copy")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cardCloseElement",{get:function(){return this.$element.find(".card-close")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cardHeaderElement",{get:function(){return this.$element.find(".card-header")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cardOverflowActionsElement",{get:function(){return this.$element.find(".card-overflow-actions")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cardCollapseElement",{get:function(){return this.$element.find(".card-collapse")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actionFeedbackElement",{get:function(){return this.$element.find(".action-feedback")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorMessageElement",{get:function(){return this.$element.find(".error-text")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRefreshButtonVisible",{get:function(){return this.refreshButtonState!==b.HIDE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorIconElement",{get:function(){return this.$element.find(".error-icon")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"feedbackMessageElement",{get:function(){return this.$element.find(".feedback-text")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showRefreshButtonInAdaptiveCard",{get:function(){return this.isRefreshButtonVisible&&this.card.isBotCard&&!this.enableACv2RefreshButtonInMessageActionsMenu},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showRefreshButtonInCardHeader",{get:function(){return this.isRefreshButtonVisible&&this.card.isInputExtension},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"popupContainerSelector",{get:function(){return this.$scope.popupContainerSelector?this.$scope.popupContainerSelector:this.$scope.threadId?"#"+teamspace.services.MessagingUtilities.getFormattedThreadId(this.$scope.threadId):"[data-tid='"+this.dateTid+"']"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dateTid",{get:function(){return"ts-adaptive-card-"+this.objectId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"payload",{get:function(){return this.card.content},set:function(e){this.cardViewModel=this.botCardFactory.createCard({content:e,contentType:this.constants.bots.cards.types.adaptive},null,null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cardViewModel",{get:function(){return this.card},set:function(e){this.card.unsubscribeForChanges(this.cardEventHandler),this.card=e,this.card.subscribeForChanges(this.cardEventHandler),this.initAdaptiveCard(),this.render()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showCardBorder",{get:function(){return this.cardBorderElement.hasClass(this.cardBorderClass)},set:function(e){e!==this.showCardBorder&&(e?this.cardBorderElement.addClass(this.cardBorderClass):this.cardBorderElement.removeClass(this.cardBorderClass))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cardBorderTopColor",{get:function(){return this.cardBorderElement[0].style.borderTopColor},set:function(e){this.cardBorderElement[0].style.borderTopColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showCardHeader",{get:function(){return this.canShowCardHeader(this.card)&&!this.showCardOverflowActions&&this.settingsService.valueAsBoolean(this.constants.settings.names.enableCardHeaderButton)&&this.isAnyCardHeaderActionVisible()&&!this.$scope.inCompose},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cardBorderColor",{get:function(){return this.cardBorderElement[0].style.borderColor},set:function(e){this.cardBorderElement[0].style.borderColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showCopy",{get:function(){return!this.cardCopyElement.hasClass("hide")},set:function(e){e!==this.showCopy&&(e?this.cardCopyElement.removeClass("hide"):this.cardCopyElement.addClass("hide"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showCardClose",{get:function(){return!this.cardCloseElement.hasClass("hide")},set:function(e){e!==this.showCardClose&&(e?this.cardCloseElement.removeClass("hide"):this.cardCloseElement.addClass("hide"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showCardCollapse",{get:function(){return!this.cardCollapseElement.hasClass("hide")},set:function(e){e!==this.showCardCollapse&&(e?this.cardCollapseElement.removeClass("hide"):this.cardCollapseElement.addClass("hide"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showFeedback",{get:function(){return!this.actionFeedbackElement.hasClass("hide")},set:function(e){e!==this.showFeedback&&(e?this.actionFeedbackElement.removeClass("hide"):this.actionFeedbackElement.addClass("hide"),!e&&this.resetFeedbackContainerClasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorMessageText",{get:function(){return this.errorMessageElement.text()},set:function(e){this.errorMessageElement.text(e),!!e&&(this.showErrorIcon=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actionFeedbackType",{set:function(e){switch(e){case teamspace.services.CardMessageType.info:this.actionFeedbackElement.addClass(this.cardInfoClass);break;case teamspace.services.CardMessageType.error:this.actionFeedbackElement.addClass(this.cardErrorClass)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showErrorIcon",{get:function(){return!this.errorIconElement.hasClass("hide")},set:function(e){e!==this.showErrorIcon&&(e?this.errorIconElement.removeClass("hide"):this.errorIconElement.addClass("hide"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"feedbackMessageText",{set:function(e){this.feedbackMessageElement.text(e),!!e&&(this.showErrorIcon=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useDefaultResponsiveCardWidth",{get:function(){return this.cardContentElement.hasClass(this.cardResponsiveWidthClass)},set:function(e){e!==this.useDefaultResponsiveCardWidth&&(e?this.cardContentElement.addClass(this.cardResponsiveWidthClass):this.cardContentElement.removeClass(this.cardResponsiveWidthClass))},enumerable:!0,configurable:!0}),t.prototype.onCardClicked=function(){for(var e=$(".ts-adaptive-card.dropdown-menu"),t=0;t<e.length;t++){var n=e.get(t);"visible"===n.style.visibility&&(this.$scope.$broadcast(this.constants.events.adaptiveCard.dismissDropdown),n.style.visibility="hidden")}},t.prototype.handleAppInstall=function(e){this.openAppInstallDialog(this.card,"adaptive-card",this.constants,this.dialogService,this.loggingService,e),this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,this.cardHeaderMenuId)},t.prototype.handleOnCopy=function(e){var t=this.loggingService.newScenario(this.constants.scenarios.extensibility.inputExtension.cardHeaderCopy);try{this.clientObservers.onCopy&&this.clientObservers.onCopy({$ctrl:this,$event:e}),this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,this.cardHeaderMenuId),t.stop()}catch(e){t.fail({appId:this.card.appId,error:l.ErrorUtility.format(e)})}this.botCardService.logTelemetryForCardHeaderCopy(this.card)},t.prototype.handleCardHeaderMenu=function(e){this.openCardHeaderMenu(this.card,"lazy-components/adaptive-card/card-header-menu.html",e,this.$timeout,this.$scope,this.cardHeaderMenuId,this.tooltipService,this.tooltipCssApplicators,this.appsService,this.popoverPlacement||"auto bottom-right",this.$element)},t.prototype.handleOverflowActionsMenu=function(e){this.openCardOverflowMenu(this.card,"lazy-components/adaptive-card/card-overflow-menu.html",e,this.$timeout,this.$scope,this.cardHeaderMenuId,this.tooltipService,this.tooltipCssApplicators,this.appsService,this.popoverPlacement||"auto bottom-right",this.$element)},t.prototype.handleMenuKeyDown=function(e){e.which===this.constants.keyCodes.escape&&this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,this.cardHeaderMenuId)},t.prototype.postLink=function(){var e=this;if(this.$scope.payload&&(this.card&&this.card.unsubscribeForChanges(this.cardEventHandler),this.card=this.botCardFactory.createCard({content:this.$scope.payload,contentType:this.constants.bots.cards.types.adaptive},null,null),this.card&&this.card.subscribeForChanges(this.cardEventHandler)),this.card&&this.card.content){this.initAdaptiveCard();var t=angular.element(p);this.$element.empty(),this.$element.append(t),this.render(),this.showCardBorder=!angular.isDefined(this.$scope.showCardBorder)||this.$scope.showCardBorder,this.showCardBorder&&this.card.accentColor&&(this.cardBorderTopColor=this.card.accentColor),this.showCopy=!(!angular.isDefined(this.$scope.showCopy)||this.disableCardCopy)&&this.$scope.showCopy,this.showCardClose=this.isUrlPreviewCard(this.card),this.showCardCollapse=this.isUrlPreviewCard(this.card),this.initCardHeader(),this.showFeedback=!1,this.useDefaultResponsiveCardWidth=!!angular.isDefined(this.$scope.useDefaultResponsiveCardWidth)&&this.$scope.useDefaultResponsiveCardWidth,teamspace.common.SafeJQuery.on(this.$scope,this.cardCopyElement,"click",function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.clientObservers.onCopy&&e.clientObservers.onCopy({$ctrl:e,$event:t[0]})}),teamspace.common.SafeJQuery.on(this.$scope,this.cardCloseElement,"click",function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.onRemoveCard(e.card,!1)}),teamspace.common.SafeJQuery.on(this.$scope,this.cardCollapseElement,"click",function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.onRemoveCard(e.card,!0)}),this.isACv2IntegratedCachingEnabled()?this.checkForRefreshAndUpdateRefreshButtonState().then(function(t){t[0];if(t[1]){var n=e.botCardService.getCardCacheKey(e.card);e.botCardService.getCachedAdaptiveCardData(n).then(function(t){var n=e.botCardService.getAdaptiveCardRefreshAction(e.card,t);n&&(e.showRefreshLoader(),e.handleRefreshAction(n,s.Auto))})}}).finally(function(){e.clientObservers.onReady&&e.clientObservers.onReady({$ctrl:e})}):this.handleACv2RenderWithCacheRead()}},t.prototype.render=function(){var e=this.loggingService.newScenario(this.constants.scenarios.extensibility.bots.adaptiveCardRenderScenario),t=this.adaptiveCard.render();e.mark(this.constants.scenarios.extensibility.bots.adaptiveCardRenderSteps.sdkRender),this.adaptiveCardElement.empty(),this.adaptiveCardElement.append(t),this.postProcessingStyling(),e.mark(this.constants.scenarios.extensibility.bots.adaptiveCardRenderSteps.postProcessing),this.$compile(this.cardContentElement)(this.$scope),e.mark(this.constants.scenarios.extensibility.bots.adaptiveCardRenderSteps.ngCompile),e.stop()},t.prototype.subscribe=function(e,t){this.clientObservers[e]=t},t.prototype.unsubscribe=function(e,t){delete this.clientObservers[e]},t.prototype.overwriteConfig=function(e){var t=this.adaptiveCard.hostConfig,n=_.defaultsDeep({},e,t);this.adaptiveCard.hostConfig=n},t.prototype.resetFeedbackContainerClasses=function(){this.actionFeedbackElement.hasClass(this.cardErrorClass)&&this.actionFeedbackElement.removeClass(this.cardErrorClass),this.actionFeedbackElement.hasClass(this.cardInfoClass)&&this.actionFeedbackElement.removeClass(this.cardInfoClass)},t.prototype.initializeMarkdownLibrary=function(){this.enableSharedMarkdownInstance||(this.markdownIt=new m("zero").enable(["link","emphasis","list","newline","escape"]),v.MentionsRule.addMentionsRule(this.constants.semanticObjectSchemas.mention,this.markdownIt))},t.prototype.isAnyCardHeaderActionVisible=function(){return!this.disableCardCopy||this.showAppDetails||this.showRefreshButtonInCardHeader},t.prototype.initCardHeader=function(){this.showCardOverflowActions=this.emailCardImprovementsEnabled&&this.card.content&&this.overflowActions&&this.overflowActions.length>0},t.prototype.initAdaptiveCard=function(){var e=this;this.clientObservers.onPreInit&&this.clientObservers.onPreInit({$ctrl:this});var t=this.routeUtilityService.getRootRouteParams(),n=this.card.conversationId||t.threadId,r=this.conversationsService.getConversation(n);h.GlobalRegistry.elements.unregister("Image"),h.GlobalRegistry.elements.register("Image",f.AdaptiveCardHelper.createWrappingClass(f.Image,function(){return[e.constants,e.enableExpandingImagesInAdaptiveCards,e.enlargeImageLabel,e.htmlSanitizer,e.settingsService,e.amsUrlService,e.utilityService,e.logger]})),h.GlobalRegistry.elements.unregister("ImageSet"),h.GlobalRegistry.elements.register("ImageSet",f.AdaptiveCardHelper.createWrappingClass(f.ImageSet,function(){return[e.constants,e.enableExpandingImagesInAdaptiveCards,e.enlargeImageLabel,e.htmlSanitizer,e.settingsService,e.amsUrlService,e.utilityService,e.logger]})),h.GlobalRegistry.elements.unregister("Component"),h.GlobalRegistry.elements.register("Component",f.AdaptiveCardHelper.createWrappingClass(f.Component,function(){return[e.eventingService,e.messagingTelemetryService,e.peopleService,e.tooltipService,e.tooltipCssApplicators,e.constants,e.$timeout,e.$compile,e.$scope.$new(),e.$translate,e.resources,e.loggingService,e.settingsService]})),h.GlobalRegistry.elements.unregister("Input.Date"),h.GlobalRegistry.elements.register("Input.Date",f.AdaptiveCardHelper.createWrappingClass(f.DateInput,function(){return[".ts-message-list-item",e.popupContainerSelector,e.localizationService,e.ariaLiveService,e.$scope.$new(),e.$compile,e.$translate,e.resources]})),h.GlobalRegistry.elements.unregister("Input.Time"),h.GlobalRegistry.elements.register("Input.Time",f.AdaptiveCardHelper.createWrappingClass(f.TimeInput,function(){return[".ts-message-list-item",e.popupContainerSelector,e.localizationService,e.ariaLiveService,e.$scope.$new(),e.logger,e.constants]})),h.GlobalRegistry.elements.unregister("Input.ChoiceSet"),h.GlobalRegistry.elements.register("Input.ChoiceSet",f.AdaptiveCardHelper.createWrappingClass(f.ChoiceSetInput,function(){return[".ts-message-list-item",e.popupContainerSelector,e.$scope.$new(),e.$compile,e.$templateCache,e.$translate,e.resources,e.ariaLiveService,e.settingsService,e.eventingService,e.objectId,e.utilityService,e.constants,e.htmlSanitizer,!!r&&r.isOneOnOneBotChat()||!1,n,e.createApplicationSearchQueryHandler()]})),h.GlobalRegistry.elements.unregister("Input.Toggle"),h.GlobalRegistry.elements.register("Input.Toggle",f.AdaptiveCardHelper.createWrappingClass(f.ToggleInput,function(){return[e.$templateCache,e.$translate,e.resources,e.ariaLiveService,e.objectId,e.utilityService,e.htmlSanitizer]})),h.GlobalRegistry.elements.unregister("Input.Text"),h.GlobalRegistry.elements.register("Input.Text",f.AdaptiveCardHelper.createWrappingClass(f.TextInput,function(){return[e.$compile,e.$sce,e.$scope.$new(),e.$templateCache,e.$translate,e.constants,e.resources,e.settingsService]})),h.AdaptiveCard.onProcessMarkdown=this.processMarkDown;var i=this.emailCardImprovementsEnabled?this.extractOverflowActions(this.card.content):void 0;this.adaptiveCard=new h.AdaptiveCard,this.adaptiveCard.parse(this.card.content),this.emailCardImprovementsEnabled&&this.parseOverflowActions(i),this.setupHostConfig(),this.adaptiveCard.onExecuteAction=function(t){return e.handleOnExecuteAction(t)},this.adaptiveCard.onInlineCardExpanded=function(t,n){return e.handleOnInlineCardExpanded(t,n)},this.adaptiveCard.onElementVisibilityChanged=function(t){return e.handleOnElementVisibilityChanged(t)}},t.prototype.handleOnElementVisibilityChanged=function(e){var t=new teamspace.services.CardButton;t.type=this.constants.bots.cards.adaptiveCard.actions.toggleVisibility,this.botCardService.logTelementryForCardAction(this.card,t)},t.prototype.handleOnInlineCardExpanded=function(e,t){this.postProcessingStyling(),t&&e.card&&e.card.speak&&this.ariaLiveService.update(e.card.speak,!0);var n=new teamspace.services.CardButton;n.type=this.constants.bots.cards.adaptiveCard.actions.showCard,n.title=e.title,this.botCardService.logTelementryForCardAction(this.card,n)},t.prototype.extractOverflowActions=function(e){var t=this;if(e&&e.actions){var n=_.partition(e.actions,function(e){return t.emailCardHackEnabled&&t.card.appId===t.constants.appId.shareToTeamsFromOutlook?"Open in Teams"===e.title||"Download"===e.title:e.msTeams&&e.msTeams.overflow}),r=n[0]||[];return e.actions=n[1],r}},t.prototype.isPinTabAction=function(e){var t=e&&e.data&&(e.data.msTeams||e.data["msTeams".toLowerCase()]);return"Action.Submit"==e.type&&t&&t.value&&t.value.type===this.constants.stageConstants.invokeNames.tabInfo&&t.value.tabInfo.pinTab},t.prototype.parseOverflowActions=function(e){var t=this;this.overflowActions=_.map(e,function(e){var n=t.acSerializationContext.parseAction(t.adaptiveCard,e,[],!1);return n&&t.processOverflowActionIcon(n),n})},t.prototype.processOverflowActionIcon=function(e){var t,n=this.settingsService.getStaticsUri();if(e.iconUrl){e.iconUrl=e.iconUrl.trim();var r=e.iconUrl.lastIndexOf("/")+1;if(r>0&&r<e.iconUrl.length-1&&(t=e.iconUrl.substr(r)),t)switch(t=t.toLowerCase()){case"microsoft_teams_logo_refresh.ico":e.iconUrl=n+"/evergreen-assets/adaptiveemail/icon-teams.svg";break;case"downloadicon2x.png":e.iconUrl=n+"/evergreen-assets/adaptiveemail/icon-download.svg"}}},t.prototype.handleOnExecuteAction=function(e,t,n){var r=this;void 0===t&&(t=s.None);var i=this.constants.scenarios.extensibility.bots.adaptiveCardSubmitScenarioSteps,a=this.loggingService.newScenario(this.constants.scenarios.extensibility.bots.cardActions.adaptiveCardSubmitScenario);a.mark(i.postProcessingStylingPre),this.postProcessingStyling(),a.mark(i.postProcessingStylingDone);var o=this.$window.event||new Event("click"),c=jQuery.event.fix(o);Object.defineProperty(c,"currentTarget",{writable:!1,value:this.mostRecentButtonClicked||c.currentTarget}),c.currentTarget||Object.defineProperty(c,"currentTarget",{writable:!1,value:o.explicitOriginalTarget}),a.mark(i.definedCurrentTarget);var l=new teamspace.services.CardButton(this.utilityService.generateUUID()),p=function(){if(r.onCardClicked(),e instanceof h.OpenUrlAction)return r.handleOpenUrlAction(e,c,l);if(t!==s.None&&e instanceof y.ExecuteAction)return r.handleAdaptiveCardRefresh(e,l,t,n);if(e instanceof y.ExecuteAction)return r.handleActionExecuteInvoke(e,c,l);if(e instanceof h.SubmitAction)return r.handleSubmitAction(e,c,l);var i="[AdaptiveCardController::handleOnExecuteAction()] unsupported $action.type to execute = "+e.getJsonTypeName();return r.logger.error(i),Promise.reject(i)},d=function(t,n,o,s){r.clientObservers.onDidExecuteAction&&(a.mark(i.onDidExecuteAction),r.clientObservers.onDidExecuteAction({$ctrl:r,$action:e,$event:c,$result:t,$error:n})),e instanceof h.SubmitAction&&!s&&(r.shouldDisableRerenderingForAdaptiveCards||(r.initAdaptiveCard(),r.render())),n&&o?a.fail({error:n}):a.stop()},u=function(){a.mark(i.executeDefaultActionStart),a.pause({reason:"waiting for action complete"}),r.logger.info("proceedWithDefaultAction"),p().then(function(e){a.resume(),a.mark(i.executeDefaultActionDone),d(e)}).catch(function(e){r.hideRefreshLoader(),a.resume(),a.mark(i.executeDefaultActionFailed),d(null,e,!0,!0)})};this.clientObservers.onWillExecuteAction?(a.mark(i.onWillExecuteActionStart),a.pause({reason:"waiting for action complete"}),(this.clientObservers.onWillExecuteAction({$ctrl:this,$action:e,$event:c})||Promise.resolve(!1)).then(function(e){a.resume(),a.mark(i.onWillExecuteActionDone,{continueDefault:e}),e?u():d(null,void 0,void 0,!0)}).catch(function(e){a.resume(),a.mark(i.onWillExecuteActionFailed),d(null,e)})):u()},t.prototype.handleOpenUrlAction=function(e,t,n){return n.type=this.constants.bots.cards.actions.openUrl,n.title=e.title,n.value=this.resolveTemplateParamsInUrl(e.url),this.buttonClicked(t,n,this.card)},t.prototype.handleActionExecuteInvoke=function(e,t,n){return n.type=this.constants.bots.cards.actions.actionExecuteInvoke,n.title=e.title,n.value=this.getActionExecuteInvokePayload(e,s.Manual,teamspace.services.ActionExecuteSource.ButtonClick),n.actionComplianceParams={type:e.getJsonTypeName(),title:n.title},this.buttonClicked(t,n,this.card)},t.prototype.handleAdaptiveCardRefresh=function(e,t,n,r){return t.type=this.constants.bots.cards.actions.actionExecuteInvoke,t.title=e.title,t.value=this.getActionExecuteInvokePayload(e,n,r),this.botCardService.processClickedButton(t,this.card,this.$scope,n===s.Auto)},t.prototype.handleSubmitAction=function(e,t,n){if(this.card.isInputExtension?!!this.card.conversationId:!!(this.card.conversationId&&this.card.replyChainId&&this.card.cardSender&&this.card.cardSender.mri)){if(!!this.embeddedMSTeamsActionType(e))return this.transformToMSTeamsAction(t,e);var r=new teamspace.services.CardButton(this.utilityService.generateUUID());return r.type=this.constants.bots.cards.actions.messageback,r.title=e.title,r.value=JSON.stringify(e.data),r.actionComplianceParams=i({type:e.getJsonTypeName(),title:r.title},!!e.iconUrl&&{imageUrl:e.iconUrl}),this.buttonClicked(t,r,this.card)}return Promise.resolve(null)},t.prototype.populateAtMentionsSemanticObjects=function(e,t){var n=this.mentions||this.card.mentions;if(n&&this.doesTextHaveMentions(e)){var r=this.loggingService.newScenario(this.constants.scenarios.extensibility.bots.atMentionsInAdaptiveCard.mentionScenario);r.appendEventData({mentionsArrayLength:n.length,appId:this.card.appId});try{var i=this.getContentWithSemanticObjects(t,n);return this.markAndStopAtMentionsScenario(r,i),i}catch(e){this.logger.error("unable to create at-mentions tags: "+l.ErrorUtility.format(e)),r.fail({appId:this.card.appId,error:l.ErrorUtility.format(e)}),r=null}}return t},t.prototype.doesTextHaveMentions=function(e){return!(!e||-1===e.indexOf(this.constants.semanticObjectSchemas.mention))},t.prototype.getContentWithSemanticObjects=function(e,t){var n=this.semanticObjectService.populateSemanticObjectContent(e,t,void 0,!1,void 0);return this.isSenderUserMri()&&(n=g.BotCardMentionsHelper.addBotTagForBotCardWithMentions(n,this.constants.semanticObjectSchemas.mention)),this.htmlMessageBodyAdapterService.convert(n,!1,!1)},t.prototype.isSenderUserMri=function(){var e=SkypeX.Services.ChatServiceUtils.MriNamespace_SkypeSpacesUser;return!!(this.card.cardSender&&this.card.cardSender.mri&&this.card.cardSender.mri.startsWith(e))},t.prototype.markAndStopAtMentionsScenario=function(e,t){e&&(-1!==t.toLowerCase().indexOf("data-itemprops")?(e.mark(this.constants.scenarios.extensibility.bots.atMentionsInAdaptiveCard.mentionProcessingCompleteScenarioStep),e.stop(),this.card.hasMentions=!0):(e.mark(this.constants.scenarios.extensibility.bots.atMentionsInAdaptiveCard.mentionPropertyMissingScenarioStep),e.stop()))},t.prototype.resolveTemplateParamsInUrl=function(e){var t=e||"",n=teamspace.services.O365HttpPOST.regexForValueSubstitution,r=_.uniq(t.match(n));if(r&&r.length>0){var i={};_.each(this.adaptiveCard.getAllInputs(),function(e){var t=e.value;i[e.id]=t&&encodeURIComponent(t)}),_.forEach(r,function(e){var n=e.substring(2,e.indexOf(".value"));t=t.replace(new RegExp(e,"g"),i[n])})}return t},t.prototype.handleCardEvent=function(e,t){if(e)switch(+e){case teamspace.services.CardEvent.updateAppAttribution:this.renderAppAttrubution();break;case teamspace.services.CardEvent.updateAccentColor:this.cardBorderTopColor=this.card.accentColor;break;case teamspace.services.CardEvent.updateCardMessage:var n=t.cardMessage;if(!_.isEmpty(n))switch(n.messageType){case teamspace.services.CardMessageType.error:this.errorMessageText=n.message,n.message?(this.hideRefreshLoader(),this.showFeedback=!0,this.actionFeedbackType=n.messageType):this.showFeedback=!1;break;case teamspace.services.CardMessageType.info:this.feedbackMessageText=n.message,n.message?(this.showFeedback=!0,this.actionFeedbackType=n.messageType):this.showFeedback=!1}}},t.prototype.checkForRefreshAndUpdateRefreshButtonState=function(){var e=this;return this.$q.all([this.botCardService.getAssociatedBotMri(this.card),this.getUserCountFromConversation()]).then(function(t){var n=t[0],r=t[1];return e.isActionExecuteAllowed(n)&&e.isCardRefreshAllowed(n)?e.botCardService.checkCardForManualAndAutoRefresh(e.card.content,n,r).then(function(t){var n=t[0],r=t[1];return n||r?e.updateRefreshButtonState(b.SHOW):e.updateRefreshButtonState(b.HIDE),[n,r]}):(e.updateRefreshButtonState(b.HIDE),[!1,!1])})},t.prototype.setupHostConfig=function(e){void 0===e&&(e=!1);var t=this.defaultFontSizeAndFontWeightPayload,n=[this.getDefaultHostConfig(),t,this.getColorConfigForCurrentTheme()],r=new h.HostConfig(_.defaultsDeep.apply(_,o([{}],n)));this.overwriteConfig(r),e&&this.render()},t.prototype.getDefaultHostConfig=function(){var e=this.defaultFontSizeAndFontWeightPayload,t=(e.fontFamily,a(e,["fontFamily"]));return{fontTypes:{default:this.defaultFontSizeAndFontWeightPayload,monospace:t},imageSizes:{small:32,medium:52,large:100},separator:{lineThickness:1},actions:{maxActions:this.constants.bots.cards.limits.maxActionButtons,buttonSpacing:8,actionsOrientation:h.Orientation.Horizontal,actionAlignment:h.ActionAlignment.Left,showCard:{actionMode:h.ShowCardActionMode.Inline,inlineTopMargin:16}},factSet:{spacing:16},spacing:{small:8,default:12,medium:16,large:20,extraLarge:24,padding:16}}},t.prototype.getColorConfigForCurrentTheme=function(){var e=this.settingsService.getActiveTheme(),t=f.AdaptiveCardHelper.colorThemeConfig[e];switch(e){case this.constants.themes.dark:case this.constants.themes.darkV2:case this.constants.themes.tflDark:t=this.$scope.hostConfigDark||t;break;case this.constants.themes.highContrast:t=this.$scope.hostConfigContrast||t;break;case this.constants.themes.default:case this.constants.themes.defaultV2:case this.constants.themes.tflDefault:default:t=this.$scope.hostConfigDefault||t}return t},t.prototype.postProcessingStyling=function(){var e=this;this.disableCardCopy=this.enableActionExecuteFromInputExtension&&(this.card.isACv2||!!this.$scope.isUserSpecificCard);var t=this.adaptiveCardElement.children().first(),n=t.children();t.find("button.ac-pushButton").addClass("ts-btn card-common-inset-border"),t.find(".ac-adaptiveCard button.ac-pushButton").addClass("ts-btn-primary"),t.find("button.expandable.expanded").attr("selected","selected"),t.find("button.expandable:not(.expanded)").attr("selected",null),t.find("div.ac-media").addClass("hide-content"),n.find("button.ac-inlineActionButton").addClass("ts-btn card-common-inset-border"),n.find(".ac-adaptiveCard button.ac-inlineActionButton").addClass("ts-btn-primary");var r=function(t,n){t.find(n).each(function(t,n){if(n.onclick){var r=n.onclick;n.onclick=function(t){e.mostRecentButtonClicked=t.currentTarget,r(t)}}})};r(t,"button.ac-pushButton"),r(n,"button.ac-inlineActionButton"),this.postProcessingCardWidth(),this.emailCardImprovementsEnabled&&this.initCardHeader(),this.postProcessingButtonLayout(),this.cardContentElement[0].style.backgroundColor=t[0].style.backgroundColor,this.card.appId!==this.constants.appId.shareToTeamsFromOutlook&&this.card.appAttribution&&this.renderAppAttrubution(),t.find("textarea").attr("contenteditable","true"),t.find("textarea, button.ac-pushButton, button.ac-inlineActionButton").attr("do-not-decorate-click-for-acc",""),t.find("[placeholder]").attr("ng-non-bindable",""),t.find("button.ac-pushButton").attr("ng-non-bindable",""),n.find("button.ac-inlineActionButton").attr("ng-non-bindable",""),this.adaptiveCardElement.find("img[alt]").each(function(t,n){var r=e.htmlSanitizer.escapeAngular(n.getAttribute("alt"));n.setAttribute("alt",r)}),this.adaptiveCardElement.find("[aria-label]").each(function(t,n){var r=e.htmlSanitizer.escapeAngular(n.getAttribute("aria-label"));n.setAttribute("aria-label",r)}),this.adaptiveCardElement.find("[title]").each(function(t,n){var r=e.htmlSanitizer.escapeAngular(n.getAttribute("title"));n.setAttribute("title",r)}),this.clientObservers.onPostProcessingStyling&&this.clientObservers.onPostProcessingStyling({$ctrl:this})},t.prototype.postProcessingCardWidth=function(){var e=((this.card.content.msTeams||this.card.content.msteams||{}).width||"").toUpperCase()===this.constants.bots.cards.adaptiveCard.msTeams.width.full,t=this.card.appId===this.constants.appId.shareToTeamsFromOutlook;(this.variableCardWidthEnabled&&e||this.emailCardHackEnabled&&t)&&this.cardContentElement.addClass(this.cardFullWidthClass)},t.prototype.postProcessingButtonLayout=function(){var e=this,t=this.adaptiveCardElement.children().first(),n=t.children(),r=this.adaptiveCard.hostConfig.actions.buttonSpacing/2+"px",i=t.find("button.ac-pushButton"),a=n.find("button.ac-inlineActionButton"),o=function(e){return _.chain(e).map(function(e){return e.parentElement}).filter(function(e){return"flex"===e.style.display}).uniq().value()},s=o(i),c=o(a);_.each(s,function(t){var n=$(t).find("div");_.forEach(n,function(e){e.innerHTML||$(e).removeAttr("style").end().html()}),e.addButtonStyling(t,"button.ac-pushButton",r)}),_.each(c,function(t){$(t).find("input.ac-input.ac-textInput").addClass("inline-textInput"),$(t).find("textarea.ac-input.ac-textInput.ac-multiline").addClass("inline-textInput"),e.addButtonStyling(t,"button.ac-inlineActionButton",r),$(t).find("button.ac-inlineActionButton").length>0&&$(t).addClass("inline-action-input")})},t.prototype.addButtonStyling=function(e,t,n){_.forEach($(e).find(t),function(e){e.style.margin=n}),e.style.flexWrap="wrap",e.style.margin="-"+n},t.prototype.renderAppAttrubution=function(){if(this.appAttributionElement.empty(),this.card.appAttribution){var t=e.prototype.useNgIncludeForIcon.call(this,this.card.appAttribution.imageUrl),n=this.htmlSanitizer.escapeAngular(this.card.appAttribution.accentColor),r=this.utilityService.escapeHtml(this.card.appAttribution.name),i=this.htmlSanitizer.sanitizeUrl(this.card.appAttribution.imageUrl,["data","http","https"]),a=angular.element("<div />");if(a.attr("class","image-container"),a.attr("style","background-color: "+n),t)a.append(angular.element(this.$templateCache.get(i)));else{var o=angular.element("<img />");o.attr("src",i),a.append(o)}var s=angular.element("<span ng-non-bindable />");s.append(r),this.appAttributionElement.append(a),this.appAttributionElement.append(s);var c=this.adaptiveCard.hostConfig.spacing.padding+"px";this.appAttributionElement[0].style.padding=c+" "+c+" 0"}},t.prototype.embeddedMSTeamsActionType=function(e){var t=this.constants.bots.cards.adaptiveCard.teamsActionWrapperName;return e&&e.data&&e.data[t]&&e.data[t].type&&_.isString(e.data[t].type)&&e.data[t].type.toLowerCase()},t.prototype.transformToMSTeamsAction=function(e,t){var n=this.constants.bots.cards.adaptiveCard.teamsActionWrapperName,r=t.data[n],a=this.embeddedMSTeamsActionType(t),o=new teamspace.services.CardButton(this.utilityService.generateUUID());switch(o.title=t.title,a.toLowerCase()){case this.constants.taskModuleConstants.invokeNames.fetch.toLowerCase():o.type=this.constants.bots.cards.actions.invoke,o.value=this.mergePayload(t.data,JSON.stringify({type:this.constants.taskModuleConstants.invokeNames.fetch}));break;case this.constants.bots.cards.actions.messageback.toLowerCase():o.type=this.constants.bots.cards.actions.messageback,o.displayText=r.displayText,o.text=r.text,o.value=this.mergePayload(t.data,r.value),o.actionComplianceParams=i({type:t.getJsonTypeName(),title:o.title,text:r.text},!!t.iconUrl&&{imageUrl:t.iconUrl});break;case this.constants.bots.cards.actions.invoke.toLowerCase():o.type=this.constants.bots.cards.actions.invoke,o.value=this.mergePayload(t.data,r.value),o.actionComplianceParams=i({type:t.getJsonTypeName(),title:o.title},!!t.iconUrl&&{imageUrl:t.iconUrl});break;case this.constants.bots.cards.actions.reply.toLowerCase():o.type=this.constants.bots.cards.actions.reply,o.value=r.value;break;case this.constants.bots.cards.actions.signIn.toLowerCase():o.type=this.constants.bots.cards.actions.signIn,o.value=r.value;break;default:this.logger.error("Unrecognized action type = "+a)}return o.type?this.buttonClicked(e,o,this.card):Promise.reject("Unrecognized action type = "+a)},t.prototype.getActionExecuteInvokePayload=function(e,t,n){var r=e.data?this.mergePayload(e.data,{type:this.constants.bots.cards.actions.actionExecuteInvoke}):JSON.stringify({type:this.constants.bots.cards.actions.actionExecuteInvoke}),a={action:i(i({},e.toJSON()),{data:JSON.parse(r)}),trigger:t};return n&&(a.executeSource=n),JSON.stringify(a)},t.prototype.isACv2IntegratedCachingEnabled=function(){return this.settingsService.valueFor(this.constants.settings.names.enableACv2IntegratedCaching)},t.prototype.isActionExecuteAllowed=function(e){return this.isBotAllowedToPerformActionExecute(e)&&this.isActionExecuteEnabledForCard()},t.prototype.isCardRefreshAllowed=function(e){return this.isActionExecuteAllowed(e)&&this.isRefreshEnabledForCard()},t.prototype.isBotAllowedToPerformActionExecute=function(e){var t=this.settingsService.valueFor(this.constants.settings.names.botsWhitelistForActionExecute)||[];return 0==t.length||t.includes(e)},t.prototype.renderCard=function(e){this.card.content=e,this.initAdaptiveCard(),this.render()},t.prototype.handleRefreshAction=function(e,t,n){var r=this.acSerializationContext.parseAction(new y.AdaptiveAppletCard,e,[],!1);r?this.handleOnExecuteAction(r,t,n):this.hideRefreshLoader()},t.prototype.showRefreshLoader=function(){this.isCardRefreshing=!0,this.updateRefreshButtonState(b.IN_PROGRESS)},t.prototype.hideRefreshLoader=function(){this.isCardRefreshing=!1,this.updateRefreshButtonState(b.COMPLETE)},t.prototype.handleCardUpdate=function(e){var t=this;if(this.botCardService.getCardCacheKey(this.card)===e.cacheKey&&(this.hideRefreshLoader(),e.cardContent)){this.$scope.isUserSpecificCard=!0;var n=this.botCardFactory.createCard({content:e.cardContent,contentType:this.constants.bots.cards.types.adaptive},null,null);this.card.content=n.content,this.initAdaptiveCard(),this.render(),this.checkForRefreshAndUpdateRefreshButtonState().catch(function(e){var n="Error while executing checkForRefreshAndUpdateRefreshButtonState in handleCardUpdate. Msg: "+e.message;t.logger.error(n)}),this.enableActionExecuteFromInputExtension&&this.card.isInputExtension&&this.$scope.inCompose&&this.eventingService.$emit(this.constants.inputExtensionConstants.resizeInputExtension,{cardClientId:this.card.cardClientId,type:this.constants.events.funStuff.type.inputExtension})}},t.prototype.handleCardRefreshEvent=function(e){e.executeSource===teamspace.services.ActionExecuteSource.TaskModuleClose&&this.handleRefreshOnTaskModuleClose(e)},t.prototype.getUserCountFromConversation=function(){var e=this;return-1!==this.userCountInConversation?this.$q.resolve(this.userCountInConversation):this.botCardService.getUserCountFromConversation(this.card.conversationId).then(function(t){return e.userCountInConversation=t,e.card.telemetryEventData=i(i({},e.card.telemetryEventData),{acv2RefreshTeamSize:e.userCountInConversation}),t})},t.prototype.updateRefreshButtonState=function(e){var t=this;if(this.refreshButtonState!==e&&(this.refreshButtonState=e,this.enableACv2RefreshButtonInMessageActionsMenu)){var n=this.constants.events.messages.refresh.complete;switch(e){case b.SHOW:n=this.constants.events.messages.refresh.show;break;case b.HIDE:n=this.constants.events.messages.refresh.hide;break;case b.IN_PROGRESS:n=this.constants.events.messages.refresh.inprogress;break;default:n=this.constants.events.messages.refresh.complete}this.card.notifyAll(teamspace.services.CardEvent.updateRefreshStatus,{cardObjectId:this.objectId,state:n,callback:function(e){return t.handleRefreshButtonClick(e)}})}},t.prototype.handleRefreshButtonClick=function(e){e&&(e.stopPropagation(),e.preventDefault()),this.showRefreshLoader(),this.card.isInputExtension&&this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,this.cardHeaderMenuId);var t=this.card.content.refresh.action;this.handleRefreshAction(t,s.Manual)},t.prototype.handleRefreshOnTaskModuleClose=function(e){var t,n,r=e.cacheKey,i=e.botMri,a=e.executeSource;if(this.botCardService.getCardCacheKey(this.card)===r&&this.isCardRefreshAllowed(i)){this.showRefreshLoader();var o=null===(n=null===(t=this.card.content)||void 0===t?void 0:t.refresh)||void 0===n?void 0:n.action;this.handleRefreshAction(o,s.Auto,a)}},t.prototype.handleACv2RenderWithCacheRead=function(){var e=this;this.$q.all([this.botCardService.getAssociatedBotMri(this.card),this.getUserCountFromConversation()]).then(function(t){var n=t[0],r=t[1];if(e.isActionExecuteAllowed(n)){e.card.isACv2&&e.showRefreshLoader();var i=e.botCardService.getCardCacheKey(e.card),a=e.card.content;e.botCardService.shouldACv2CacheReplaceMessagePayload(e.card.content,n,i,e.card.cardMessageVersion,r,e.card.isInputExtension).then(function(t){var o=t[0],c=t[1];o?(a=c.data,e.renderCard(a)):c&&e.botCardService.deleteCachedAdaptiveCardData(i),e.isCardRefreshing&&e.hideRefreshLoader(),e.isCardRefreshAllowed(n)?e.botCardService.checkCardForManualAndAutoRefresh(a,n,r).then(function(t){var n=t[0],r=t[1];if(n||r?e.updateRefreshButtonState(b.SHOW):e.updateRefreshButtonState(b.HIDE),r){e.showRefreshLoader();var i=e.botCardService.getAdaptiveCardRefreshAction(e.card,c);i?e.handleRefreshAction(i,s.Auto):e.hideRefreshLoader()}}):e.updateRefreshButtonState(b.HIDE)}).catch(function(){e.hideRefreshLoader()})}}).finally(function(){e.clientObservers.onReady&&e.clientObservers.onReady({$ctrl:e})})},t.prototype.isActionExecuteEnabledForCard=function(){return this.card.isACv2&&(this.card.isBotCard&&this.settingsService.valueAsBoolean(this.constants.settings.names.enableActionExecuteFromBotCard)||this.card.isInputExtension&&this.enableActionExecuteFromInputExtension)},t.prototype.isRefreshEnabledForCard=function(){return this.card.isBotCard&&this.settingsService.valueAsBoolean(this.constants.settings.names.enableRefreshInBotAdaptiveCard)||this.card.isInputExtension&&this.settingsService.valueAsBoolean(this.constants.settings.names.enableRefreshInInputExtensionAdaptiveCard)},t.prototype.createApplicationSearchQueryHandler=function(){var e=this;return function(t,n,r){var i={queryText:t,dataset:n,context:r,queryOptions:{skip:0,top:15}};return e.botCardService.executeSearchInvoke(i,e.card)}},t.botInvokeName="adaptiveCardSubmit",t}(c.BaseCardController);t.AdaptiveCardController=C,angular.module("teamspace.adaptiveCard",[]).directive("adaptiveCard",[function(){return{restrict:"E",scope:{payload:"<?",popupContainerSelector:"@?",threadId:"@?",showCardBorder:"<?",showCardHeader:"<?",showCopy:"<?",useDefaultResponsiveCardWidth:"<?",hostConfigDefault:"<?",hostConfigDark:"<?",hostConfigContrast:"<?",onReady:"&?",onWillExecuteAction:"&?",onDidExecuteAction:"&?",onPostProcessingStyling:"&?",onCopy:"&?",onPreInit:"&?",popoverPlacement:"@?",inCompose:"<?",isUserSpecificCard:"<?"},controllerAs:"ctrl",bindToController:{card:"<?",seeMoreEnabled:"@?",mentions:"<?"},controller:C,link:function(e,t,n,r){r.postLink()}}}]).run(["$templateCache",function(e){e.put("lazy-components/adaptive-card/adaptive-card.html",p),e.put("lazy-components/adaptive-card/card-header-menu.html",d),e.put("lazy-components/adaptive-card/card-overflow-menu.html",u)}])},323:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=n(324),o=n(325),s=n(58),c=function(e){function t(t,n,r,i,a,o,c,l,p,d,u,h,m,f,v,g,y){var b=e.call(this)||this;return b.messageListItemClassSelector=t,b.popupContainerSelector=n,b.$scope=r,b.$compile=i,b.$templateCache=a,b.$translate=o,b.resources=c,b.ariaLiveService=l,b.settingsService=p,b.eventingService=d,b.cardId=u,b.utilityService=h,b.constants=m,b.htmlSanitizer=f,b.isOneOnOneBotChat=v,b.conversationId=g,b.executeSearchInvoke=y,b.directorySearchEnabled=!1,b.directorySearchMode=s.DirectorySearchMode.Unknown,b.directorySearchEnabled=p.valueAsBoolean(m.settings.names.enableAdaptiveCardDirectorySearch),b}return r(t,e),t.prototype.internalRender=function(){return this.impl.internalRender()},t.prototype.parse=function(t){e.prototype.parse.call(this,t);var n=!!t.wrap,r="filtered"===t.style,i=this.settingsService.valueAsBoolean(this.constants.settings.names.enableAdaptiveCardTypeahead),c=this.directorySearchEnabled&&t&&t[s.ChoiceSetInputDirectory.choicesDataKey];this.placeholder=t&&t[s.ChoiceSetInputDirectory.placeholder];var l=this.settingsService.valueAsBoolean(this.constants.settings.names.enableAdaptiveCardDynamicTypeahead),p=t["choices.data"];this.directorySearchMode=this.getDirectorySearchMode(c),this.directorySearchMode!==s.DirectorySearchMode.Unknown?this.impl=new s.ChoiceSetInputDirectory(this.$compile,this.$scope,this.$translate,this.resources,this.constants,this.eventingService,this.htmlSanitizer,this.directorySearchMode,this.isMultiSelect,this.placeholder,this.hostConfig,this.utilityService.generateUUID(),this.defaultValue,this.choices,this.conversationId):this.impl=this.isCompact||r?new o.ChoiceSetCompact(this.isMultiSelect,i&&r,l&&p,this.choices,this.hostConfig,this.$templateCache,this.defaultValue,this.placeholder,this.$scope,this.$compile,this.$translate,this.messageListItemClassSelector,this.popupContainerSelector,this.resources,this.constants,this.utilityService,this.htmlSanitizer,this.executeSearchInvoke):new a.ChoiceSetExpanded(this.isMultiSelect,this.choices,this.hostConfig,this.$templateCache,this.defaultValue,this.$translate,this.resources,this.ariaLiveService,this.cardId,this.id,n,this.utilityService,this.htmlSanitizer)},Object.defineProperty(t.prototype,"value",{get:function(){return this.impl.value},enumerable:!0,configurable:!0}),t.prototype.getDirectorySearchMode=function(e){var t=s.DirectorySearchMode.Unknown;if(!e)return t;var n=e.type,r=e.dataset;return n&&s.ChoiceSetInputDirectory.choicesDataTypeValue===_.toLower(n)&&r&&_.toLower(r).startsWith(s.ChoiceSetInputDirectory.choicesDatasetPrefix)&&(this.conversationId&&s.ChoiceSetInputDirectory.contextualDataset===_.toLower(r)?t=s.DirectorySearchMode.Conversation:this.conversationId&&!this.isOneOnOneBotChat||s.ChoiceSetInputDirectory.organizationDataset!==_.toLower(r)?this.conversationId&&s.ChoiceSetInputDirectory.organizationDataset===_.toLower(r)&&(t=s.DirectorySearchMode.Conversation):t=s.DirectorySearchMode.Organization),t},t}(i.ChoiceSetInput);t.ChoiceSetInput=c},324:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n,r,i,a,o,s,c,l,p,d,u){this.isMultiSelect=e,this.choices=t,this.hostConfig=n,this.defaultValue=i,this.$translate=a,this.resources=o,this.ariaLiveService=s,this.cardId=c,this.id=l,this.wrap=p,this.utilityService=d,this.htmlSanitizer=u,this.inputElements=[],this.unselectedSvgHtml=e?r.get("svg/icons-checkbox-unselected.html"):r.get("svg/icons-radiobox-unselected.html"),this.selectedSvgHtml=e?r.get("svg/icons-checkbox-selected.html"):r.get("svg/icons-radiobox-selected.html")}return Object.defineProperty(e.prototype,"value",{get:function(){var e=this;if(this.isMultiSelect){var t=_.map(_.keys(_.pickBy(this.inputElements,function(e){return e.checked})),Number);return _.map(t,function(t){return e.choices[t].value}).join(this.hostConfig.choiceSetInputValueSeparator)||null}var n=_.findIndex(this.inputElements,function(e){return e.checked});return this.choices[n]&&this.choices[n].value||null},enumerable:!0,configurable:!0}),e.prototype.internalRender=function(){var e,t=this;this.isMultiSelect&&(e=this.defaultValue?this.defaultValue.split(this.hostConfig.choiceSetInputValueSeparator):null);var n=angular.element(document.createElement("div"));return n.addClass("choice-container"),this.inputElements=[],_.each(this.choices,function(r,i){var a=document.createElement("input");a.type=t.isMultiSelect?"checkbox":"radio",a.classList.add("check-item"),a.name=t.cardId+t.htmlSanitizer.escapeAngular(t.id),a.checked=t.isMultiSelect?e&&e.indexOf(r.value)>=0:t.defaultValue&&t.defaultValue===r.value;var o=angular.element('<div class="icons-item-unselected icon hide-text">'+t.unselectedSvgHtml+"</div>"),s=angular.element('<div class="icons-item-selected icon hide-text">'+t.selectedSvgHtml+"</div>");t.wrap&&(o.find("svg").addClass("wrap"),s.find("svg").addClass("wrap"));var c=t.utilityService.escapeHtml(r.title),l=angular.element("<span ng-non-bindable />");l.append(c);var p=angular.element(document.createElement("label"));p[0].classList.add("choice-label"),p[0].title=t.htmlSanitizer.escapeAngular(r.title),p[0].setAttribute("tabindex","-1"),p[0].onfocus=function(){return t.narrateFocusedItem(i)},p[0].onkeydown=function(e){return t.onkeydown(e,a,i)},p.append(a),p.append(o),p.append(s),p.append(l),t.addWrapStyling(p),n.append(p),t.inputElements.push(a)}),this.choiceSetInputElement=angular.element(document.createElement("div")),this.choiceSetInputElement.addClass("o365-action-pane-multichoice-input"),this.choiceSetInputElement.append(n),this.choiceSetInputElement[0]},e.prototype.addWrapStyling=function(e){this.wrap&&(e.css("overflow-wrap","break-word"),e[0].style.wordBreak="break-word",e[0].style.height="auto",e[0].style.whiteSpace="unset",e[0].style.display="flex",e[0].style.alignItems="center",e[0].style.textAlign="left",this.isMultiSelect||(e.find("span")[0].style.paddingLeft="1.6rem"))},e.prototype.onkeydown=function(e,t,n){var r=teamspace.Constants.Instance.keyCodes.enter,i=teamspace.Constants.Instance.keyCodes.space;!e||e.keyCode!==r&&e.keyCode!==i||(t.click(),this.narrateFocusedItem(n))},e.prototype.narrateFocusedItem=function(e){var t=this.inputElements[e],n="";n=this.isMultiSelect?t.checked?this.$translate.instant(this.resources.strings.icons_checkbox_selected):this.$translate.instant(this.resources.strings.icons_checkbox_unselected):t.checked?this.$translate.instant(this.resources.strings.icons_radiobox_selected):this.$translate.instant(this.resources.strings.icons_radiobox_unselected),n+=". "+this.choices[e].title,this.ariaLiveService.update(n,!0)},e}();t.ChoiceSetExpanded=r},325:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(44),a=function(){function e(e,t,n,r,a,o,s,c,l,p,d,u,h,m,f,v,g,y){var b=this;this.isMultiSelect=e,this.isTypeahead=t,this.dynamicSearchProps=n,this.choices=r,this.hostConfig=a,this.placeholder=c,this.$scope=l,this.$compile=p,this.$translate=d,this.popupContainerSelector=h,this.resources=m,this.utilityService=v,this.htmlSanitizer=g,this.executeSearchInvoke=y,this.showDropdown=!1,this.typeaheadFilterText="",this.debouncedFilterTypeaheadInput=_.debounce(function(e){return b.filterTypeaheadInput(e)},25),this.debouncedTypeaheadQuery=_.debounce(function(e){return b.queryUniversalSearch(e)},300),this.isLoading=!1,this.noResults=!1,this.dynamicSearchError=null,this.checkedTypeaheadChoicesMap={},this.dynamicChoiceListItems=[],this.checkedDynamicChoiceListItems=[],this.focusFirstListElement=function(){};var C=function(e,t){var n=Number.isInteger(t),r=e.find("li"),i=n?r.eq(t):b.selectedItems.length?r.filter(".selected").first():r.first();i&&(_.forEach(r,function(e){e.removeAttribute("tabindex"),e.classList.remove("kb-active")}),i.addClass("kb-active").attr("tabindex","0").focus())},S=function(e,t){e.closest(u).css("overflow",t?"visible":"")};y||(this.dynamicSearchProps=null),l.$on("dropdown.show",function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var a=$(n[0].$element);S(a,!0),i.AdaptiveCardHelper.scrollToBottomForLastItem(a,u),t?(b.focusFirstListElement=function(){C(a,0)},b.keydownHandler=function(e){"ArrowUp"===e.key?C(a,-1):"ArrowDown"===e.key&&(e.stopPropagation(),C(a,0))},b.choiceSetInputElement.find("input").focus()):C(a)}),l.$on("dropdown.hide.before",function(n){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];b.showDropdown=!1,t&&e&&(b.choiceListChecked.some(_.identity)||b.checkedDynamicChoiceListItems.length)&&(b.typeaheadInput=""),S($(r[0].$element),!1)}),l.$on(f.events.adaptiveCard.dismissDropdown,function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];b.showDropdown=!1}),this.dropdownSvgHtml=o.get("svg/icons-dropdown.html"),this.closeSvgHtml=o.get("svg/icons-close.html"),this.unselectedSvgHtml=e?o.get("svg/icons-checkbox-unselected.html"):o.get("svg/icons-radiobox-unselected.html"),this.selectedSvgHtml=e?o.get("svg/icons-checkbox-selected.html"):o.get("svg/icons-radiobox-selected.html");var A;e&&(A=s?s.split(a.choiceSetInputValueSeparator):null),this.choiceListVisible=r.map(function(){return!0}),this.choiceListChecked=_.map(r,function(t){return e?A&&A.indexOf(t.value)>=0:s&&s===t.value})}return Object.defineProperty(e.prototype,"value",{get:function(){var e=this.selectedItems,t=_.reduce(this.checkedTypeaheadChoicesMap,function(e,t,n){return t&&e.push(n),e},[]);if(this.isMultiSelect)return(this.dynamicSearchProps?t:_.map(e,function(e){return e.value})).join(this.hostConfig.choiceSetInputValueSeparator)||null;return(this.dynamicSearchProps?t&&t[0]:e&&e[0]&&e[0].value)||null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typeaheadInput",{get:function(){return this.typeaheadFilterText},set:function(e){e.length?this.showDropdown=!0:this.dynamicChoiceListItems=[],this.typeaheadFilterText=e,this.dynamicSearchProps&&e.length?(this.isLoading=!0,this.noResults=!1,this.debouncedTypeaheadQuery(e)):this.debouncedFilterTypeaheadInput(e)},enumerable:!0,configurable:!0}),e.prototype.clearSelection=function(){this.choiceListChecked=this.choiceListChecked.map(function(){return!1}),this.typeaheadInput="",this.checkedTypeaheadChoicesMap={},this.checkedDynamicChoiceListItems=[],this.dynamicChoiceListItems=[],this.updateDropdownTextAndTitle()},e.prototype.internalRender=function(){return this.choiceSetInputElement=angular.element(this.isTypeahead?this.typeaheadTemplate:this.dropdownTemplate),this.$scope.ctrl=this,this.$compile(this.choiceSetInputElement)(this.$scope),this.updateDropdownTextAndTitle(),this.setupClickHandlerForDropdownArrowButton(),this.choiceSetInputElement[0]},e.prototype.filterTypeaheadInput=function(e){var t=this,n=e.toLowerCase();this.choiceListVisible=this.choices.map(function(e,r){return t.choiceListChecked[r]||-1!=e.title.toLowerCase().indexOf(n)}),this.noResults=!this.choiceListVisible.some(_.identity),this.$scope.$apply()},e.prototype.updateDynamicSearchResults=function(e,t){if(this.typeaheadInput===t){if(null===e||null===e.results)return this.dynamicChoiceListItems=[],this.handleDynamicSearchError({statusCode:teamspace.services.UniversalSearchStatusCodes.InternalServerError},t);this.dynamicChoiceListItems=e.results.map(function(e){return new r.Choice(e.title||e.value,e.value)}),this.noResults=!this.dynamicChoiceListItems.length,this.isLoading=!1}},e.prototype.handleDynamicSearchError=function(e,t){if(this.typeaheadInput===t){var n=void 0;n=e.statusCode===teamspace.services.UniversalSearchStatusCodes.InternalServerError?e.value&&e.value.message?this.serviceErrorText+": "+e.value.message:this.serviceErrorText:e.statusCode===teamspace.services.UniversalSearchStatusCodes.RateLimit?this.rateLimitErrorText:e.statusCode===teamspace.services.UniversalSearchStatusCodes.Unauthorized?this.loginErrorText:this.serviceErrorText,this.dynamicSearchError=this.utilityService.escapeHtml(n),this.isLoading=!1,this.noResults=!1}},e.prototype.queryUniversalSearch=function(e){var t=this;this.dynamicChoiceListItems=[],this.dynamicSearchError=null,this.noResults=!1,e&&this.executeSearchInvoke(e,this.dynamicSearchProps.dataset).then(function(n){return t.updateDynamicSearchResults(n,e)}).catch(function(n){return t.handleDynamicSearchError(n,e)})},Object.defineProperty(e.prototype,"dropdownTemplate",{get:function(){var e=angular.element("<div />");e.attr("class","o365-action-pane-multichoice-input");var t=angular.element("<div />");t.attr("class","o365-multichoice-selector");var n=angular.element("<button bs-dropdown />");n.attr("class","o365-text-input o365-text-input-singleline"),n.attr("data-bs-show","ctrl.showDropdown"),n.attr("aria-haspopup","true"),n.attr("aria-expanded","false"),n.attr("data-placement","bottom-left"),n.attr("data-container",this.popupContainerSelector);var r=angular.element("<div ng-non-bindable />");r.attr("class","text");var i=angular.element("<div />");i.attr("class","placeholder");var a=this.utilityService.escapeHtml(this.dropdownPlaceholder);i.append(a),n.append(r),n.append(i);var o=angular.element("<button />");o.attr("class","o365-dropdown-button");var s=angular.element("<div />");return s.attr("aria-hidden","true"),s.append(this.dropdownSvgHtml),o.append(s),t.append(n),t.append(this.choiceListTemplate),t.append(o),e.append(t),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typeaheadTemplate",{get:function(){var e=this,t=this.utilityService.escapeHtml(this.dropdownPlaceholder),n=angular.element("<div />");n.attr("class","o365-action-pane-multichoice-input");var r=angular.element("<div />");r.attr("class","o365-multichoice-selector");var i=angular.element("<input bs-dropdown />");i.attr("class","o365-text-input o365-text-input-singleline"),i.attr("ng-model","ctrl.typeaheadInput"),i.attr("ng-keydown","ctrl.keydownHandler($event)"),i.attr("data-bs-show","ctrl.showDropdown"),i.attr("aria-haspopup","true"),i.attr("aria-expanded","false"),i.attr("data-placement","bottom-left"),i.attr("data-trigger","manual"),i.attr("placeholder",t),i.attr("data-container",this.popupContainerSelector);var a=angular.element("<button />");a.attr("class","o365-dropdown-button"),this.isMultiSelect||a.attr("ng-hide","!!ctrl.value");var o=angular.element("<div />");o.attr("aria-hidden","true"),o.append(this.closeSvgHtml),a.append(o);return r.append(i),r.append(this.choiceListTemplate),r.append(a),this.isMultiSelect||r.append(function(){var t=angular.element("<button />");t.attr("ng-hide","!ctrl.value"),t.attr("ng-click","ctrl.clearSelection()"),t.attr("class","o365-close-button"),t.attr("acc-role","clickable");var n=angular.element("<div />");return n.attr("aria-hidden","false"),n.append(e.closeSvgHtml),t.append(n),t}()),n.append(r),n},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"choiceListTemplate",{get:function(){var e=angular.element("<div />");e.attr("class","ts-adaptive-card dropdown-menu o365-multichoice-dropdown "+(this.isMultiSelect&&"isMultiselect"));var t=angular.element("<div />");t.attr("acc-role","menu");var n=angular.element("<div simple-scrollbar/>");n.attr("class","dropdown-item-container");var r=angular.element("<ul />");return r.attr("class","dropdown-list"),this.isTypeahead?r.append(this.typeaheadChoiceListTemplate):r.append(this.staticChoiceListTemplate),n.append(r),t.append(n),e.append(t),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typeaheadChoiceListTemplate",{get:function(){if(this.dynamicSearchProps)return this.dynamicChoiceListTemplate;var e=angular.element("<li />");e.attr("class","item"),e.attr("ng-repeat","choice in ctrl.choices"),e.attr("ng-if","ctrl.choiceListVisible[$index]"),e.attr("ng-class","{'selected' : ctrl.choiceListChecked[$index]}"),e.attr("acc-role","menu-item clickable"),e.append(this.singleTypeaheadChoiceTemplate);var t=angular.element("<span ng-non-bindable />");t.attr("class","content"),t.append(this.noResultsText);var n=angular.element("<li />");return n.attr("ng-if","ctrl.noResults"),n.attr("acc-role","menu-item clickable"),n.append(t),[e,n]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"staticChoiceListTemplate",{get:function(){var e=this;return _.map(this.choices,function(t,n){var r=e.utilityService.escapeHtml(t.title),i=angular.element("<li />");i.attr("class","item"),i.attr("ng-class","{'selected' : ctrl.choiceListChecked["+n+"]}"),i.attr("acc-role","menu-item clickable");var a=angular.element("<a />");a.attr("ng-click","ctrl.onDropdownItemClicked($event, "+n+")"),a.attr("track-click-silent","true");var o=angular.element("<div />");o.attr("class","icons-item-unselected icon hide-text"),o.append(e.unselectedSvgHtml);var s=angular.element("<div />");s.attr("class","icons-item-selected icon hide-text"),s.append(e.selectedSvgHtml);var c=angular.element("<span ng-non-bindable />");return c.append(r),a.append(o),a.append(s),a.append(c),i.append(a),i})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dynamicChoiceListTemplate",{get:function(){var e=angular.element("<li />");e.attr("class","item selected"),e.attr("ng-repeat","choice in ctrl.checkedDynamicChoiceListItems"),e.attr("acc-role","menu-item clickable"),e.append(this.singleTypeaheadChoiceTemplate);var t=angular.element("<li />");t.attr("class","item"),t.attr("ng-if","!!ctrl.typeaheadInput.length && !!ctrl.dynamicChoiceListItems.length && !ctrl.checkedTypeaheadChoicesMap[choice.value]"),t.attr("ng-repeat","choice in ctrl.dynamicChoiceListItems"),t.attr("ng-class","{'selected' : ctrl.checkedTypeaheadChoicesMap[choice.value]}"),t.attr("acc-role","menu-item clickable"),t.append(this.singleTypeaheadChoiceTemplate);var n=angular.element("<li />");n.attr("class","item"),n.attr("ng-if","ctrl.shouldShowStaticChoice(choice)"),n.attr("ng-repeat","choice in ctrl.choices"),n.attr("ng-class","{'selected' : ctrl.checkedTypeaheadChoicesMap[choice.value]}"),n.attr("acc-role","menu-item clickable"),n.append(this.singleTypeaheadChoiceTemplate);var r=angular.element("<span ng-non-bindable />");r.attr("class","content"),r.append(this.noResultsText);var i=angular.element("<li />");i.attr("ng-if","!!ctrl.typeaheadInput.length && ctrl.noResults"),i.attr("acc-role","menu-item"),i.append(r);var a=angular.element("<span ng-non-bindable />");a.attr("class","content"),a.append(this.loadingText);var o=angular.element("<li />");o.attr("ng-if","!!ctrl.typeaheadInput.length && ctrl.isLoading"),o.attr("acc-role","menu-item"),o.append(a);var s=angular.element("<span />");s.attr("class","content"),s.append("{{ctrl.dynamicSearchError}}");var c=angular.element("<li />");return c.attr("ng-if","!!ctrl.typeaheadInput.length && !!ctrl.dynamicSearchError"),c.attr("acc-role","menu-item"),c.append(s),[e,t,n,i,o,c]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"singleTypeaheadChoiceTemplate",{get:function(){var e=this.dynamicSearchProps?"ctrl.onDynamicChoiceClicked($event, choice)":"ctrl.onDropdownItemClicked($event, $index)",t=angular.element("<a />");t.attr("ng-click",e),t.attr("track-click-silent","true");var n=angular.element("<div />");n.attr("class","icons-item-unselected icon hide-text"),n.append(this.unselectedSvgHtml);var r=angular.element("<div />");r.attr("class","icons-item-selected icon hide-text"),r.append(this.selectedSvgHtml);var i=angular.element("<span />");return i.append("{{ choice.title }}"),t.append(n),t.append(r),t.append(i),t},enumerable:!0,configurable:!0}),e.prototype.shouldShowStaticChoice=function(e){return!this.checkedTypeaheadChoicesMap[e.value]&&(!this.typeaheadInput.length||!this.dynamicChoiceListItems.length&&!(this.noResults||this.isLoading||this.dynamicSearchError))},e.prototype.onDropdownItemClicked=function(e,t){this.isMultiSelect?this.toggleSelection(t):this.setSelected(t,!0),this.updateDropdownTextAndTitle(),this.isMultiSelect&&e.stopPropagation()},e.prototype.onDynamicChoiceClicked=function(e,t){this.isMultiSelect?(this.setDynamicSelected(t,!this.checkedTypeaheadChoicesMap[t.value]),this.focusFirstListElement()):this.setDynamicSelected(t,!0),this.updateDropdownTextAndTitle(),this.isMultiSelect&&e.stopPropagation()},e.prototype.setDynamicSelected=function(e,t){if(this.isMultiSelect||(this.checkedTypeaheadChoicesMap={}),this.checkedTypeaheadChoicesMap[e.value]=t,this.isMultiSelect)if(t)this.checkedDynamicChoiceListItems.push(e);else{var n=this.checkedDynamicChoiceListItems.findIndex(function(t){return t.value===e.value});this.checkedDynamicChoiceListItems.splice(n,1)}else this.typeaheadFilterText=e.title;this.showDropdown=this.isMultiSelect},e.prototype.setSelected=function(e,t){this.isMultiSelect?this.choiceListChecked[e]=t:this.choiceListChecked=_.map(this.choiceListChecked,function(t,n){return n===e}),this.isTypeahead&&(this.typeaheadFilterText=this.isMultiSelect?this.typeaheadInput:this.choices[e].title,this.showDropdown=this.isMultiSelect)},e.prototype.toggleSelection=function(e){this.setSelected(e,!this.choiceListChecked[e])},Object.defineProperty(e.prototype,"selectedItems",{get:function(){var e=this;return _.filter(this.choices,function(t,n){return e.choiceListChecked[n]})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropdownDisplayText",{get:function(){if(this.isMultiSelect){var e=this.selectedItems.length+this.checkedDynamicChoiceListItems.length;return 0==e?this.dropdownPlaceholder:this.$translate.instant(this.resources.strings.botcards_o365_actionCard_title_multichoice_multipleSelect_selected,{numItems:e})}return 1===this.selectedItems.length&&this.selectedItems[0].title||null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropdownTooltip",{get:function(){return _.map(this.selectedItems,function(e){return e.title}).join(this.hostConfig.choiceSetInputValueSeparator+" ")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropdownPlaceholder",{get:function(){var e;return null!==(e=this.placeholder)&&void 0!==e?e:this.isMultiSelect?this.$translate.instant(this.resources.strings.botcards_o365_actionCard_title_multichoice_multipleSelect):this.$translate.instant(this.resources.strings.botcards_o365_actionCard_title_multichoice_singleSelect)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"noResultsText",{get:function(){return this.$translate.instant(this.resources.strings.extensibility_apps_placeholderMessage_no_results)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingText",{get:function(){return this.$translate.instant(this.resources.strings.botcards_adaptiveCard_dynamic_search_loading)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serviceErrorText",{get:function(){return this.$translate.instant(this.resources.strings.botcards_adaptiveCard_dynamic_search_loading_failed)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loginErrorText",{get:function(){return this.$translate.instant(this.resources.strings.botcards_adaptiveCard_dynamic_search_failed_login,{name:this.dynamicSearchProps.appName||"the app"})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rateLimitErrorText",{get:function(){return this.$translate.instant(this.resources.strings.botcards_adaptiveCard_dynamic_search_failed_ratelimit)},enumerable:!0,configurable:!0}),e.prototype.toggleShowDropdown=function(){this.showDropdown=!this.showDropdown},e.prototype.updateDropdownTextAndTitle=function(){var e=this.choiceSetInputElement.find(".o365-multichoice-selector .o365-text-input");if(this.isTypeahead)e.attr("placeholder",this.htmlSanitizer.escapeAngular(this.dropdownDisplayText||this.dropdownPlaceholder));else{var t=e.find(".text");e.attr("title",this.htmlSanitizer.escapeAngular(this.dropdownTooltip)),t.text(this.htmlSanitizer.escapeAngular(this.dropdownDisplayText))}var n=this.isMultiSelect?this.dropdownDisplayText+". "+this.dropdownTooltip:this.dropdownDisplayText;e.attr("aria-label",this.htmlSanitizer.escapeAngular(n))},e.prototype.setupClickHandlerForDropdownArrowButton=function(){var e=this,t=this.choiceSetInputElement.find(".o365-multichoice-selector .o365-dropdown-button");teamspace.common.SafeJQuery.on(this.$scope,t,"click",function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.toggleShowDropdown(),e.$scope.$apply()})},e}();t.ChoiceSetCompact=a},326:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(290),a=function(){function e(){}return e.scrollToBottomForLastItem=function(e,t){var n=e.closest(t),r=e.closest(".ts-message-list");r&&r[0]&&r.find(t).last().is(n)&&r.scrollTop(r[0].scrollHeight)},e.convertAmsUrlToAmsV2Url=function(e,t){return t.getUpdatedUrl(e).then(function(e){return e}).catch(function(){return e})},e.addImagePostProcessingForImages=function(e,t,n,r,i,a,o,s,c){var l=this,p=a.valueAsBoolean(e.settings.names.enableCardImageLazyLoad),d=a.valueAsBoolean(e.settings.names.enableAMSV2UrlDomainsForAdaptiveCards);_.each($(i).find("img"),function(e,i){var a=r.sanitizeHtml($(e).attr("src")||"");s.isAmsImage(a)&&d?l.convertAmsUrlToAmsV2Url(a,o).then(function(a){l.setProcessedImageElement(!0,e,a,i,n,r,p,t)}).catch(function(e){c.log("unable to update to amsV2 image url: ",e)}):l.setProcessedImageElement(!1,e,a,i,n,r,p,t)})},e.colorHostConfigForThemes=function(){var e=teamspace.Constants.Instance,t=i.CardCSSVariables,n={};n[e.themes.default]={containerStyles:{default:{backgroundColor:t.$appWhite.toRGBHexString(),foregroundColors:{default:{default:t.$appGray08.toARGBHexString(),subtle:t.$appGray05.toARGBHexString()},dark:{default:t.$appBlackFull.toRGBHexString(),subtle:t.$appGray08.toARGBHexString()},light:{default:t.$appWhite.toRGBHexString(),subtle:t.$appGray01.toARGBHexString()},accent:{default:t.$appBrand06.toRGBHexString(),subtle:t.$appBrand08.toRGBHexString()},attention:{default:t.$appRed05.toRGBHexString(),subtle:t.$appRed04.toRGBHexString()},good:{default:t.$appGreen06.toRGBHexString(),subtle:t.$appGreen05.toRGBHexString()},warning:{default:t.$appOrange06.toRGBHexString(),subtle:t.$appOrange05.toRGBHexString()}}},emphasis:{backgroundColor:t.$appGray14.toARGBHexString(),foregroundColors:{default:{default:t.$appGray08.toARGBHexString(),subtle:t.$appGray05.toARGBHexString()},dark:{default:t.$appBlackFull.toRGBHexString(),subtle:t.$appGray08.toARGBHexString()},light:{default:t.$appWhite.toRGBHexString(),subtle:t.$appGray01.toARGBHexString()},accent:{default:t.$appBrand06.toRGBHexString(),subtle:t.$appBrand08.toRGBHexString()},attention:{default:t.$appRed05.toRGBHexString(),subtle:t.$appRed04.toRGBHexString()},good:{default:t.$appGreen06.toRGBHexString(),subtle:t.$appGreen05.toRGBHexString()},warning:{default:t.$appOrange06.toRGBHexString(),subtle:t.$appOrange05.toRGBHexString()}}}}},n[e.themes.dark]={containerStyles:{default:{backgroundColor:t.$appGray10Darktheme.toARGBHexString(),foregroundColors:{default:{default:t.$appWhiteDarktheme.toARGBHexString(),subtle:t.$appGray02Darktheme.toARGBHexString()},dark:{default:t.$appBlackFull.toRGBHexString(),subtle:t.$appGray08.toARGBHexString()},light:{default:t.$appWhite.toRGBHexString(),subtle:t.$appGray01.toARGBHexString()},accent:{default:t.$appBrand06Darktheme.toARGBHexString(),subtle:t.$appBrand08Darktheme.toARGBHexString()},attention:{default:t.$appRed02.toARGBHexString(),subtle:t.$appRed01.toARGBHexString()},good:{default:t.$appGreen03.toARGBHexString(),subtle:t.$appGreen02.toARGBHexString()},warning:{default:t.$appOrange03.toARGBHexString(),subtle:t.$appOrange02.toARGBHexString()}}},emphasis:{backgroundColor:t.$appGray14Darktheme.toARGBHexString(),foregroundColors:{default:{default:t.$appWhiteDarktheme.toARGBHexString(),subtle:t.$appGray05.toARGBHexString()},dark:{default:t.$appBlackFull.toRGBHexString(),subtle:t.$appGray08.toARGBHexString()},light:{default:t.$appWhite.toRGBHexString(),subtle:t.$appGray01.toARGBHexString()},accent:{default:t.$appBrand06Darktheme.toARGBHexString(),subtle:t.$appBrand08Darktheme.toARGBHexString()},attention:{default:t.$appRed02.toARGBHexString(),subtle:t.$appRed01.toARGBHexString()},good:{default:t.$appGreen03.toARGBHexString(),subtle:t.$appGreen02.toARGBHexString()},warning:{default:t.$appOrange03.toARGBHexString(),subtle:t.$appOrange02.toARGBHexString()}}}}};var r=t.$appAccTextColor.toARGBHexString(),a=t.$appAccBackgroundColor.toARGBHexString();return n[e.themes.highContrast]={containerStyles:{default:{backgroundColor:a,foregroundColors:{default:{default:r,subtle:r},dark:{default:r,subtle:r},light:{default:r,subtle:r},accent:{default:r,subtle:r},attention:{default:r,subtle:r},good:{default:r,subtle:r},warning:{default:r,subtle:r}}},emphasis:{backgroundColor:a,foregroundColors:{default:{default:r,subtle:r},dark:{default:r,subtle:r},light:{default:r,subtle:r},accent:{default:r,subtle:r},attention:{default:r,subtle:r},good:{default:r,subtle:r},warning:{default:r,subtle:r}}}}},n[e.themes.defaultV2]=n[e.themes.default],n[e.themes.darkV2]=n[e.themes.dark],n[e.themes.tflDefault]=n[e.themes.default],n[e.themes.tflDark]=n[e.themes.dark],n},e.setProcessedImageElement=function(e,t,n,r,i,a,o,s){var c=$(t),l=a.sanitizeHtml(c.attr("style")||""),p=a.sanitizeHtml(c.attr("class")||""),d=c.attr("alt")||"",u=c.attr("aria-label")||"",h=c.parent("ac-inlineAction").length>0,m=s[r]||!1,f=!h&&m;t.onerror=void 0;var v;if((v=angular.element("<img card-image-error />")).attr("src",n),v.attr("style",l),v.attr("class",p),v.attr("alt",d),v.attr("aria-label",u),v.attr("role","button"),v.attr("tabindex",0),o)(v=angular.element("<card-image />")).attr("target-src",n),v.attr("style",l),v.attr("class",p),v.attr("alt",d),v.attr("aria-label",u);else if(f){var g=angular.element("<card-image-expand />");g.attr("action-label",i),g.attr("target-src",n),g.append(v),v=g}c.replaceWith(v)},e.colorThemeConfig=e.colorHostConfigForThemes(),e.createWrappingClass=function(e,t){return function(e){function n(){return e.apply(this,t())||this}return r(n,e),n}(e)},e}();t.AdaptiveCardHelper=a},327:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.getPersonaSetCompactHtmlString=function(e,t,n){var r="";if(!e||!e.length)return r;if(1===e.length)return this.getPersonaCompactHtmlString(!0);if(!t||e.length<=t)r='<div class="ac-persona-container" ng-repeat="persona in personas">'+this.getPersonaCompactHtmlString()+"</div>";else{r='<div class="ac-persona-container" ng-repeat="persona in personas.slice(0, '+(t-1)+')">'+this.getPersonaCompactHtmlString()+"</div>";var i=e.length-t+1;r+='<div class="ac-persona-set-more-personas-container app-font-xsmall-regular" tabIndex="0" role="button" aria-label="'+(n||"")+'" ng-keydown="ctrl.morePersonasIconKeydownHandler($event)" simple-mouseenter="ctrl.morePersonasIconMouseenterHandler($event)" ng-mouseleave="ctrl.morePersonasIconMouseleaveHandler()"><div class="ac-persona-set-more-personas">+'+i+"</div></div>"}return'<div class="ac-persona-set-container">'+r+"</div>"},e.getPersonaCompactHtmlString=function(e){var t=this.getProfilePictureHtmlString();if(!e)return t;return'<div class="ac-persona-container">'+t+'<div class="ac-persona-display-name-container" title="{{persona.displayName}}" ng-bind="::persona.displayName"></div></div>'},e.getProfilePictureHtmlString=function(){return'<div class="ac-persona-profile-picture-container"><profile-picture person-card  principal-name="::persona.upn" display-name="::persona.displayName" size="\'HR20x20\'" css-class="ac-user-picture" src="adaptive-card-persona"></profile-picture></div>'},e}();t.AdaptiveCardComponentUtils=r},328:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=n(44),o=function(e){function t(t,n,r,i,o,s,c,l){var p=e.call(this)||this;p.popupContainerSelector=n,p.localizationService=r,p.ariaLiveService=i,p.$scope=o,p.$compile=s,p.$translate=c,p.resources=l,p.actionPrefix="actionDatepicker";var d=function(e,n){!function(e){e.css("overflow",n?"visible":"")}(e.closest(t))};return o.$on(p.actionPrefix+".show.before",function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.date=t[0].$date||new Date}),o.$on(p.actionPrefix+".show",function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=$(n[0].$element);d(i,!0),a.AdaptiveCardHelper.scrollToBottomForLastItem(i,t),p.narrateDate(),p.narrateDatepickerLabel()}),o.$on(p.actionPrefix+".hide.before",function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];d($(t[0].$element),!1),p.date=t[0].$date}),p}return r(t,e),t.prototype.internalRender=function(){return _.isEmpty(this.defaultValue)||(this.value=this.defaultValue),this.dateInputElement=angular.element(this.getDateInputElement()),this.$scope.ctrl=this,this.$compile(this.dateInputElement)(this.$scope),this.dateInputElement[0]},t.prototype.getJsonTypeName=function(){return"Input.Date"},t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.placeholder=t.placeholder,this.defaultValue=t.value,this.min=t.min,this.max=t.max},t.prototype.isSet=function(){return!!this.value},t.prototype.isValid=function(){if(!this.value)return!this.isRequired;var e=new Date(this.value),t=!0;if(this.min){var n=new Date(this.min);t=t&&e>=n}if(this.max){var r=new Date(this.max);t=t&&e<=r}return t},Object.defineProperty(t.prototype,"value",{get:function(){var e=moment(this.date||null);return e.isValid()?e.format("YYYY-MM-DD"):null},set:function(e){var t=moment(e);this.date=t.isValid()?t.toDate():null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"date",{get:function(){return this.bindingDate},set:function(e){this.$scope.$parent[this.uniqueId]=e,this.bindingDate=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uniqueId",{get:function(){return"id"+this.$scope.$id},enumerable:!0,configurable:!0}),t.prototype.narrateDate=function(){if(this.date){var e=this.localizationService.getDate(this.date,"fullDate");this.ariaLiveService.update(e,!0)}},t.prototype.narrateDatepickerLabel=function(){this.ariaLiveService.update(this.$translate.instant(this.resources.strings.meeting_datepicker_accessible_string),!0)},t.prototype.getDateInputElement=function(){var e="string"==typeof this.min||"number"==typeof this.min?this.min.toString():"",t="string"==typeof this.max||"number"==typeof this.max?this.max.toString():"",n=angular.element("<div />");n.attr("class","ts-ac-dateInputContainer");var r=angular.element("<input bs-datepicker />");r.attr("type","text"),r.attr("class","ac-textInput ac-dateInput"),r.attr("ng-attr-placeholder","{{::ctrl.placeholder || ($root.resources.strings.adaptive_card_input_date_default_placeholder|translate)}}"),r.attr("ng-model",this.uniqueId),r.attr("ng-change","ctrl.narrateDate()"),r.attr("data-autoclose","true"),r.attr("data-min-date",e),r.attr("data-max-date",t),r.attr("data-date-format","mediumDate"),r.attr("data-container",this.popupContainerSelector),r.attr("data-prefix-event",this.actionPrefix),r.attr("data-template-url","components/date-picker/date-picker.html");var i=angular.element('<ng-include src="\'svg/icons-calendar.html\'" class="ts-ac-dateInputIcon"></ng-include>');return n.append(r),n.append(i),n},t}(i.Input);t.DateInput=o},329:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=n(2717),o=function(e){function t(t,n,r,i,a,o,s,c){var l=e.call(this)||this;l.$compile=t,l.$sce=n,l.$scope=r,l.$templateCache=i,l.$translate=a,l.constants=o,l.resources=s,l.passwordStyleEnabled=!1,l.inputStyle="text";var p=o.settings.names.enableAdaptiveCardPasswordInput;return l.passwordStyleEnabled=c.valueAsBoolean(p),l}return r(t,e),Object.defineProperty(t.prototype,"value",{get:function(){var e;return null===(e=this.inputElement)||void 0===e?void 0:e.value},enumerable:!0,configurable:!0}),t.prototype.internalRender=function(){var t=this;this.inputElement=e.prototype.internalRender.call(this),this.inputElement.addEventListener("keydown",function(e){[t.constants.keyCodes.up,t.constants.keyCodes.down].includes(e.keyCode)&&e.stopPropagation()});var n=this.inputElement;switch(this.inputStyle){case"password":if(!this.passwordStyleEnabled||this.isMultiline)return n;n=new a.TextInputPassword(this.$compile,this.$scope,this.inputElement,this.$sce,this.$templateCache,this.$translate,this.resources).internalRender()}return n},t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.inputStyle=t.style?t.style.toLowerCase():this.inputStyle},t}(i.TextInput);t.TextInput=o},330:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=n(44),o=function(e){function t(t,n,r,i,a,o,s){var c=e.call(this)||this;return c.messageListItemClassSelector=t,c.popupContainerSelector=n,c.localizationService=r,c.ariaLiveService=i,c.$scope=a,c.logger=o,c.constants=s,c}return r(t,e),t.convertTimeStringToDate=function(e){return new Date("January 01, 1970 "+e)},t.isValidTimeMinMaxValue=function(e){return"string"==typeof e&&e&&/^[0-9]{2}:[0-9]{2}$/.test(e)},t.prototype.internalRender=function(){var e=this;this.timeInputElement=angular.element(document.createElement("input"));var t=this.timeInputElement[0];return t.type="text",t.classList.add("ac-textInput","ac-timeInput"),t.setAttribute("aria-labelledby","starttimetitle"),t.setAttribute("aria-atomic","true"),t.setAttribute("aria-relevant","all"),this.placeholder&&(t.placeholder=this.placeholder),teamspace.common.SafeJQuery.on(this.$scope,this.timeInputElement,"focus",function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.onTimeFocus()}),!_.isEmpty(this.defaultValue)&&(this.value=this.defaultValue),this.timeInputElement[0]},t.prototype.getJsonTypeName=function(){return"Input.Time"},t.prototype.parse=function(n){e.prototype.parse.call(this,n),this.placeholder=n.placeholder,this.defaultValue=n.value,t.isValidTimeMinMaxValue(n.min)&&(this.min=n.min),t.isValidTimeMinMaxValue(n.max)&&(this.max=n.max)},t.prototype.isSet=function(){return!!this.value},t.prototype.isValid=function(){if(!this.value)return!this.isRequired;var e=t.convertTimeStringToDate(this.value),n=!0;if(this.min){var r=t.convertTimeStringToDate(this.min);n=n&&e>=r}if(this.max){var i=t.convertTimeStringToDate(this.max);n=n&&e<=i}return n},Object.defineProperty(t.prototype,"value",{get:function(){if(this.timeInputElement){var e=this.timeInputElement.val();return this.timeStringFormatConvert(e,t.TimeFormatDisplay,t.TimeFormatHTML5)}return null},set:function(e){var n=this.timeStringFormatConvert(e,t.TimeFormatHTML5,t.TimeFormatDisplay);this.timeInputElement.val(n)},enumerable:!0,configurable:!0}),t.prototype.onTimeFocus=function(){var e=this,t=this.timeInputElement;if(!t.hasClass("ui-timepicker-input")){t.timepicker({showDuration:!0,timeFormat:function(t){return e.localizationService.getDate(t,"shortTime")},appendTo:t.closest(this.popupContainerSelector)});var n=function(t,n){$(t.currentTarget).closest(e.messageListItemClassSelector).css("overflow",n?"visible":"")};teamspace.common.SafeJQuery.on(this.$scope,t,"showTimepicker",function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];n(r[0],!0),a.AdaptiveCardHelper.scrollToBottomForLastItem($(r[0].currentTarget),e.messageListItemClassSelector),e.addDelayedAriaHidden(t),t.on("keydown.adaptiveCardTime",function(t){if(t.which===e.constants.keyCodes.up||t.which===e.constants.keyCodes.down){var n=e.popupContainerSelector+" .ui-timepicker-selected:visible";e.narrateSelectedTime(n)}})}),teamspace.common.SafeJQuery.on(this.$scope,t,"hideTimepicker",function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.data("timepickerList").hide(),n(e[0],!1),t.attr("aria-hidden",""),t.off("keydown.adaptiveCardTime")})}},t.prototype.timeStringFormatConvert=function(e,t,n){var r,i,a,o=/\d{1,2}:\d{1,2}/,s=null!==(i=null===(r=e.match(o))||void 0===r?void 0:r[0])&&void 0!==i?i:"",c=s+" "+(null!==(a=e.replace(s,"").trim())&&void 0!==a?a:""),l=moment(c,t);return l.isValid()&&l.format(n)||null},t.prototype.addDelayedAriaHidden=function(e){var t=this;setTimeout(function(){var n=angular.element(e);n&&n.length>0?n.attr("aria-hidden","true"):t.logger.error("[TimeInput.addDelayedAriaHidden()] Selector did not return any element: {0}",e)},1e3)},t.prototype.narrateSelectedTime=function(e){var t=this;setTimeout(function(){var n=angular.element(e),r=n[n.length-1].innerText;t.ariaLiveService.update(r,!0)})},t.TimeFormatHTML5="HH:mm",t.TimeFormatDisplay="h:mm A",t}(i.Input);t.TimeInput=o},331:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,n,r,i,a,o,s){var c=e.call(this)||this;return c.$translate=n,c.resources=r,c.ariaLiveService=i,c.cardId=a,c.utilityService=o,c.htmlSanitizer=s,c.unselectedSvgHtml=t.get("svg/icons-checkbox-unselected.html"),c.selectedSvgHtml=t.get("svg/icons-checkbox-selected.html"),c}return r(t,e),t.prototype.internalRender=function(){var e=this;this.inputElement=document.createElement("input"),this.inputElement.type="checkbox",this.inputElement.classList.add("check-item"),this.inputElement.name=this.cardId+this.htmlSanitizer.escapeAngular(this.id),this.inputElement.checked=this.defaultValue&&this.valueOn&&this.defaultValue===this.valueOn;var t=angular.element('<div class="icons-item-unselected icon hide-text">'+this.unselectedSvgHtml+"</div>"),n=angular.element('<div class="icons-item-selected icon hide-text">'+this.selectedSvgHtml+"</div>");this.wrap&&(t.find("svg").addClass("wrap"),n.find("svg").addClass("wrap"));var r=this.htmlSanitizer.escapeAngular(this.title),i=this.utilityService.escapeHtml(this.title),a=angular.element(document.createElement("label"));a[0].classList.add("choice-label"),a[0].title=r,a[0].setAttribute("tabindex","-1"),a[0].onfocus=function(){return e.narrateFocusedItem()},a[0].onkeydown=function(t){return e.onkeydown(t)},a.append(this.inputElement),a.append(t),a.append(n),a.append(angular.element("<span ng-non-bindable>"+i+"</span>")),this.addWrapStyling(a);var o=angular.element(document.createElement("div"));return o.addClass("choice-container"),o.append(a),this.rootElement=angular.element(document.createElement("div")),this.rootElement.addClass("o365-action-pane-multichoice-input"),this.rootElement.append(o),this.rootElement.addClass("ac-toggleInput"),this.rootElement[0]},Object.defineProperty(t.prototype,"value",{get:function(){return this.inputElement?this.inputElement.checked?this.valueOn:this.valueOff:null},enumerable:!0,configurable:!0}),t.prototype.addWrapStyling=function(e){this.wrap&&(e.css("overflow-wrap","break-word"),e[0].style.wordBreak="break-word",e[0].style.height="auto",e[0].style.whiteSpace="unset",e[0].style.display="flex",e[0].style.alignItems="center",e[0].style.textAlign="left")},t.prototype.onkeydown=function(e){var t=teamspace.Constants.Instance.keyCodes.enter,n=teamspace.Constants.Instance.keyCodes.space;!e||e.keyCode!==t&&e.keyCode!==n||(this.inputElement&&this.inputElement.click(),this.narrateFocusedItem())},t.prototype.narrateFocusedItem=function(){var e=this.inputElement.checked?this.$translate.instant(this.resources.strings.icons_checkbox_selected):this.$translate.instant(this.resources.strings.icons_checkbox_unselected);e+=". "+this.title,this.ariaLiveService.update(e,!0)},t}(n(7).ToggleInput);t.ToggleInput=i},332:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2718),i=n(58),a=n(7),o=function(){function e(e,t,n,r,i,a,o,s,c,l,p){var d=this;this.$element=e,this.$q=t,this.$scope=n,this.constants=r,this.conversationsService=i,this.peopleService=a,this.atMentionService=o,this.channelService=s,this.eventingService=c,this.settingsService=l,this.loggingService=p,this.scenarioName=this.constants.scenarios.extensibility.bots.peoplePickerInAdaptiveCard.searchScenario,this.UPS_TIMEOUT_IN_MS=1e4,this.logger=p.newLogger("acPeoplePicker"),this.initSearchConfigParameters(),n.$watch("selections",function(){return d.selectionsUpdated()},!0)}return e.$inject=["$element","$q","$scope","constants","conversationsService","peopleService","atMentionService","channelService","eventingService","settingsService","loggingService"],Object.defineProperty(e.prototype,"searchFields",{get:function(){var e=[];return _.isEmpty(this.$scope.searchFields)||(e=this.$scope.searchFields.split(",")),e},enumerable:!0,configurable:!0}),e.prototype.initSearchConfigParameters=function(){this.$scope.searchFields="displayName,email",this.maxSelectionCount=this.settingsService.valueFor(this.constants.settings.names.adaptiveCardPeoplePickerMaxCount),this.isInputReadOnly=!1,this.peoplePickerFilterScenario=teamspace.services.PeoplePickerFor[teamspace.services.PeoplePickerFor.adaptiveCard],this.peoplePickerFilter=new teamspace.services.PeoplePickerFilters(teamspace.services.PeoplePickerFor.adaptiveCard)},e.prototype.searchContacts=function(e,t){var n=this,r=this.searchFields,i=[];return _.isEmpty(t)||t.forEach(function(t){for(var a=!1,o=0;o<r.length&&!(a=a||"string"==typeof t[r[o]]&&"string"==typeof e&&n.checkRegExMatch(t[r[o]],e));o++);a&&i.push(t)}),i},e.prototype.checkRegExMatch=function(e,t){var n=_.escapeRegExp(t);return new RegExp("\\s"+n+"|(^"+n+")","gi").test(e)},e.prototype.doConversationSearch=function(){var e=this.conversationsService.getConversation(this.conversationId);return this.searchUsersInConversation(e)},e.prototype.searchUsersInConversation=function(e){if(e.isChannelConversation()){var t=this.channelService.getParentTeamAndChannelByChannelId(this.conversationId);return this.channel=t.channel,this.team=t.team,this.searchMembersForChannelConversation()}return this.searchMembersForChatConversation(e)},e.prototype.cancelAndCreateNewScenario=function(e){return this.cancelScenario(e),this.loggingService.newScenario(e)},e.prototype.cancelScenario=function(e){var t=this.loggingService.findScenario(e);t&&(t.cancel(),this.loggingService.warn("Adaptive Card People Picker: cancelling the scenario :"+t.id))},e.prototype.searchMembersForChannelConversation=function(){var e=this;this.usersSearchProfilePromise&&(teamspace.services.QCancelable.cancel(this.usersSearchProfilePromise),this.usersSearchProfilePromise=null);var t=this.atMentionService.searchForUserProfileInChannel(this.getTargetId(),this.$scope.searchText,void 0,"ac-people-picker",void 0,!0,void 0,!0,{timeout:this.UPS_TIMEOUT_IN_MS},void 0,this.isSharedChannelContext());this.usersSearchProfilePromise=services.QCancelable.toCancelablePromise(this.$q,t);var n=this.cancelAndCreateNewScenario(this.scenarioName);return n.mark(this.constants.scenarios.extensibility.bots.peoplePickerInAdaptiveCard.searchInitiatedInChannel),this.usersSearchProfilePromise.then(function(t){var r=e.getGuestUserCountFromSearchResults(t);_.isEmpty(t)||(e.logger.info("{0} profiles found for search text {1} during conversation search",t.length,e.$scope.searchText),n.mark(e.constants.scenarios.extensibility.bots.peoplePickerInAdaptiveCard.userProfilesReceivedForContextBasedSearch,{searchQueryLength:e.$scope.searchText.length,resultsCount:t.length})),n.stop({resultCount:t.length,searchQueryLength:e.$scope.searchText.length,guestUserCount:r,searchContext:"Channel",isSharedChannel:e.isSharedChannelContext()});var i=e.searchContacts(e.$scope.searchText,t);return e.addStaticChoices(i),i}).catch(function(t){return n.fail({searchQueryLength:e.$scope.searchText.length,searchContext:"Channel"}),e.$q.reject([])})},e.prototype.getGuestUserCountFromSearchResults=function(e){var t=0;if(e&&e.length>0&&e.length<=20)for(var n=0;n<e.length;n++)e[n].userType===this.constants.userTypes.guest&&t++;return t},e.prototype.searchMembersForChatConversation=function(e){var t=this;this.usersSearchProfilePromise&&(teamspace.services.QCancelable.cancel(this.usersSearchProfilePromise),this.usersSearchProfilePromise=null);var n=e.members.map(function(e){return SkypeX.Services.ChatServiceUtils.getMri(e&&e.id)}),r=this.peopleService.getAllPeopleProfileForConversation(n,this.conversationId,!1,this.constants.scenarios.extensibility.bots.peoplePickerInAdaptiveCard.peoplePicker,this.peoplePickerFilter);this.usersSearchProfilePromise=services.QCancelable.toCancelablePromise(this.$q,r);var i=this.cancelAndCreateNewScenario(this.scenarioName);return i.mark(this.constants.scenarios.extensibility.bots.peoplePickerInAdaptiveCard.searchInitiatedInChat),this.usersSearchProfilePromise.then(function(e){var n=t.getGuestUserCountFromSearchResults(e);_.isEmpty(e)||(t.logger.info("{0} profiles found for search text {1} during conversation search",e.length,t.$scope.searchText),i.mark(t.constants.scenarios.extensibility.bots.peoplePickerInAdaptiveCard.userProfilesReceivedForContextBasedSearch,{searchQueryLength:t.$scope.searchText.length,resultsCount:e.length})),i.stop({resultCount:e.length,searchQueryLength:t.$scope.searchText.length,guestUserCount:n,searchContext:"Chat"});var r=t.searchContacts(t.$scope.searchText,e);return t.addStaticChoices(r),r}).catch(function(e){return i.fail({searchQueryLength:t.$scope.searchText.length,searchContext:"Chat"}),t.$q.reject([])})},e.prototype.addStaticChoices=function(e){var t=this;_.isEmpty(this.choices)||this.choices.forEach(function(n){if(t.checkRegExMatch(n.title,t.$scope.searchText)){var r=t.choiceToUser(n);r&&e.push(r)}})},e.prototype.choiceToUser=function(e){return{objectId:e.value,displayName:e.title,email:e.title,mri:SkypeX.Services.ChatServiceUtils.MriPrefix_SkypeSpacesUser+e.value,type:this.constants.userTypes.static}},e.prototype.getTargetId=function(){return this.isPrivateOrSharedChannelContext()?this.channel.objectId:this.team.objectId},e.prototype.isPrivateOrSharedChannelContext=function(){return this.channel&&(this.channel.channelType===teamspace.services.ChannelType.Private||this.channel.channelType===teamspace.services.ChannelType.Shared)},e.prototype.isSharedChannelContext=function(){return this.channel&&this.channel.channelType===teamspace.services.ChannelType.Shared},e.prototype.selectionsUpdated=function(){this.updateChoices(),this.updateInputBoxState()},e.prototype.updateChoices=function(){var e={choices:this.getSelectedChoices(),choiceSetIdentifier:this.$scope.choiceSetIdentifier};this.eventingService.$emit(this.constants.events.bots.adaptiveCard.peoplePickerContactsUpdated,e)},e.prototype.updateInputBoxState=function(){var e=_.isEmpty(this.$scope.selections)?0:this.$scope.selections.length,t=this.$scope.isMultiSelect;!t&&1===e||t&&e==this.maxSelectionCount?this.setInputElementAsReadOnly(!0):(!t&&0===e||t&&e<this.maxSelectionCount&&this.isInputReadOnly)&&this.setInputElementAsReadOnly(!1)},e.prototype.getSelectedChoices=function(){var e=[];return _.isEmpty(this.$scope.selections)||this.$scope.selections.forEach(function(t){var n=t.displayName?t.displayName:"",r=t.objectId?t.objectId:t.mri?t.mri.split(SkypeX.Services.ChatServiceUtils.MriPrefix_SkypeSpacesUser)[1]:"";e.push(new a.Choice(n,r))}),e},e.prototype.setInputElementAsReadOnly=function(e){void 0===e&&(e=!1);var t=this.$element.find("input[data-tid='peoplePicker']");t&&t.length>0&&t[0]&&(this.isInputReadOnly=e,t[0].readOnly=e,e&&t.blur())},e.prototype.postLink=function(){var e=this;if(!_.isEmpty(this.$scope.selectedUserIds)){var t=[];t=this.$scope.isMultiSelect?this.$scope.selectedUserIds.split(this.$scope.separator):[this.$scope.selectedUserIds],this.resolveSelectedStaticIds(t);var n=[];this.findUnresolvedSelectedIds(t).forEach(function(e){n.push(SkypeX.Services.ChatServiceUtils.MriPrefix_SkypeSpacesUser+e.trim())}),_.isEmpty(n)?this.updateChoices():this.peopleService.getAllPeopleProfile(n,this.constants.scenarios.extensibility.bots.peoplePickerInAdaptiveCard.peoplePicker).then(function(t){_.isEmpty(t)||(e.$scope.selections?e.$scope.selections=e.$scope.selections.concat(t):e.$scope.selections=t),e.updateChoices()})}},e.prototype.fetchAllowedUsers=function(e){switch(this.$scope.searchText=e,this.directorySearchMode){case i.DirectorySearchMode.Conversation:return this.doConversationSearch()}},e.prototype.resolveSelectedStaticIds=function(e){var t=this,n=[],r=[];_.isEmpty(this.choices)||_.isEmpty(e)||(n=this.choices.filter(function(t){return e.indexOf(t.value)>-1})),_.isEmpty(n)||(r=n.map(function(e){return t.choiceToUser(e)}),_.isEmpty(this.$scope.selections)?this.$scope.selections=r:this.$scope.selections=this.$scope.selections.concat(r))},e.prototype.findUnresolvedSelectedIds=function(e){if(!_.isEmpty(this.$scope.selections)){var t=this.$scope.selections.map(function(e){return e.objectId});return e.filter(function(e){return t.indexOf(e)<0})}return e},e}();t.ACPeoplePickerController=o,angular.module("teamspace.adaptiveCardPeoplePicker",[]).directive("acPeoplePicker",function(){return{restrict:"E",scope:{contactSelected:"=?",placeholder:"@",selections:"=?",isMultiSelect:"<?",choiceSetIdentifier:"@?",selectedUserIds:"@?",separator:"@?"},bindToController:{directorySearchMode:"<",conversationId:"=?",choices:"=?"},controllerAs:"acPpCtrl",templateUrl:"lazy-components/adaptive-card/people-picker/adaptive-card-people-picker.html",controller:o,link:function(e,t,n,r){r.postLink()}}}).run(["$templateCache",function(e){e.put("lazy-components/adaptive-card/people-picker/adaptive-card-people-picker.html",r)}])},44:function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(322)),r(n(323)),r(n(326)),r(n(2711)),r(n(328)),r(n(2715)),r(n(2716)),r(n(329)),r(n(330)),r(n(331)),r(n(332))},93:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__decorate||function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(7);t.ACTION_EXECUTE_TYPE="Action.Execute";var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getJsonTypeName=function(){return"Action.Execute"},t.verbProperty=new o.StringProperty(o.Versions.v1_0,"verb"),i([o.property(t.verbProperty),a("design:type",String)],t.prototype,"verb",void 0),t}(o.SubmitAction);t.ExecuteAction=s}},[2707]);