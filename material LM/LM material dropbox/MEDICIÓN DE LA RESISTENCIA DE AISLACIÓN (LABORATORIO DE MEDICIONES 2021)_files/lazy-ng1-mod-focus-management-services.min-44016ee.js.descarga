webpackJsonp([36],{2782:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(2783)},2783:function(e,t,i){"use strict";var r=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=i(2784),n=function(e){function t(t){var i=e.call(this,t)||this;return i.orchestrationService=t,i.initializeOnAppLaunchAndReinit(),i}return r(t,e),t.$inject=["orchestrationService"],t.prototype.initializeOnAppLaunchAndReinit=function(e){},t.prototype.cleanupOnAppTeardown=function(e){},t.prototype.mtmaTelemetryIdentifier=function(){return"FocusManagementService"},t.prototype.createTabster=function(e){return o.createTabster(e)},t.prototype.getObservedElement=function(e){return o.getObservedElement(e)},t.prototype.getCrossOrigin=function(e){return o.getCrossOrigin(e)},t.prototype.disposeTabster=function(e){o.disposeTabster(e)},t}(teamspace.services.MTMABase);t.FocusManagementService=n,angular.module("teamspace.focusManagementService",["teamspace.orchestrationService"]).service("focusManagementService",n)},2784:function(e,t,i){"use strict";function r(e,t){function i(){this.constructor=e}$(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}function o(e,t,i,r){function o(e){return e instanceof i?e:new i(function(t){t(e)})}return new(i||(i=Promise))(function(i,n){function s(e){try{u(r.next(e))}catch(e){n(e)}}function a(e){try{u(r.throw(e))}catch(e){n(e)}}function u(e){e.done?i(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())})}function n(e,t){function i(e){return function(t){return r([e,t])}}function r(i){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,n&&(s=2&i[0]?n.return:i[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(s=u.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){u.label=i[1];break}if(6===i[0]&&u.label<s[1]){u.label=s[1],s=i;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(i);break}s[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],n=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,n,s,a,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}function s(e){var t=e(),i=t.__tabsterInstanceContext;return i||(i={elementByUId:{},basics:{Promise:t.Promise||void 0,WeakRef:t.WeakRef||void 0},containerBoundingRectCache:{},lastContainerBoundingRectCacheId:0,weakElementStorage:{},lastWeakElementId:0,weakCleanupStarted:!1},t.__tabsterInstanceContext=i),i}function a(e,t){var i=s(e);if(t)i.weakElementStorage={};else for(var r=0,o=Object.keys(i.weakElementStorage);r<o.length;r++){var n=o[r],a=i.weakElementStorage[n];i.WeakRef?a.deref()||delete i.weakElementStorage[n]:he.cleanup(a)&&delete i.weakElementStorage[n]}}function u(e){var t=s(e);t.weakCleanupStarted||(t.weakCleanupStarted=!0,t.WeakRef=D(t)),t.weakCleanupTimer||(t.weakCleanupTimer=e().setTimeout(function(){t.weakCleanupTimer=void 0,a(e),u(e)},12e4))}function l(e){var t=s(e);t.weakCleanupStarted=!1,t.weakCleanupTimer&&(e().clearTimeout(t.weakCleanupTimer),t.weakCleanupTimer=void 0,t.weakElementStorage={})}function c(e,t,i){if(t.nodeType===Node.ELEMENT_NODE){var r=ie?i:{acceptNode:i};return e.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,r,!1)}}function d(e,t){var i=t.__tabsterCacheId,r=s(e),o=i?r.containerBoundingRectCache[i]:void 0;if(o)return o.rect;var n=t.ownerDocument&&t.ownerDocument.documentElement;if(!n)return new ue;var a=0,u=0,l=n.clientWidth,c=n.clientHeight;if(t!==n){var d=t.getBoundingClientRect();a=Math.max(a,d.left),u=Math.max(u,d.top),l=Math.min(l,d.right),c=Math.min(c,d.bottom)}var h=new ue(a<l?a:-1,u<c?u:-1,a<l?l-a:0,u<c?c-u:0);return i||(i="r-"+ ++r.lastContainerBoundingRectCacheId,t.__tabsterCacheId=i),r.containerBoundingRectCache[i]={rect:h,element:t},r.containerBoundingRectCacheTimer||(r.containerBoundingRectCacheTimer=window.setTimeout(function(){r.containerBoundingRectCacheTimer=void 0;for(var e=0,t=Object.keys(r.containerBoundingRectCache);e<t.length;e++){var i=t[e];delete r.containerBoundingRectCache[i].element.__tabsterCacheId}r.containerBoundingRectCache={}},50)),h}function h(e,t){var i=f(t);if(i){var r=d(e,i),o=t.getBoundingClientRect();return o.top>=r.top&&o.bottom<=r.bottom}return!1}function p(e,t,i){void 0===i&&(i=0);var r=f(t);if(r){var o=d(e,r),n=t.getBoundingClientRect();return n.left>o.right||n.top>o.bottom||n.bottom<o.top||n.right<o.left?oe.Invisible:n.top+i>=o.top&&n.top<=o.bottom&&n.bottom>=o.top&&n.bottom-i<=o.bottom&&n.left+i>=o.left&&n.left<=o.right&&n.right>=o.left&&n.right-i<=o.right?oe.Visible:oe.PartiallyVisible}return oe.Invisible}function _(e,t,i){var r=f(t);if(r){var o=d(e,r),n=t.getBoundingClientRect();r.scrollTop+=i?n.top-o.top:n.bottom-o.bottom}}function f(e){var t=e.ownerDocument;if(t){for(var i=e.parentElement;i;i=i.parentElement)if(i.scrollWidth>i.clientWidth||i.scrollHeight>i.clientHeight)return i;return t.documentElement}return null}function v(e){e.__shouldIgnoreFocus=!0}function m(e){return!!e.__shouldIgnoreFocus}function b(e){var t=e.focus;t.__tabsterFocus?t.__tabsterFocus.call(e):e.focus()}function g(e){var t=new Uint32Array(4);if(e.crypto&&e.crypto.getRandomValues)e.crypto.getRandomValues(t);else if(e.msCrypto&&e.msCrypto.getRandomValues)e.msCrypto.getRandomValues(t);else for(r=0;r<t.length;r++)t[r]=4294967295*Math.random();for(var i=[],r=0;r<t.length;r++)i.push(t[r].toString(36));return i.push("|"),i.push((++le).toString(36)),i.push("|"),i.push(Date.now().toString(36)),i.join("")}function y(e,t){var i=s(e),r=t.__tabsterElementUID;return r||(r=t.__tabsterElementUID=g(e())),!i.elementByUId[r]&&T(t.ownerDocument,t)&&(i.elementByUId[r]=new pe(e,t)),r}function w(e){var t=e.__tabsterCrossOriginWindowUID;return t||(t=e.__tabsterCrossOriginWindowUID=g(e)),t}function E(e,t){for(var i=s(e),r=0,o=Object.keys(i.elementByUId);r<o.length;r++){var n=o[r],a=i.elementByUId[n],u=a&&a.get();u&&t&&!t.contains(u)||delete i.elementByUId[n]}}function T(e,t){var i;return!!(null===(i=null===e||void 0===e?void 0:e.body)||void 0===i?void 0:i.contains(t))}function F(e,t){var i=e.matches||e.matchesSelector||e.msMatchesSelector||e.webkitMatchesSelector;return i&&i.call(e,t)}function I(e){var t=s(e);if(t.basics.Promise)return t.basics.Promise;throw new Error("No Promise defined.")}function D(e){return e.basics.WeakRef}function O(e,t){var i,r=s(function(){return e});(i="Promise")in t&&(r.basics[i]=t[i]),(i="WeakRef")in t&&(r.basics[i]=t[i])}function C(e,t,i){var r,o=t.__tabsterElementUID,n=o?e.storageEntry(o):void 0,s=(null===n||void 0===n?void 0:n.tabster)||{},a=null===n||void 0===n?void 0:n.attr;if(r=a?a.object:{},Object.keys(i).forEach(function(e){var t=i[e];if(void 0===t)s&&(delete s[e],delete r[e]);else switch(e){case"deloser":s[e]=i.deloser,r[e]=t.getBasicProps();break;case"root":s[e]=i.root,r[e]=t.getBasicProps();break;case"modalizer":s[e]=i.modalizer,r[e]=t.getBasicProps();break;case"focusable":s[e]=r[e]=i.focusable;break;case"groupper":s[e]=i.groupper,r[e]=t.getBasicProps();break;case"uberGroupper":s[e]=i.uberGroupper,r[e]=!0;break;case"observed":s[e]=r[e]=i.observed;break;case"outline":s[e]=r[e]=i.outline;break;default:throw new Error("Unknown Tabster part.")}}),0===Object.keys(s).length)o&&n&&(delete n.tabster,delete n.attr,e.storageEntry(o,!1)),t.removeAttribute(ee);else{var u=JSON.stringify(r);n||(o||(o=y(e.getWindow,t)),n=e.storageEntry(o,!0)),n.tabster=s,n.attr={string:u,object:r,changing:!0},a&&a.string===u||t.setAttribute(ee,n.attr.string),n.attr.changing=!1}}function k(e,t){var i,r=t.__tabsterElementUID;return r?null===(i=e.storageEntry(r))||void 0===i?void 0:i.tabster:void 0}function N(e,t){var i,r=t.getAttribute(ee),o=e,n=t.__tabsterElementUID,s=n?o.storageEntry(n):void 0,a=null===s||void 0===s?void 0:s.attr,u=null===s||void 0===s?void 0:s.tabster;if(r){if(r!==(a&&a.string))try{var l=JSON.parse(r);if("object"!=typeof l)throw new Error("Value is not a JSON object, got '"+r+"'.");a={string:r,object:l,changing:!1}}catch(e){}}else u&&(a=void 0);for(var c=(null===(i=null===s||void 0===s?void 0:s.attr)||void 0===i?void 0:i.object)||{},d=a&&a.object||{},h=0,p=Object.keys(c);h<p.length;h++)if(!d[v=p[h]])switch(v){case"deloser":o.deloser&&o.deloser.remove(t);break;case"root":e.root.remove(t);break;case"modalizer":o.modalizer&&o.modalizer.remove(t);break;case"focusable":e.focusable.setProps(t,null);break;case"groupper":e.focusable.removeGroupper(t);break;case"uberGroupper":break;case"observed":o.observedElement&&o.observedElement.remove(t);break;case"outline":o.outline&&o.outline.setProps(t,null)}for(var _=0,f=Object.keys(d);_<f.length;_++){var v=f[_];switch(v){case"deloser":u&&u.deloser?u.deloser.setProps(d.deloser):(o.deloser&&o.deloser.add(t,d.deloser),o.deloser);break;case"root":u&&u.root?u.root.setProps(d.root):e.root.add(t);break;case"modalizer":u&&u.modalizer?u.modalizer.setProps(d.modalizer):(o.modalizer&&o.modalizer.add(t,d.modalizer),o.modalizer);break;case"focusable":e.focusable.setProps(t,d.focusable||null);break;case"groupper":u&&u.groupper?u.groupper.setProps(d.groupper):e.focusable.addGroupper(t,d.groupper);break;case"uberGroupper":break;case"observed":o.observedElement&&(u&&u.observed?o.observedElement.setProps(t,d.observed):o.observedElement.add(t,d.observed));break;case"outline":o.outline&&o.outline.setProps(t,d.outline||null);break;default:delete d[v],console.error("Unknown key '"+v+"' in data-tabster attribute value.")}}a&&(a.object=d,a.string=JSON.stringify(d),a.changing=!0,s||(n||(n=y(e.getWindow,t)),s=e.storageEntry(n,!0)),s.attr=a,a.string!==r&&t.setAttribute(ee,a.string),a.changing=!1)}function x(e,t,i,r){var o=y(e.getWindow,t),n=e.storageEntry(o,!0);if(!n.aug){if(void 0===r)return;n.aug={}}if(void 0===r){if(i in n.aug){var s=n.aug[i];delete n.aug[i],null===s?t.removeAttribute(i):t.setAttribute(i,s)}}else i in n.aug||(n.aug[i]=t.getAttribute(i)),null===r?t.removeAttribute(i):t.setAttribute(i,r);void 0===r&&0===Object.keys(n.aug).length&&(delete n.aug,e.storageEntry(o,!1))}function P(e,t,i){if("undefined"==typeof MutationObserver)return function(){};var r=new MutationObserver(function(r){function o(t,i,r){n(t,i,r);var o=c(e,t,function(e){return n(e,i,r)});if(o)for(;o.nextNode(););}function n(e,r,o){if(!e.getAttribute)return NodeFilter.FILTER_SKIP;var n=e.__tabsterElementUID;if(n){var c=t.getWindow,h=s(c);r?delete h.elementByUId[n]:o&&(h.elementByUId[n]=new pe(c,e))}var p=k(t,e);return p?(p.root&&a(p.root,r,o),p.modalizer&&u(p.modalizer,r,o),p.groupper&&l(e,p.groupper,r,o),p.observed&&d(e,r,o)):e.getAttribute(ee)&&i(t,e),NodeFilter.FILTER_SKIP}function a(e,t,i){var r=p[e.uid];r||(r=p[e.uid]={root:e}),t&&(r.removedFrom=t),i&&(r.addedTo=i)}function u(e,t,i){var r=_[e.internalId];r||(r=_[e.internalId]={modalizer:e}),t&&(r.removedFrom=t),i&&(r.addedTo=i)}function l(e,t,i,r){var o=f[t.id];o||(o=f[t.id]={groupper:t}),i&&(o.removedFrom=i),r&&(o.addedTo=r)}function d(i,r,o){if(e.defaultView){var n=y(t.getWindow,i),s=v[n];s||(s=v[n]={element:i}),r&&(s.removedFrom=r),o&&(s.addedTo=o)}}for(var h,p={},_={},f={},v={},m=0,b=r;m<b.length;m++){var g=b[m],w=g.target,E=g.removedNodes,T=g.addedNodes;if("attributes"===g.type){if(g.attributeName===ee){var F=w.__tabsterElementUID,I=F?null===(h=t.storageEntry(F))||void 0===h?void 0:h.attr:void 0;I&&I.changing||i(t,w)}}else{var D=k(t,w),O=D&&D.root;O&&(p[O.uid]={root:O,addedTo:w});for(C=0;C<E.length;C++)o(E[C],w.ownerDocument||e);for(var C=0;C<T.length;C++)o(T[C],void 0,w)}}for(var N=0,x=Object.keys(p);N<x.length;N++){var P=x[N],R=p[P];R.removedFrom&&U(R.removedFrom,{root:R.root,removed:!0,isMutation:!0}),R.addedTo&&U(R.addedTo,{root:R.root,removed:!1,isMutation:!0})}for(var z=0,M=Object.keys(_);z<M.length;z++){var P=M[z],S=_[P];S.removedFrom&&U(S.removedFrom,{modalizer:S.modalizer,removed:!0,isMutation:!0}),S.addedTo&&U(S.addedTo,{modalizer:S.modalizer,removed:!1,isMutation:!0})}for(var L=0,A=Object.keys(f);L<A.length;L++){var P=A[L],G=f[P];G.removedFrom&&!G.addedTo&&U(G.removedFrom,{groupper:G.groupper,removed:!0,isMutation:!0}),G.addedTo&&U(G.addedTo,{groupper:G.groupper,removed:!1,isMutation:!0})}for(var B=0,V=Object.keys(v);B<V.length;B++){var P=V[B],j=v[P];j.removedFrom&&!j.addedTo&&U(j.removedFrom,{observed:j.element,removed:!0,isMutation:!0}),j.addedTo&&U(j.addedTo,{observed:j.element,removed:!1,isMutation:!0})}});return r.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:[ee]}),function(){r.disconnect()}}function U(e,t){var i=document.createEvent("HTMLEvents");i.initEvent(me,!0,!0),i.details=t,e.dispatchEvent(i)}function R(e){var t=function(t){var i=t.details.root,r=e().__tabsterInstance;r&&i&&(t.details.removed?delete r.root.rootById[i.uid]:r.root.rootById[i.uid]=i)};return e().document.addEventListener(me,t),function(){e().document.removeEventListener(me,t)}}function z(e,t,i){var r=[],o=/(:|\.|\[|\]|,|=|@)/g;e.id&&r.push("#"+e.id.replace(o,"\\$1")),!1!==t&&e.className&&e.className.split(" ").forEach(function(e){(e=e.trim())&&r.push("."+e.replace(o,"\\$1"))});var n,s=0;if(!1!==i&&0===r.length){for(n=e;n;)s++,n=n.previousElementSibling;r.unshift(":nth-child("+s+")")}return r.unshift(e.tagName.toLowerCase()),r.join("")}function M(e){if(T(e.ownerDocument,e)){for(var t=[z(e)],i=e.parentElement;i;){var r="BODY"===i.tagName;if(t.unshift(z(i,!1,!r)),r)break;i=i.parentElement}return t.join(" ")}}function S(e,t,i){var r=i.getElement();if(r){var o=y(e,r);return t.deloserByUId[o]||(t.deloserByUId[o]=i),o}}function L(e){var t=e.HTMLElement,i=t.prototype.focus,r=!1;return t.prototype.focus=function(){r=!0},e.document.createElement("button").focus(),t.prototype.focus=i,r}function A(e,t){var i=e.createElement("style");return i.type="text/css",i.appendChild(e.createTextNode(G(t))),e.head.appendChild(i),i}function G(e){return"\n."+e.areaClass+" *, ."+e.areaClass+" *:focus {\noutline: none !important;\n}\n\n."+e.outlineClass+" {\ndisplay: none;\nposition: absolute;\nwidth: 0;\nheight: 0;\nleft: 0;\ntop: 0;\nz-index: "+e.zIndex+";\n}\n\n."+e.outlineClass+"."+e.outlineClass+"_visible {\ndisplay: block;\n}\n\n."+e.outlineClass+"__left,\n."+e.outlineClass+"__top,\n."+e.outlineClass+"__right,\n."+e.outlineClass+"__bottom {\nposition: absolute;\nbackground: inherit;\n}"}function B(e){st.forceCleanup(e)}function V(e,t){var i=X(e);if(i)return i;var r=new st(e,t);return e.__tabsterInstance=r,r}function j(e){var t=e;if(!t.outline){var i=new nt(e);t.outline=i,t.outlineDispose=function(){nt.dispose(i)}}return t.outline}function W(e,t){var i=e;if(!i.deloser){var r=new De(e,t);i.deloser=r,i.deloserDispose=function(){De.dispose(r)}}return i.deloser}function K(e){var t=e;if(!t.modalizer){var i=new et(e);t.modalizer=i,t.modalizerDispose=function(){et.dispose(i)}}return t.modalizer}function H(e){var t=e;if(!t.observedElement){var i=new tt(e);t.observedElement=i,t.observedElementDispose=function(){tt.dispose(i)}}return t.observedElement}function q(e){var t=e;if(!t.crossOrigin){W(e),j(e),H(e);var i=new je(e);t.crossOrigin=i,t.crossOriginDispose=function(){je.dispose(i)}}return t.crossOrigin}function J(e){st.dispose(e)}function Y(e,t){var i,r=null===e?void 0:JSON.stringify(e);return!0===t?r:(i={},i[ee]=r,i)}function X(e){return e.__tabsterInstance}Object.defineProperty(t,"__esModule",{value:!0});var $=function(e,t){return($=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},Q=function(){return(Q=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)};i.d(t,"Types",function(){return ae}),i.d(t,"createTabster",function(){return V}),i.d(t,"disposeTabster",function(){return J}),i.d(t,"forceCleanup",function(){return B}),i.d(t,"getCrossOrigin",function(){return q}),i.d(t,"getCurrentTabster",function(){return X}),i.d(t,"getDeloser",function(){return W}),i.d(t,"getModalizer",function(){return K}),i.d(t,"getObservedElement",function(){return H}),i.d(t,"getOutline",function(){return j}),i.d(t,"getTabsterAttribute",function(){return Y}),i.d(t,"overrideBasics",function(){return O});var Z,ee="data-tabster",te={History:0,DeloserDefault:1,RootDefault:2,DeloserFirst:3,RootFirst:4};!function(e){e[e.Tab=0]="Tab",e[e.Arrows=1]="Arrows",e[e.Both=2]="Both"}(Z||(Z={}));var ie,re={Horizontal:0,Vertical:1},oe={Invisible:0,PartiallyVisible:1,Visible:2},ne={Unlimited:0,Limited:1,LimitedTrapFocus:2},se={Both:0,Vertical:1,Horizontal:2,Grid:3},ae={__proto__:null,TabsterAttributeName:ee,RestoreFocusOrders:te,get MoverKeys(){return Z},MoverAxis:re,ElementVisibilities:oe,GroupperFocusLimits:ne,GroupperNextDirections:se},ue="undefined"!=typeof DOMRect?DOMRect:function(){return function(e,t,i,r){this.left=e||0,this.top=t||0,this.right=(e||0)+(i||0),this.bottom=(t||0)+(r||0)}}(),le=0;try{document.createTreeWalker(document,NodeFilter.SHOW_ELEMENT),ie=!1}catch(e){ie=!0}var ce,de,he=function(){function e(e){this._target=e}return e.prototype.deref=function(){return this._target},e.cleanup=function(e){return!e._target||!T(e._target.ownerDocument,e._target)&&(delete e._target,!0)},e}(),pe=function(){function e(e,t,i){var r=s(e);this._ctx=r,this._id="we"+ ++r.lastWeakElementId,r.weakElementStorage[this._id]=r.WeakRef?new r.WeakRef(t):new he(t),void 0!==i&&(this._data=i)}return e.prototype.get=function(){var e=this._ctx.weakElementStorage[this._id],t=e&&e.deref();return e&&!t&&delete this._ctx.weakElementStorage[this._id],t},e.prototype.getData=function(){return this._data},e}(),_e={Tab:9,Enter:13,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40},fe=function(){function e(){this._callbacks=[]}return e.prototype.dispose=function(){this._callbacks=[],delete this._val},e.prototype.subscribe=function(e){this._callbacks.indexOf(e)<0&&this._callbacks.push(e)},e.prototype.unsubscribe=function(e){var t=this._callbacks.indexOf(e);t>=0&&this._callbacks.splice(t,1)},e.prototype.setVal=function(e,t){this._val!==e&&(this._val=e,this._callCallbacks(e,t))},e.prototype.getVal=function(){return this._val},e.prototype.trigger=function(e,t){this._callCallbacks(e,t)},e.prototype._callCallbacks=function(e,t){this._callbacks.forEach(function(i){return i(e,t)})},e}(),ve=function(e){function t(t,i){var r=e.call(this)||this;return r._isMouseUsed=!1,r._init=function(){r._initTimer=void 0;var e=r._win();e.document.body.addEventListener("mousedown",r._onMouseDown,!0),e.addEventListener("keydown",r._onKeyDown,!0),r._tabster.focusedElement.subscribe(r._onFocus)},r._onMouseDown=function(e){0===e.buttons||0===e.clientX&&0===e.clientY&&0===e.screenX&&0===e.screenY||(r._isMouseUsed=!0,r.setVal(!1,void 0))},r._onKeyDown=function(e){var t=r.isNavigatingWithKeyboard();t||e.keyCode!==_e.Tab?t&&e.keyCode===_e.Esc&&r._scheduleDismiss():r.setVal(!0,void 0)},r._onFocus=function(e,t){e&&(r._isMouseUsed?r._isMouseUsed=!1:r.isNavigatingWithKeyboard()||t.relatedTarget&&(t.isFocusedProgrammatically||void 0===t.isFocusedProgrammatically||r.setVal(!0,void 0)))},r._tabster=t,r._win=i,r._initTimer=i().setTimeout(r._init,0),r}return r(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this);var t=this._win();this._initTimer&&(t.clearTimeout(this._initTimer),this._initTimer=void 0),this._dismissTimer&&(t.clearTimeout(this._dismissTimer),this._dismissTimer=void 0),t.document.body.removeEventListener("mousedown",this._onMouseDown,!0),t.removeEventListener("keydown",this._onKeyDown,!0),this._tabster.focusedElement.unsubscribe(this._onFocus)},t.dispose=function(e){e.dispose()},t.prototype.isNavigatingWithKeyboard=function(){return this.getVal()||!1},t.prototype._scheduleDismiss=function(){var e=this,t=this._win();this._dismissTimer&&(t.clearTimeout(this._dismissTimer),this._dismissTimer=void 0);var i=this._tabster.focusedElement.getFocusedElement();this._dismissTimer=t.setTimeout(function(){e._dismissTimer=void 0;var t=e._tabster.focusedElement.getFocusedElement();i&&t&&i===t&&e.setVal(!1,void 0)},500)},t.setVal=function(e,t){e.setVal(t,void 0)},t}(fe),me="tabster:mutation-event",be=function(){function e(e,t,i,r,o){this._knownModalizers={},this.uid=y(i,e),this._element=new pe(i,e),this._tabster=t,this._win=i,this._basic=o||{},this._forgetFocusedGrouppers=r,this._dummyInputFirst={isFirst:!0},this._dummyInputLast={isFirst:!1},this._createDummyInput(this._dummyInputFirst),this._createDummyInput(this._dummyInputLast),this._add(),this._addDummyInputs()}return e.prototype.dispose=function(){this._updateModalizersTimer&&(this._win().clearTimeout(this._updateModalizersTimer),this._updateModalizersTimer=void 0),this._remove();var e=this._dummyInputFirst;e&&(this._disposeDummyInput(e),delete this._dummyInputFirst);var t=this._dummyInputLast;t&&(this._disposeDummyInput(t),delete this._dummyInputLast),this._knownModalizers={},this._forgetFocusedGrouppers=function(){}},e.prototype.setProps=function(e){e?this._basic=Q(Q({},this._basic),e):null===e&&(this._basic={})},e.prototype.getBasicProps=function(){return this._basic},e.prototype.move=function(e){this._remove(),this._element=new pe(this._win,e),this._add(),this.updateModalizers()},e.prototype.getElement=function(){return this._element.get()},e.prototype.getCurrentModalizerId=function(){return this._curModalizerId},e.prototype.setCurrentModalizerId=function(e,t){this._curModalizerId=e,t||this.updateModalizers()},e.prototype.getModalizers=function(){for(var e=[],t=0,i=Object.keys(this._knownModalizers);t<i.length;t++){var r=i[t];e.push(this._knownModalizers[r])}return e},e.prototype.getModalizerById=function(e){return this._knownModalizers[e]},e.prototype.updateModalizers=function(){var e=this;this._updateModalizersTimer||(this.updateDummyInputs(),this._updateModalizersTimer=this._win().setTimeout(function(){e._updateModalizersTimer=void 0,e._reallyUpdateModalizers()},0))},e.prototype.updateDummyInputs=function(){this._addDummyInputs()},e.prototype.moveOutWithDefaultAction=function(e){var t,i;(null===(t=this._dummyInputFirst)||void 0===t?void 0:t.input)&&(null===(i=this._dummyInputLast)||void 0===i?void 0:i.input)&&(e?(this._dummyInputFirst.shouldMoveOut=!0,b(this._dummyInputFirst.input)):(this._dummyInputLast.shouldMoveOut=!0,b(this._dummyInputLast.input)))},e.prototype._add=function(){},e.prototype._remove=function(){this._removeDummyInputs()},e.prototype._reallyUpdateModalizers=function(){var e=this,t=this._element.get(),i=null===t||void 0===t?void 0:t.ownerDocument;if(t&&i){var r=[],o=c(i,t,function(t){var i=k(e._tabster,t);return i&&i.modalizer?(r.push(i.modalizer),NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_SKIP});if(o)for(;o.nextNode(););for(var n=void 0===this._curModalizerId,s=!1,a={},u=0;u<r.length;u++){var l=(h=(d=r[u]).userId)===this._curModalizerId;!n&&l&&(n=!!d.getBasicProps().isOthersAccessible),l&&(s=!0),a[h]=d}s||this.setCurrentModalizerId(void 0,!0),this._knownModalizers=a;for(u=0;u<r.length;u++){var d=r[u],h=d.userId,p=void 0===this._curModalizerId||h===this._curModalizerId;d.setActive(p),d.setAccessible(d.getBasicProps().isAlwaysAccessible||n||p)}}},e.prototype._createDummyInput=function(e){var t=this;if(!e.input){var i=this._win().document.createElement("div");i.tabIndex=0,i.setAttribute("role","none"),i.setAttribute("aria-hidden","true");var r=i.style;r.position="fixed",r.width=r.height="1px",r.left=r.top="-100500px",r.opacity="0",r.zIndex="-1",v(i),e.input=i,e.focusin=function(i){var r;if(e.shouldMoveOut);else{ve.setVal(t._tabster.keyboardNavigation,!0),t._forgetFocusedGrouppers();var o=t._element.get(),n=void 0;(n=o?e.isFirst?t._tabster.focusable.findFirst(o):t._tabster.focusable.findLast(o):null)?t._tabster.focusedElement.focus(n):null===(r=e.input)||void 0===r||r.blur()}},e.focusout=function(t){e.shouldMoveOut=!1},i.addEventListener("focusin",e.focusin),i.addEventListener("focusout",e.focusout)}},e.prototype._disposeDummyInput=function(e){var t=e.input;if(t){delete e.input;var i=e.focusin;i&&(t.removeEventListener("focusin",i),delete e.focusin);var r=e.focusout;r&&(t.removeEventListener("focusout",r),delete e.focusout)}},e.prototype._addDummyInputs=function(){var e,t,i=this._element.get(),r=null===(e=this._dummyInputFirst)||void 0===e?void 0:e.input,o=null===(t=this._dummyInputLast)||void 0===t?void 0:t.input;if(i&&r&&o){i.lastElementChild!==o&&i.appendChild(o);var n=i.firstElementChild;n&&n!==r&&i.insertBefore(r,n)}},e.prototype._removeDummyInputs=function(){var e,t,i=null===(e=this._dummyInputFirst)||void 0===e?void 0:e.input,r=null===(t=this._dummyInputLast)||void 0===t?void 0:t.input;(null===i||void 0===i?void 0:i.parentElement)&&i.parentElement.removeChild(i),(null===r||void 0===r?void 0:r.parentElement)&&r.parentElement.removeChild(r)},e}(),ge=function(){function e(t,i,r){var o=this;this.rootById={},this._init=function(){o._initTimer=void 0,o._win().document.addEventListener(me,o._onMutation),o._unobserve=R(o._win)},this._onMutation=function(t){var i=t.details,r=i.root;if(r&&(i.removed?i.isMutation&&r.dispose():r.getElement()===t.target&&r.updateDummyInputs()),t.target&&i.modalizer){var n=e._getRootOnly(o._tabster,t.target);n&&n.updateModalizers()}},this._tabster=t,this._win=t.getWindow,this._forgetFocusedGrouppers=i,this._initTimer=this._win().setTimeout(this._init,0),this._autoRoot=r}return e.prototype.dispose=function(){var e=this._win();this._autoRootInstance&&(this._autoRootInstance.dispose(),delete this._autoRootInstance,delete this._autoRoot),this._initTimer&&(e.clearTimeout(this._initTimer),this._initTimer=void 0),e.document.removeEventListener(me,this._onMutation),this._unobserve&&(this._unobserve(),delete this._unobserve),this._forgetFocusedGrouppers=function(){},this.rootById={}},e.dispose=function(e){e.dispose()},e.prototype.add=function(e,t){var i=k(this._tabster,e);if(!i||!i.root){var r=new be(e,this._tabster,this._win,this._forgetFocusedGrouppers,t);C(this._tabster,e,{root:r}),U(e,{root:r})}},e.prototype.remove=function(e){var t=k(this._tabster,e),i=t&&t.root;i&&(U(e,{root:i,removed:!0}),C(this._tabster,e,{root:void 0}),i.dispose())},e.prototype.move=function(e,t){var i=k(this._tabster,e),r=i&&i.root;r&&(r.move(t),C(this._tabster,t,{root:r}),C(this._tabster,e,{root:void 0}),U(e,{root:r,removed:!0}),U(t,{root:r}))},e.prototype.setProps=function(e,t){var i=k(this._tabster,e);i&&i.root&&i.root.setProps(t)},e._getRootOnly=function(e,t){for(var i=t;i;i=i.parentElement){var r=k(e,i);if(r&&r.root)return r.root}},e.getRootByUId=function(e,t){var i=e().__tabsterInstance;return i&&i.root.rootById[t]},e.getTabsterContext=function(e,t,i){var r,o;if(void 0===i&&(i={}),t.ownerDocument){for(var n,s,a,u,l,c,d=!1,h=t;h&&(!n||i.checkRtl);){var p=k(e,h);if(p){!a&&p.groupper&&(a=p.groupper);var _=null===(r=p.focusable)||void 0===r?void 0:r.mover;void 0!==_&&void 0===l&&((l=_).navigationType!==Z.Arrows&&l.navigationType!==Z.Both||(u=h,c=!!a)),!s&&p.modalizer&&(s=p.modalizer),p.root&&(n=p.root),"rtl"===h.getAttribute("dir")&&(d=!0),h=h.parentElement}else h=h.parentElement}if(!n&&e.root._autoRoot){var f=e.root;if(!f._autoRootInstance){var v=null===(o=t.ownerDocument)||void 0===o?void 0:o.body;v&&(f._autoRootInstance=new be(v,f._tabster,f._win,f._forgetFocusedGrouppers,f._autoRoot))}n=f._autoRootInstance}return n?{root:n,modalizer:s,groupper:a,mover:u,moverOptions:l,isGroupperFirst:c,isRtl:i.checkRtl?d:void 0}:void 0}},e}(),ye=function(){return function(){}}(),we=function(e){function t(t,i){var r=e.call(this)||this;return r.uid=i.uid,r._tabster=t,r._deloser=i,r}return r(t,e),t.prototype.belongsTo=function(e){return e===this._deloser},t.prototype.unshift=function(e){this._deloser.unshift(e)},t.prototype.focusAvailable=function(){return o(this,void 0,void 0,function(){var e;return n(this,function(t){return e=this._deloser.findAvailable(),[2,!!e&&this._tabster.focusedElement.focus(e)]})})},t.prototype.resetFocus=function(){return o(this,void 0,void 0,function(){var e;return n(this,function(t){return e=this._tabster.getWindow,[2,I(e).resolve(this._deloser.resetFocus())]})})},t}(ye),Ee=function(){function e(e,t){this._history=[],this._tabster=e,this.rootUId=t}return e.prototype.getLength=function(){return this._history.length},e.prototype.removeDeloser=function(e){this._history=this._history.filter(function(t){return!t.belongsTo(e)})},e.prototype.hasDeloser=function(e){return this._history.some(function(t){return t.belongsTo(e)})},e}(),Te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.unshiftToDeloser=function(e,t){for(var i,r=0;r<this._history.length;r++)if(this._history[r].belongsTo(e)){i=this._history[r],this._history.splice(r,1);break}i||(i=new we(this._tabster,e)),i.unshift(t),this._history.unshift(i),this._history.splice(10,this._history.length-10)},t.prototype.focusAvailable=function(e){return o(this,void 0,void 0,function(){var t,i,r,o,s,a,u,l,c,d,h,p,_,f,v,m;return n(this,function(n){switch(n.label){case 0:t=!!e,i=0,r=this._history,n.label=1;case 1:return i<r.length?(o=r[i],e&&o.belongsTo(e)&&(t=!1),(s=!t)?[4,o.focusAvailable()]:[3,3]):[3,5];case 2:s=n.sent(),n.label=3;case 3:if(s)return[2,!0];n.label=4;case 4:return i++,[3,1];case 5:if(a=this._tabster.getWindow,u=ge.getRootByUId(a,this.rootUId),!(l=u&&u.getModalizers()))return[3,10];c=0,d=l,n.label=6;case 6:return c<d.length?(h=d[c],p=h.getElement(),_=p&&k(this._tabster,p),f=_&&_.deloser,v=f&&new we(this._tabster,f),(m=v)?[4,v.focusAvailable()]:[3,8]):[3,10];case 7:m=n.sent(),n.label=8;case 8:if(m)return[2,!0];n.label=9;case 9:return c++,[3,6];case 10:return[2,!1]}})})},t.prototype.resetFocus=function(e){return o(this,void 0,void 0,function(){var t,i,r,o,s,a,u,l,c,d,h,p,_,f,v,m,b;return n(this,function(n){switch(n.label){case 0:for(t=!!e,i={},r=0,o=this._history;r<o.length;r++)s=o[r],e&&s.belongsTo(e)&&(t=!1),t||i[s.uid]||(i[s.uid]=s);if(a=this._tabster.getWindow,u=ge.getRootByUId(a,this.rootUId),l=u&&u.getModalizers())for(c=0,d=l;c<d.length;c++)h=d[c],p=h.getElement(),_=p&&k(this._tabster,p),!(f=_&&_.deloser)||f.uid in i||(i[f.uid]=new we(this._tabster,f));v=0,m=Object.keys(i),n.label=1;case 1:return v<m.length?(b=m[v],[4,i[b].resetFocus()]):[3,4];case 2:if(n.sent())return[2,!0];n.label=3;case 3:return v++,[3,1];case 4:return[2,!1]}})})},t}(Ee),Fe=function(){function e(e){this._history=[],this._tabster=e}return e.prototype.dispose=function(){this._history=[]},e.prototype.process=function(e){var t=this,i=ge.getTabsterContext(this._tabster,e),r=i&&i.root.uid,o=De.getDeloser(this._tabster,e);if(r&&o){var n=this.make(r,function(){return new Te(t._tabster,r)});return i&&i.modalizer&&i.root.getCurrentModalizerId()!==i.modalizer.userId||n.unshiftToDeloser(o,e),o}},e.prototype.make=function(e,t){for(var i,r=0;r<this._history.length;r++){var o=this._history[r];if(o.rootUId===e){i=o,this._history.splice(r,1);break}}return i||(i=t()),this._history.unshift(i),this._history.splice(10,this._history.length-10),i},e.prototype.removeDeloser=function(e){this._history.forEach(function(t){t.removeDeloser(e)}),this._history=this._history.filter(function(e){return e.getLength()>0})},e.prototype.focusAvailable=function(e){return o(this,void 0,void 0,function(){var t,i,r,o,s;return n(this,function(n){switch(n.label){case 0:t=!!e,i=0,r=this._history,n.label=1;case 1:return i<r.length?(o=r[i],e&&o.hasDeloser(e)&&(t=!1),(s=!t)?[4,o.focusAvailable(e)]:[3,3]):[3,5];case 2:s=n.sent(),n.label=3;case 3:if(s)return[2,!0];n.label=4;case 4:return i++,[3,1];case 5:return[2,!1]}})})},e.prototype.resetFocus=function(e){return o(this,void 0,void 0,function(){var t,i,r,o,s;return n(this,function(n){switch(n.label){case 0:t=!!e,i=0,r=this._history,n.label=1;case 1:return i<r.length?(o=r[i],e&&o.hasDeloser(e)&&(t=!1),(s=!t)?[4,o.resetFocus(e)]:[3,3]):[3,5];case 2:s=n.sent(),n.label=3;case 3:if(s)return[2,!0];n.label=4;case 4:return i++,[3,1];case 5:return[2,!1]}})})},e}(),Ie=function(){function e(e,t,i,r,o){var n=this;this._isActive=!1,this._history=[[]],this._snapshotIndex=0,this.isActive=function(){return n._isActive},this.setSnapshot=function(e){n._snapshotIndex=e,n._history.length>e+1&&n._history.splice(e+1,n._history.length-e-1),n._history[e]||(n._history[e]=[])},this.focusFirst=function(){var e=n._element.get();return!!e&&n._tabster.focusedElement.focusFirst(e)},this.focusDefault=function(){var e=n._element.get();return!!e&&n._tabster.focusedElement.focusDefault(e)},this.resetFocus=function(){var e=n._element.get();return!!e&&n._tabster.focusedElement.resetFocus(e)},this.clearHistory=function(e){var t=n._element.get();n._history[n._snapshotIndex]=t?n._history[n._snapshotIndex].filter(function(i){var r=i.get();return!(!r||!e)&&t.contains(r)}):[]},this.uid=y(i,e),this._win=i,this._tabster=t,this._element=new pe(i,e),this._basic=r||{},this._extended=o||{}}return e.prototype.setProps=function(e,t){e?this._basic=Q(Q({},this._basic),e):null===e&&(this._basic={}),t?this._extended=Q(Q({},this._extended),t):null===t&&(this._extended={})},e.prototype.getBasicProps=function(){return this._basic},e.prototype.move=function(e){this._remove(),this._element=new pe(this._win,e)},e.prototype.dispose=function(){this._remove(),this._isActive=!1,this._snapshotIndex=0,this._basic={},this._extended={},this._history=[]},e.prototype.setActive=function(e){this._isActive=e},e.prototype.getActions=function(){return{focusDefault:this.focusDefault,focusFirst:this.focusFirst,resetFocus:this.resetFocus,clearHistory:this.clearHistory,setSnapshot:this.setSnapshot,isActive:this.isActive}},e.prototype.unshift=function(e){var t=this._history[this._snapshotIndex];for((t=this._history[this._snapshotIndex]=t.filter(function(t){var i=t.get();return i&&i!==e})).unshift(new pe(this._win,e,M(e)));t.length>10;)t.pop()},e.prototype.findAvailable=function(){var e=this._element.get();if(!e||!this._tabster.focusable.isVisible(e))return null;var t=this._basic.restoreFocusOrder,i=null,r=ge.getTabsterContext(this._tabster,e);if(!r)return null;var o=r.root,n=o.getElement();if(!n)return null;if(void 0===t&&(t=o.getBasicProps().restoreFocusOrder),t===te.RootDefault&&(i=this._tabster.focusable.findDefault(n)),i||t!==te.RootFirst||(i=this._findFirst(n)),i)return i;var s=this._findInHistory(),a=this._tabster.focusable.findDefault(e),u=this._findFirst(e);return s&&t===te.History?s:a&&t===te.DeloserDefault?a:u&&t===te.DeloserFirst?u:a||s||u||null},e.prototype.customFocusLostHandler=function(e){return!!this._extended.onFocusLost&&this._extended.onFocusLost(e,this.getActions())},e.prototype.getElement=function(){return this._element.get()},e.prototype._findInHistory=function(){var e=this._history[this._snapshotIndex].slice(0);this.clearHistory(!0);for(var t=0;t<e.length;t++){var i=e[t],r=i.get(),o=this._element.get();if(r&&o&&o.contains(r)){if(this._tabster.focusable.isFocusable(r))return r}else if(!this._basic.noSelectorCheck){var n=i.getData();if(n&&o){var s=void 0;try{s=o.ownerDocument.querySelectorAll(n)}catch(r){continue}for(var a=0;a<s.length;a++){var u=s[a];if(u&&this._tabster.focusable.isFocusable(u))return u}}}}return null},e.prototype._findFirst=function(e){if(this._tabster.keyboardNavigation.isNavigatingWithKeyboard()){var t=this._tabster.focusable.findFirst(e);if(t)return t}return null},e.prototype._remove=function(){},e}(),De=function(){function e(e,t){var i=this;this._isInSomeDeloser=!1,this._isRestoringFocus=!1,this._isPaused=!1,this._init=function(){i._initTimer=void 0,i._tabster.focusedElement.subscribe(i._onFocus)},this._onFocus=function(e){if(i._restoreFocusTimer&&(i._win().clearTimeout(i._restoreFocusTimer),i._restoreFocusTimer=void 0),e){var t=i._history.process(e);t?(i._isInSomeDeloser=!0,t!==i._curDeloser&&(i._curDeloser&&i._curDeloser.setActive(!1),i._curDeloser=t),t.setActive(!0)):(i._isInSomeDeloser=!1,i._curDeloser=void 0)}else i._scheduleRestoreFocus()},this._tabster=e,this._win=e.getWindow,this._history=new Fe(e),this._initTimer=this._win().setTimeout(this._init,0);var r=null===t||void 0===t?void 0:t.autoDeloser;r&&(this._autoDeloser=r)}return e.prototype.dispose=function(){var e=this._win();this._initTimer&&(e.clearTimeout(this._initTimer),this._initTimer=void 0),this._restoreFocusTimer&&(e.clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0),this._autoDeloserInstance&&(this._autoDeloserInstance.dispose(),delete this._autoDeloserInstance,delete this._autoDeloser),this._tabster.focusedElement.unsubscribe(this._onFocus),this._history.dispose(),delete this._curDeloser},e.dispose=function(e){e.dispose()},e.prototype.getActions=function(e){for(var t=e;t;t=t.parentElement){var i=k(this._tabster,t);if(i&&i.deloser)return i.deloser.getActions()}},e.prototype.add=function(e,t,i){var r=k(this._tabster,e);r&&r.deloser||C(this._tabster,e,{deloser:new Ie(e,this._tabster,this._win,t,i)})},e.prototype.remove=function(e){var t=k(this._tabster,e);if(t){var i=t.deloser;i&&(this._history.removeDeloser(i),i.isActive()&&this._scheduleRestoreFocus(),i.dispose(),C(this._tabster,e,{deloser:void 0}))}},e.prototype.move=function(e,t){var i=k(this._tabster,e);i&&i.deloser&&(i.deloser.move(t),C(this._tabster,t,{deloser:i.deloser}),C(this._tabster,e,{deloser:void 0}))},e.prototype.pause=function(){this._isPaused=!0,this._restoreFocusTimer&&(this._win().clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0)},e.prototype.resume=function(e){this._isPaused=!1,e&&this._scheduleRestoreFocus()},e.prototype.setProps=function(e,t,i){var r=k(this._tabster,e);r&&r.deloser&&r.deloser.setProps(t,i)},e.prototype._isLastFocusedAvailable=function(){var e=this._tabster.focusedElement.getLastFocusedElement();return!(!e||!e.offsetParent)},e.prototype._scheduleRestoreFocus=function(e){var t=this;if(!this._isPaused&&!this._isRestoringFocus){var i=function(){return o(t,void 0,void 0,function(){var t,i;return n(this,function(r){switch(r.label){case 0:if(this._restoreFocusTimer=void 0,!e&&(this._isRestoringFocus||!this._isInSomeDeloser||this._isLastFocusedAvailable()))return[2];if(this._curDeloser){if((t=this._tabster.focusedElement.getLastFocusedElement())&&this._curDeloser.customFocusLostHandler(t))return[2];if((i=this._curDeloser.findAvailable())&&this._tabster.focusedElement.focus(i))return[2]}return this._isInSomeDeloser=!1,this._curDeloser&&(this._curDeloser.setActive(!1),this._curDeloser=void 0),this._isRestoringFocus=!0,[4,this._history.focusAvailable(null)];case 1:return r.sent()?[3,3]:[4,this._history.resetFocus(null)];case 2:r.sent(),r.label=3;case 3:return this._isRestoringFocus=!1,[2]}})})};e?i():this._restoreFocusTimer=this._win().setTimeout(i,100)}},e.getDeloser=function(e,t){for(var i,r=t;r;r=r.parentElement){var o=k(e,r);if(o&&o.deloser)return o.deloser}var n=e,s=n.deloser&&n.deloser;if(s){if(s._autoDeloserInstance)return s._autoDeloserInstance;var a=s._autoDeloser;if(!s._autoDeloserInstance&&a){var u=null===(i=t.ownerDocument)||void 0===i?void 0:i.body;u&&(s._autoDeloserInstance=new Ie(u,e,s._win,a,a))}return s._autoDeloserInstance}},e.getHistory=function(e){return e._history},e.forceRestoreFocus=function(e){e._scheduleRestoreFocus(!0)},e}(),Oe="up",Ce={Bootstrap:1,FocusElement:2,State:3,GetElement:4,RestoreFocusInDeloser:5,Ping:6},ke=function(e){function t(t,i,r){var o=e.call(this)||this;return o._deloser=i,o._transactions=r,o}return r(t,e),t.prototype.belongsTo=function(e){return e.deloserUId===this._deloser.deloserUId},t.prototype.focusAvailable=function(){return o(this,void 0,void 0,function(){var e;return n(this,function(t){return e=Q(Q({},this._deloser),{reset:!1}),[2,this._transactions.beginTransaction(Se,e).then(function(e){return!!e})]})})},t.prototype.resetFocus=function(){return o(this,void 0,void 0,function(){var e;return n(this,function(t){return e=Q(Q({},this._deloser),{reset:!0}),[2,this._transactions.beginTransaction(Se,e).then(function(e){return!!e})]})})},t}(ye),Ne=function(e){function t(t,i,r){var o=e.call(this,t,i)||this;return o._transactions=r,o}return r(t,e),t.prototype.unshift=function(e){for(var t,i=0;i<this._history.length;i++)if(this._history[i].belongsTo(e)){t=this._history[i],this._history.splice(i,1);break}t||(t=new ke(this._tabster,e,this._transactions)),this._history.unshift(t),this._history.splice(10,this._history.length-10)},t.prototype.focusAvailable=function(){return o(this,void 0,void 0,function(){var e,t,i;return n(this,function(r){switch(r.label){case 0:e=0,t=this._history,r.label=1;case 1:return e<t.length?(i=t[e],[4,i.focusAvailable()]):[3,4];case 2:if(r.sent())return[2,!0];r.label=3;case 3:return e++,[3,1];case 4:return[2,!1]}})})},t.prototype.resetFocus=function(){return o(this,void 0,void 0,function(){var e,t,i;return n(this,function(r){switch(r.label){case 0:e=0,t=this._history,r.label=1;case 1:return e<t.length?(i=t[e],[4,i.resetFocus()]):[3,4];case 2:if(r.sent())return[2,!0];r.label=3;case 3:return e++,[3,1];case 4:return[2,!1]}})})},t}(Ee),xe=function(){function e(e,t,i,r,o,n,s,a){var u,l=this;this._inProgress={},this._isDone=!1,this._isSelfResponding=!1,this._sentCount=0,this.tabster=e,this.owner=t,this.ownerId=w(t()),this.id=g(t()),this.beginData=r,this._knownTargets=i,this._sentTo=n||(u={},u[this.ownerId]=!0,u),this.targetId=s,this.sendUp=a,this.timeout=o,this._promise=new(I(t))(function(e,t){l._resolve=e,l._reject=t})}return e.prototype.getTargets=function(e){var t,i,r;return this.targetId===Oe?this.sendUp?(t={},t[Oe]={send:this.sendUp},t):null:this.targetId?e[this.targetId]?(i={},i[this.targetId]={send:e[this.targetId].send},i):null:0===Object.keys(e).length&&this.sendUp?(r={},r[Oe]={send:this.sendUp},r):Object.keys(e).length>0?e:null},e.prototype.begin=function(e){var t=this,i=this.getTargets(this._knownTargets),r=Q({},this._sentTo);if(i)for(var o=0,n=Object.keys(i);o<n.length;o++)r[l=n[o]]=!0;var s={transaction:this.id,type:this.type,isResponse:!1,timestamp:Date.now(),owner:this.ownerId,sentto:r,timeout:this.timeout,beginData:this.beginData};if(this.targetId&&(s.target=this.targetId),e&&(this._isSelfResponding=!0,e(s).then(function(e){t._isSelfResponding=!1,void 0!==e&&(t.endData||(t.endData=e)),(t.endData||0===t._sentCount)&&t.end()})),i)for(var a=0,u=Object.keys(i);a<u.length;a++){var l=u[a];l in this._sentTo||this._send(i[l].send,l,s)}return 0!==this._sentCount||this._isSelfResponding||this.end(),this._promise},e.prototype._send=function(e,t,i){void 0===this._inProgress[t]&&(this._inProgress[t]=!0,this._sentCount++,e(i))},e.prototype.end=function(e){this._isDone||(this._isDone=!0,void 0===this.endData&&e?this._reject&&this._reject(e):this._resolve&&this._resolve(this.endData))},e.prototype.onResponse=function(e){var t=e.endData;void 0===t||this.endData||(this.endData=t);var i=e.target===Oe?Oe:e.owner;this._inProgress[i]&&(this._inProgress[i]=!1,this._sentCount--,(this.endData||0===this._sentCount&&!this._isSelfResponding)&&this.end())},e}(),Pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Ce.Bootstrap,t}return r(t,e),t.shouldForward=function(){return!1},t.makeResponse=function(e){return o(this,void 0,void 0,function(){return n(this,function(t){return[2,{isNavigatingWithKeyboard:e.keyboardNavigation.isNavigatingWithKeyboard()}]})})},t}(xe),Ue=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Ce.FocusElement,t}return r(t,e),t.shouldForward=function(e,t,i){var r=Me.findElement(e,i,t.beginData);return!r||!e.focusable.isFocusable(r)},t.makeResponse=function(e,t,i,r,s,a){return o(this,void 0,void 0,function(){var r,o;return n(this,function(n){switch(n.label){case 0:return r=Me.findElement(e,i,t.beginData),(o=!!r&&e.focusedElement.focus(r))?[3,2]:[4,a];case 1:o=!!n.sent(),n.label=2;case 2:return[2,o]}})})},t.shouldSelfRespond=function(){return!0},t}(xe),Re={Focused:1,Blurred:2,Observed:3,DeadWindow:4,KeyboardNavigation:5,Outline:6},ze=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Ce.State,t}return r(t,e),t.shouldSelfRespond=function(e,t){return t.state!==Re.DeadWindow&&t.state!==Re.KeyboardNavigation},t.makeResponse=function(e,i,r,s,a,u,l){return o(this,void 0,void 0,function(){var r,o;return n(this,function(n){if(r=i.timestamp,o=i.beginData,r&&o)switch(o.state){case Re.Focused:return[2,t._makeFocusedResponse(e,r,o,a,l)];case Re.Blurred:return[2,t._makeBlurredResponse(e,r,o,a.ctx)];case Re.Observed:return[2,t._makeObservedResponse(e,o)];case Re.DeadWindow:return[2,t._makeDeadWindowResponse(e,o,a,u)];case Re.KeyboardNavigation:return[2,t._makeKeyboardNavigationResponse(e,a.ctx,o.isNavigatingWithKeyboard)];case Re.Outline:return[2,t._makeOutlineResponse(e,a.ctx,o.outline)]}return[2,!0]})})},t.createElement=function(e,t){return t.uid?new Ge(e,t.uid,t.ownerUId,t.id,t.rootUId,t.observedName,t.observedDetails):null},t._makeFocusedResponse=function(e,i,r,s,a){return o(this,void 0,void 0,function(){var o,u,l,c,d;return n(this,function(n){return o=t.createElement(e,r),r&&r.ownerUId&&o&&(s.ctx.focusOwner=r.ownerUId,s.ctx.focusOwnerTimestamp=i,!a&&r.rootUId&&r.deloserUId&&(u=e.deloser)&&(l=De.getHistory(u),c={ownerUId:r.ownerUId,deloserUId:r.deloserUId,rootUId:r.rootUId},(d=l.make(r.rootUId,function(){return new Ne(e,c.rootUId,s)})).unshift(c)),Be.setVal(e.crossOrigin.focusedElement,o,{isFocusedProgrammatically:r.isFocusedProgrammatically})),[2,!0]})})},t._makeBlurredResponse=function(e,t,i,r){return o(this,void 0,void 0,function(){return n(this,function(o){return i&&(i.ownerUId===r.focusOwner||i.force)&&(!r.focusOwnerTimestamp||r.focusOwnerTimestamp<t)&&Be.setVal(e.crossOrigin.focusedElement,void 0,{}),[2,!0]})})},t._makeObservedResponse=function(e,i){return o(this,void 0,void 0,function(){var r,o;return n(this,function(n){return r=i.observedName,o=t.createElement(e,i),r&&o&&Ve.trigger(e.crossOrigin.observedElement,o,{name:r,details:i.observedDetails}),[2,!0]})})},t._makeDeadWindowResponse=function(e,t,i,r){return o(this,void 0,void 0,function(){var o;return n(this,function(n){return(o=t&&t.ownerUId)&&i.removeTarget(o),[2,r.then(function(){if(o===i.ctx.focusOwner){var t=e.deloser;t&&De.forceRestoreFocus(t)}return!0})]})})},t._makeKeyboardNavigationResponse=function(e,t,i){return o(this,void 0,void 0,function(){return n(this,function(r){return void 0!==i&&e.keyboardNavigation.isNavigatingWithKeyboard()!==i&&(t.ignoreKeyboardNavigationStateUpdate=!0,ve.setVal(e.keyboardNavigation,i),t.ignoreKeyboardNavigationStateUpdate=!1),[2,!0]})})},t._makeOutlineResponse=function(e,t,i){return o(this,void 0,void 0,function(){return n(this,function(r){return t.origOutlineSetup&&t.origOutlineSetup.call(e.outline,i),[2,!0]})})},t}(xe),Me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Ce.GetElement,t}return r(t,e),t.findElement=function(e,t,i){var r;if(i&&(!i.ownerId||i.ownerId===w(t())))if(i.id){if((r=t().document.getElementById(i.id))&&i.rootId){var o=ge.getTabsterContext(e,r);if(!o||o.root.uid!==i.rootId)return null}}else if(i.uid){var n=s(t).elementByUId[i.uid];r=n&&n.get()}else i.observedName&&(r=e.observedElement.getElement(i.observedName));return r||null},t.getElementData=function(e,t,i,r,o){var n=De.getDeloser(e,t),s=ge.getTabsterContext(e,t),a=k(e,t),u=a&&a.observed;return{uid:y(i,t),ownerUId:o,id:t.id||void 0,rootUId:s?s.root.uid:void 0,deloserUId:n?S(i,r,n):void 0,observedName:u&&u.name,observedDetails:u&&u.details}},t.makeResponse=function(e,i,r,s,a,u){return o(this,void 0,void 0,function(){var o,l,c,d,h,p;return n(this,function(n){switch(n.label){case 0:return void 0===(o=i.beginData)?l=e.focusedElement.getFocusedElement():o&&(l=t.findElement(e,r,o)||void 0),l||!o?[3,2]:(d=o.observedName,h=i.timeout,d&&h?[4,new(I(r))(function(t,i){var r=!1,o=!1,n=!1;e.observedElement.waitElement(d,h).then(function(e){r=!0,n||!e&&!o||(n=!0,t({element:e}))}),u.then(function(e){o=!0,n||!e&&!r||(n=!0,t({crossOrigin:e}))})})]:[3,2]);case 1:(p=n.sent()).element?l=p.element:p.crossOrigin&&(c=p.crossOrigin),n.label=2;case 2:return[2,l?t.getElementData(e,l,r,a.ctx,s):c]}})})},t.shouldSelfRespond=function(){return!0},t}(xe),Se=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Ce.RestoreFocusInDeloser,t}return r(t,e),t.makeResponse=function(e,t,i,r,s,a){return o(this,void 0,void 0,function(){var i,r,o,u,l,c;return n(this,function(n){switch(n.label){case 0:return[4,a];case 1:return i=n.sent(),r=!i&&t.beginData,o=r&&r.deloserUId,u=o&&s.ctx.deloserByUId[o],l=e.deloser,r&&u&&l?(c=De.getHistory(l),[2,r.reset?c.resetFocus(u):c.focusAvailable(u)]):[2,!!i]}})})},t}(xe),Le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Ce.Ping,t}return r(t,e),t.shouldForward=function(){return!1},t.makeResponse=function(){return o(this,void 0,void 0,function(){return n(this,function(e){return[2,!0]})})},t}(xe),Ae=function(){function e(e,t,i){var r=this;this._knownTargets={},this._transactions={},this._isDefaultSendUp=!1,this.isSetUp=!1,this._onMessage=function(e){if(e.data.owner!==r._ownerUId&&r._tabster){var t,i=e.data;if(i&&(t=i.transaction)&&i.type&&i.timestamp&&i.owner&&i.sentto){var o=r._knownTargets[i.owner];if(!o&&e.send&&i.owner!==r._ownerUId&&(o=r._knownTargets[i.owner]={send:e.send}),o&&(o.last=Date.now()),i.isResponse){var n=r._transactions[t];n&&n.transaction&&n.transaction.type===i.type&&n.transaction.onResponse(i)}else{var s=r._getTransactionClass(i.type),a=r.forwardTransaction(i);s&&e.send&&s.makeResponse(r._tabster,i,r._owner,r._ownerUId,r,a,!1).then(function(t){var o={transaction:i.transaction,type:i.type,isResponse:!0,timestamp:Date.now(),owner:r._ownerUId,timeout:i.timeout,sentto:{},target:i.target===Oe?Oe:i.owner,endData:t};e.send(o)})}}}},this._onPageHide=function(){r._dead()},this._onBrowserMessage=function(e){if(e.source!==r._owner()){try{r._onMessage({data:JSON.parse(e.data),send:function(t){e.source&&e.source.postMessage&&e.source.postMessage(JSON.stringify(t),"*")}})}catch(e){}}},this._tabster=e,this._owner=t,this._ownerUId=w(t()),this.ctx=i}return e.prototype.setup=function(e){return this.isSetUp||(this.isSetUp=!0,this.setSendUp(e),this._owner().addEventListener("pagehide",this._onPageHide),this._ping()),this._onMessage},e.prototype.setSendUp=function(e){if(!this.isSetUp)throw new Error("CrossOrigin is not set up.");this.sendUp=e||void 0;var t=this._owner();return void 0===e?this._isDefaultSendUp||t.document&&(this._isDefaultSendUp=!0,t.parent&&t.parent!==t&&t.parent.postMessage&&(this.sendUp=function(e){t.parent.postMessage(JSON.stringify(e),"*")}),t.addEventListener("message",this._onBrowserMessage)):this._isDefaultSendUp&&(t.removeEventListener("message",this._onBrowserMessage),this._isDefaultSendUp=!1),this._onMessage},e.prototype.dispose=function(){return o(this,void 0,void 0,function(){var e,t,i,r,o;return n(this,function(n){switch(n.label){case 0:return e=this._owner(),this._pingTimer&&(e.clearTimeout(this._pingTimer),this._pingTimer=void 0),e.removeEventListener("message",this._onBrowserMessage),e.removeEventListener("pagehide",this._onPageHide),[4,this._dead()];case 1:for(n.sent(),delete this._deadPromise,t=0,i=Object.keys(this._transactions);t<i.length;t++)r=i[t],(o=this._transactions[r]).timer&&(e.clearTimeout(o.timer),delete o.timer),o.transaction.end();return this._knownTargets={},delete this.sendUp,[2]}})})},e.prototype.beginTransaction=function(e,t,i,r,o,n){var s=this;if(!this._owner)return I(this._owner).reject();var a,u=new e(this._tabster,this._owner,this._knownTargets,t,i,r,o,this.sendUp);return e.shouldSelfRespond&&e.shouldSelfRespond(this._tabster,t,this._owner,this._ownerUId)&&(a=function(t){return e.makeResponse(s._tabster,t,s._owner,s._ownerUId,s,I(s._owner).resolve(void 0),!0)}),this._beginTransaction(u,i,a,n)},e.prototype.removeTarget=function(e){delete this._knownTargets[e]},e.prototype._beginTransaction=function(e,t,i,r){var o=this,n=this._owner(),s={transaction:e,timer:n.setTimeout(function(){delete s.timer,e.end("Cross origin transaction timed out.")},1500+(t||0))};this._transactions[e.id]=s;var a=e.begin(i);return a.catch(function(){}).finally(function(){s.timer&&n.clearTimeout(s.timer),delete o._transactions[e.id]}),a.then(function(e){return e},r?void 0:function(){})},e.prototype.forwardTransaction=function(e){var t=this._owner,i=e.target;if(i===this._ownerUId)return I(t).resolve();var r=this._getTransactionClass(e.type);if(r){if(void 0===r.shouldForward||r.shouldForward(this._tabster,e,t,this._ownerUId)){var o=e.sentto;return i===Oe&&(i=void 0,o[this._ownerUId]=!0),delete o[Oe],this._beginTransaction(new r(this._tabster,t,this._knownTargets,e.beginData,e.timeout,o,i,this.sendUp),e.timeout)}return I(t).resolve()}return I(t).reject("Unknown transaction type "+e.type)},e.prototype._getTransactionClass=function(e){switch(e){case Ce.Bootstrap:return Pe;case Ce.FocusElement:return Ue;case Ce.State:return ze;case Ce.GetElement:return Me;case Ce.RestoreFocusInDeloser:return Se;case Ce.Ping:return Le;default:return null}},e.prototype._dead=function(){return o(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return this._deadPromise||this.ctx.focusOwner!==this._ownerUId||(this._deadPromise=this.beginTransaction(ze,{ownerUId:this._ownerUId,state:Re.DeadWindow})),this._deadPromise?[4,this._deadPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype._ping=function(){return o(this,void 0,void 0,function(){var e,t,i,r,o,s=this;return n(this,function(n){switch(n.label){case 0:return this._pingTimer?[2]:(t=Date.now(),i=Object.keys(this._knownTargets).filter(function(e){return t-(s._knownTargets[e].last||0)>3e3}),this.sendUp&&i.push(Oe),i.length?[4,I(this._owner).all(i.map(function(t){return s.beginTransaction(Le,void 0,void 0,void 0,t,!0).then(function(){return!0},function(){return t!==Oe&&(e||(e={}),e[t]=!0,delete s._knownTargets[t]),!1})}))]:[3,2]);case 1:n.sent(),n.label=2;case 2:return e?[4,this.beginTransaction(Me,void 0)]:[3,5];case 3:return!(r=n.sent())&&this.ctx.focusOwner&&this.ctx.focusOwner in e?[4,this.beginTransaction(ze,{ownerUId:this._ownerUId,state:Re.Blurred,force:!0})]:[3,5];case 4:n.sent(),(o=this._tabster.deloser)&&De.forceRestoreFocus(o),n.label=5;case 5:return this._pingTimer=this._owner().setTimeout(function(){s._pingTimer=void 0,s._ping()},3e3),[2]}})})},e}(),Ge=function(){function e(e,t,i,r,o,n,s){this._tabster=e,this.uid=t,this.ownerId=i,this.id=r,this.rootId=o,this.observedName=n,this.observedDetails=s}return e.prototype.focus=function(e,t){return this._tabster.crossOrigin.focusedElement.focus(this,e,t)},e}(),Be=function(e){function t(t){var i=e.call(this)||this;return i._transactions=t,i}return r(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this)},t.dispose=function(e){e.dispose()},t.prototype.focus=function(e,t,i){return o(this,void 0,void 0,function(){return n(this,function(r){return[2,this._focus({uid:e.uid,id:e.id,rootId:e.rootId,ownerId:e.ownerId,observedName:e.observedName},t,i)]})})},t.prototype.focusById=function(e,t,i,r){return o(this,void 0,void 0,function(){return n(this,function(o){return[2,this._focus({id:e,rootId:t},i,r)]})})},t.prototype.focusByObservedName=function(e,t,i,r,s){return o(this,void 0,void 0,function(){return n(this,function(o){return[2,this._focus({observedName:e,rootId:i},r,s,t)]})})},t.prototype._focus=function(e,t,i,r){return o(this,void 0,void 0,function(){return n(this,function(o){return[2,this._transactions.beginTransaction(Ue,Q(Q({},e),{noFocusedProgrammaticallyFlag:t,noAccessibleCheck:i}),r).then(function(e){return!!e})]})})},t.setVal=function(e,t,i){e.setVal(t,i)},t}(fe),Ve=function(e){function t(t,i){var r=e.call(this)||this;return r._lastRequestFocusId=0,r._tabster=t,r._transactions=i,r}return r(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this)},t.dispose=function(e){e.dispose()},t.prototype.getElement=function(e){return o(this,void 0,void 0,function(){return n(this,function(t){return[2,this.waitElement(e,0)]})})},t.prototype.waitElement=function(e,t){return o(this,void 0,void 0,function(){var i=this;return n(this,function(r){return[2,this._transactions.beginTransaction(Me,{observedName:e},t).then(function(e){return e?ze.createElement(i._tabster,e):null})]})})},t.prototype.requestFocus=function(e,t){return o(this,void 0,void 0,function(){var i,r=this;return n(this,function(o){return i=++this._lastRequestFocusId,[2,this.waitElement(e,t).then(function(e){return!(r._lastRequestFocusId!==i||!e)&&r._tabster.crossOrigin.focusedElement.focus(e)})]})})},t.trigger=function(e,t,i){e.trigger(t,i)},t}(fe),je=function(){function e(e){var t=this;this._init=function(){t._initTimer=void 0;var e=t._tabster;e.keyboardNavigation.subscribe(t._onKeyboardNavigationStateChanged),e.focusedElement.subscribe(t._onFocus),e.observedElement.subscribe(t._onObserved),t._ctx.origOutlineSetup||(t._ctx.origOutlineSetup=e.outline.setup,e.outline.setup=t._outlineSetup),t._transactions.beginTransaction(Pe,void 0,void 0,void 0,Oe).then(function(e){e&&t._tabster.keyboardNavigation.isNavigatingWithKeyboard()!==e.isNavigatingWithKeyboard&&(t._ctx.ignoreKeyboardNavigationStateUpdate=!0,ve.setVal(t._tabster.keyboardNavigation,e.isNavigatingWithKeyboard),t._ctx.ignoreKeyboardNavigationStateUpdate=!1)})},this._onKeyboardNavigationStateChanged=function(e){t._ctx.ignoreKeyboardNavigationStateUpdate||t._transactions.beginTransaction(ze,{state:Re.KeyboardNavigation,ownerUId:w(t._win()),isNavigatingWithKeyboard:e})},this._onFocus=function(e,i){var r=t._win(),o=w(r);t._blurTimer&&(r.clearTimeout(t._blurTimer),t._blurTimer=void 0),e?t._transactions.beginTransaction(ze,Q(Q({},Me.getElementData(t._tabster,e,t._win,t._ctx,o)),{state:Re.Focused})):t._blurTimer=r.setTimeout(function(){t._blurTimer=void 0,t._ctx.focusOwner&&t._ctx.focusOwner===o&&t._transactions.beginTransaction(Me,void 0).then(function(e){e||t._ctx.focusOwner!==o||t._transactions.beginTransaction(ze,{ownerUId:o,state:Re.Blurred,force:!1})})},0)},this._onObserved=function(e,i){var r=Me.getElementData(t._tabster,e,t._win,t._ctx,w(t._win()));r.state=Re.Observed,r.observedName=i.name,r.observedDetails=i.details,t._transactions.beginTransaction(ze,r)},this._outlineSetup=function(e){t._transactions.beginTransaction(ze,{state:Re.Outline,ownerUId:w(t._win()),outline:e})},this._tabster=e,this._win=e.getWindow,this._ctx={ignoreKeyboardNavigationStateUpdate:!1,deloserByUId:{}},this._transactions=new Ae(e,this._win,this._ctx),this.focusedElement=new Be(this._transactions),this.observedElement=new Ve(e,this._transactions)}return e.prototype.setup=function(e){return this.isSetUp()?this._transactions.setSendUp(e):(this._initTimer=this._win().setTimeout(this._init,0),this._transactions.setup(e))},e.prototype.isSetUp=function(){return this._transactions.isSetUp},e.prototype.dispose=function(){var e;this._initTimer&&(this._win().clearTimeout(this._initTimer),this._initTimer=void 0);var t=this._tabster;t.keyboardNavigation.unsubscribe(this._onKeyboardNavigationStateChanged),t.focusedElement.unsubscribe(this._onFocus),null===(e=t.observedElement)||void 0===e||e.unsubscribe(this._onObserved),this._transactions.dispose(),Be.dispose(this.focusedElement),Ve.dispose(this.observedElement),this._ctx.deloserByUId={}},e.dispose=function(e){e.dispose()},e}(),We=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","*[tabindex]","*[contenteditable]"].join(", "),Ke=200,He=0,qe=function(){function e(t,i,r,o){this._visibleGrouppers={},this._hasFullyVisibleGroupper=!1,this._prevVisibleGrouppers={},this._grouppers={},this._tabster=t,this._win=r,this._cur=o,this._element=new pe(r,i),this.id="fgc"+ ++He,C(t,i,{uberGroupper:this}),e._containers[this.id]=this}return e.prototype.dispose=function(){this._grouppers={};var t=this._win();this._updateVisibleTimer&&(t.clearTimeout(this._updateVisibleTimer),this._updateVisibleTimer=void 0),this._onChangeTimer&&(t.clearTimeout(this._onChangeTimer),this._onChangeTimer=void 0);var i=this._element.get();i&&C(this._tabster,i,{uberGroupper:void 0}),delete e._containers[this.id]},e.prototype.getElement=function(){return this._element.get()},e.prototype.addGroupper=function(e){this._grouppers[e.id]=e,this._setFirstLast(),this._updateVisible(!0)},e.prototype.removeGroupper=function(e){var t=e.id;delete this._grouppers[t],delete this._visibleGrouppers[t],delete this._prevVisibleGrouppers[t],delete this._cur.focused[t],this._current===e&&this._setCurrent(void 0),this._setFirstLast(),this._updateVisible(!0)},e.prototype.setFocusedGroupper=function(e){e!==this._focused&&(this._focused=e,this._processOnChange())},e.prototype.setUnlimitedGroupper=function(e){e!==this._unlimited&&(this._unlimited=e,this._processOnChange())},e.prototype.forceUpdate=function(){this._processOnChange(!0)},e.prototype._processOnChange=function(e){var t=this;if(!this._onChangeTimer||e){var i=function(){t._onChangeTimer=void 0;var e=[];if(t._prevFocused!==t._focused){for(var i=0,r=Object.keys(t._grouppers);i<r.length;i++){s=r[i];e.push(t._grouppers[s])}t._focused||t._prevFocused&&t._prevFocused.getBasicProps().memorizeCurrent||(t._setCurrent(void 0),t._prev=void 0,t._next=void 0),t._prevFocused=t._focused}if(t._prevCurrent!==t._current&&(e.push(t._prevCurrent),e.push(t._current),t._prevCurrent=t._current),t._prevPrev!==t._prev&&(e.push(t._prevPrev),e.push(t._prev),t._prevPrev=t._prev),t._prevNext!==t._next&&(e.push(t._prevNext),e.push(t._next),t._prevNext=t._next),t._prevFirst!==t._first&&(e.push(t._prevFirst),e.push(t._first),t._prevFirst=t._first),t._prevLast!==t._last&&(e.push(t._prevLast),e.push(t._last),t._prevLast=t._last),t._prevUnlimited!==t._unlimited&&(e.push(t._prevUnlimited),e.push(t._unlimited),t._prevUnlimited=t._unlimited),t._visibleGrouppers!==t._prevVisibleGrouppers){t._hasFullyVisibleGroupper=!1;for(var o=0,n=Object.keys(t._visibleGrouppers);o<n.length;o++){var s=n[o],a=t._visibleGrouppers[s];a!==t._prevVisibleGrouppers[s]&&e.push(t._grouppers[s]),a===oe.Visible&&(t._hasFullyVisibleGroupper=!0)}for(var u=0,l=Object.keys(t._prevVisibleGrouppers);u<l.length;u++){s=l[u];t._visibleGrouppers[s]!==t._prevVisibleGrouppers[s]&&e.push(t._grouppers[s])}t._prevVisibleGrouppers=t._visibleGrouppers}for(var c={},d=0,h=e.filter(function(e){return e&&t._grouppers[e.id]});d<h.length;d++){var p=h[d];if(p&&!c[p.id]){c[p.id]=!0;var _=p.getExtendedProps().onChange;_&&_(p.getState())}}};this._onChangeTimer&&this._win().clearTimeout(this._onChangeTimer),e?i():this._onChangeTimer=this._win().setTimeout(i,0)}},e.prototype._setFirstLast=function(){this._first=void 0,this._last=void 0;var e=this._element.get();if(e){for(t=e.firstElementChild;t;t=t.nextElementSibling)if((i=k(this._tabster,t))&&i.groupper&&i.groupper.id in this._grouppers){this._first=i.groupper;break}for(var t=e.lastElementChild;t;t=t.previousElementSibling){var i=k(this._tabster,t);if(i&&i.groupper&&i.groupper.id in this._grouppers){this._last=i.groupper;break}}this._processOnChange()}},e.prototype.setCurrentGroupper=function(e){var t;this._setCurrent(e&&e.id in this._grouppers?e:void 0),this._prev=void 0,this._next=void 0;var i=null===(t=this._current)||void 0===t?void 0:t.getElement();if(i&&i.parentElement===this._element.get()){for(r=i.previousElementSibling;r;r=r.previousElementSibling)if((o=k(this._tabster,r))&&o.groupper){this._prev=o.groupper;break}for(var r=i.nextElementSibling;r;r=r.nextElementSibling){var o=k(this._tabster,r);if(o&&o.groupper){this._next=o.groupper;break}}}this._processOnChange()},e.prototype.getCurrentGroupper=function(){return this._current&&this._current.id in this._grouppers?this._current:(this._setCurrent(void 0),this._current||null)},e.prototype.getGroupperState=function(e){var t=e.getBasicProps(),i=t.isLimited,r=this._visibleGrouppers[e.id]||oe.Invisible,o=this._current?this._current===e:void 0;return void 0===o&&t.lookupVisibility!==oe.Invisible&&(r===oe.Invisible||this._hasFullyVisibleGroupper&&r===oe.PartiallyVisible)&&(o=!1),{isCurrent:o,isPrevious:this._prev===e,isNext:this._next===e,isFirst:this._first===e,isLast:this._last===e,isVisible:r,hasFocus:this._focused===e,siblingHasFocus:!!this._focused&&this._focused!==e,siblingIsVisible:this._hasFullyVisibleGroupper,isLimited:(i===ne.Limited||i===ne.LimitedTrapFocus)&&this._unlimited!==e}},e.prototype.isEmpty=function(){return 0===Object.keys(this._grouppers).length},e.prototype._setCurrent=function(e){var t=this._current;t!==e&&(t&&this._cur.current[t.id]&&delete this._cur.current[t.id],e&&(this._cur.current[e.id]=e),this._current=e)},e.prototype._updateVisible=function(e){var t=this,i=this._element.get();if(!this._updateVisibleTimer&&i){if(e)for(var r=i.parentElement;r;r=r.parentElement){var o=k(this._tabster,r);o&&o.uberGroupper&&o.uberGroupper._updateVisible(!1)}this._updateVisibleTimer=this._win().setTimeout(function(){t._updateVisibleTimer=void 0;for(var e=!1,i={},r=0,o=Object.keys(t._grouppers);r<o.length;r++){var n=o[r],s=t._grouppers[n].getElement(),a=s?p(t._win,s,10):oe.Invisible,u=t._visibleGrouppers[n]||oe.Invisible;a!==oe.Invisible&&(i[n]=a),u!==a&&(e=!0)}e&&(t._prevVisibleGrouppers=t._visibleGrouppers,t._visibleGrouppers=i,t._processOnChange())},0)}},e.updateVisible=function(t){for(var i={},r=0,o=t;r<o.length;r++)for(var n=o[r],s=0,a=Object.keys(e._containers);s<a.length;s++){var u=a[s],l=e._containers[u],c=l.getElement();c&&n.contains(c)&&(i[l.id]=l)}for(var d=0,h=Object.keys(i);d<h.length;d++)i[u=h[d]]._updateVisible(!1)},e._containers={},e}(),Je=function(){function e(e,t,i,r,o,n){this._tabster=e,this._win=i,this._cur=r,this._element=new pe(i,t),this._basic=o||{},this._extended=n||{},this.id="fg"+ ++He,C(this._tabster,t,{groupper:this}),this.setupContainer()}return e.prototype.dispose=function(){this._container&&this._container.removeGroupper(this),this.setupContainer(!0);var e=this._element.get();e&&C(this._tabster,e,{groupper:void 0})},e.prototype.getBasicProps=function(){return this._basic},e.prototype.getExtendedProps=function(){return this._extended},e.prototype.setProps=function(e,t){e?this._basic=Q(Q({},this._basic),e):null===e&&(this._basic={}),t?this._extended=Q(Q({},this._extended),t):null===t&&(this._extended={})},e.prototype.getElement=function(){return this._element.get()},e.prototype.moveTo=function(e){this._element.get()!==e&&(this.setupContainer(!0),this._element=new pe(this._win,e),this.setupContainer())},e.prototype.getState=function(){return this._container?this._container.getGroupperState(this):{isCurrent:void 0,isPrevious:!1,isNext:!1,isFirst:!1,isLast:!1,isVisible:oe.Invisible,hasFocus:!1,siblingIsVisible:!1,siblingHasFocus:!1,isLimited:!1}},e.prototype.setCurrent=function(e){this._container&&this._container.setCurrentGroupper(e?this:void 0)},e.prototype.isDefault=function(){var e=this._basic.isDefault||this._extended.isDefault;return"function"==typeof e?e.call(this._element):e},e.prototype.setFocused=function(e){this._container&&this._container.setFocusedGroupper(e?this:void 0)},e.prototype.setUnlimited=function(e){!this._container||this._basic.isLimited!==ne.Limited&&this._basic.isLimited!==ne.LimitedTrapFocus||this._container.setUnlimitedGroupper(e?this:void 0)},e.prototype.forceUpdate=function(){this._container&&this._container.forceUpdate()},e.prototype.setupContainer=function(e){var t,i=this._element.get(),r=null===i||void 0===i?void 0:i.parentElement,o=this._container;if(r){var n=k(this._tabster,r);(t=n&&n.uberGroupper)||e||(t=new qe(this._tabster,r,this._win,this._cur))}o&&(e||o!==t)&&o.removeGroupper(this),this._container=t,t&&!e&&t.addGroupper(this)},e}(),Ye=function(){function e(e,t){var i=this;this._scrollTargets=[],this._init=function(){i._initTimer=void 0;var e=i._win();e.document.addEventListener(me,i._onMutation,!0),e.addEventListener("scroll",i._onScroll,!0),i._tabster.focusedElement.subscribe(i._onFocus)},this._onFocus=function(e){e&&i._updateFocusedGrouppers(e)},this._onMutation=function(e){e.target&&e.details.groupper&&e.details.groupper.setupContainer(e.details.removed)},this._onScroll=function(e){for(var t=!1,r=0,o=i._scrollTargets;r<o.length;r++)if(o[r]===e.target){t=!0;break}!t&&e.target.contains&&i._scrollTargets.push(e.target);var n=i._win();i._scrollTimer&&n.clearTimeout(i._scrollTimer),i._scrollTimer=n.setTimeout(function(){i._scrollTimer=void 0,qe.updateVisible(i._scrollTargets),i._scrollTargets=[]},Ke)},this._tabster=e,this._win=t,this._cur={focused:{},current:{}},this._initTimer=t().setTimeout(this._init,0)}return e.prototype.dispose=function(){var e=this._win();this._initTimer&&(e.clearTimeout(this._initTimer),this._initTimer=void 0),this._scrollTimer&&(e.clearTimeout(this._scrollTimer),this._scrollTimer=void 0),e.document.removeEventListener(me,this._onMutation,!0),e.removeEventListener("scroll",this._onScroll,!0),this._tabster.focusedElement.unsubscribe(this._onFocus),this._scrollTargets=[]},e.dispose=function(e){e.dispose()},e.prototype._getBody=function(){var e=this._tabster.focusedElement.getLastFocusedElement();return e&&e.ownerDocument?e.ownerDocument.body:this._win().document.body},e.forgetFocusedGrouppers=function(e){e._updateFocusedGrouppers(null,!0)},e.prototype._updateFocusedGrouppers=function(e,t){for(var i={},r=e;r;r=r.parentElement){var o=k(this._tabster,r);o&&o.groupper&&(i[o.groupper.id]=o.groupper)}for(var n=0,s=Object.keys(this._cur.focused);n<s.length;n++)i[l=s[n]]||((c=this._cur.focused[l]).setFocused(!1),c.setUnlimited(!1),t&&c.forceUpdate());for(var a=0,u=Object.keys(i);a<u.length;a++){var l=u[a];if(!this._cur.focused[l]){var c=i[l],d=c.getElement();d&&(c.setFocused(!0),e!==this._getGroupFirst(d,!1)&&c.setUnlimited(!0))}}this._cur.focused=i},e.prototype._getGroupFirst=function(e,t){return this._tabster.focusable.isFocusable(e)?e:this._tabster.focusable.findFirst(e,!1,!1,t)},e.prototype.addGroupper=function(e,t,i){var r=k(this._tabster,e);if(r&&r.groupper)throw new Error("The element already has a focus group");U(e,{groupper:new Je(this._tabster,e,this._win,this._cur,t,i)})},e.prototype.removeGroupper=function(e){var t=k(this._tabster,e),i=t&&t.groupper;i&&(i.dispose(),U(e,{groupper:i,removed:!0}))},e.prototype.moveGroupper=function(e,t){if(e!==t){var i=k(this._tabster,e),r=i&&i.groupper;r&&(r.moveTo(t),U(e,{groupper:r,removed:!0}),U(t,{groupper:r}))}},e.prototype.setGroupperProps=function(e,t,i){var r=this._findGroupper(e);r&&r.setProps(t,i)},e.prototype.setCurrentGroupper=function(e,t){var i,r=e?this._findGroupper(e):null;if(null===e)for(var o=0,n=Object.keys(this._cur.current);o<n.length;o++){var s=n[o],a=this._cur.current[s];a.setCurrent(!1),t&&a.forceUpdate()}else for(;r;){r.setCurrent(!0),t&&r.forceUpdate();var u=null===(i=r.getElement())||void 0===i?void 0:i.parentElement;r=u?this._findGroupper(u):null}},e.prototype.isInCurrentGroupper=function(e){return this._isInCurrentGroupper(e,!1)},e.prototype._isInCurrentGroupper=function(e,t){var i=this._findGroupper(e),r=null===i||void 0===i?void 0:i.getElement();if(i&&r){var o=!1;for(t&&(o=e.contains(this._getGroupFirst(r,!0)));i;){var n=i.getState();if(!1===n.isCurrent)return!1;if(t&&n.isLimited&&!o)return!1;var s=null===r||void 0===r?void 0:r.parentElement;(i=s?this._findGroupper(s):null)&&(r=i.getElement())}return!0}},e.prototype._findGroupper=function(e){for(var t=e;t;t=t.parentElement){var i=k(this._tabster,t);if(i&&i.groupper)return i.groupper}return null},e.prototype.findGroupper=function(e){var t=this._findGroupper(e);return t?t.getElement()||null:null},e.prototype._findNextGroupper=function(e,t,i){var r=this.findGroupper(e),o=r&&r.parentElement;if(r&&o){var n=k(this._tabster,o),s=n&&n.uberGroupper;if(s)for(var a=t(s,r);a;a=t(s,r,a)){var u=k(this._tabster,a);if(u&&u.groupper&&(i||this.isAccessible(a))){if(!this._tabster.focusable.isFocusable(a)&&!this._tabster.focusable.findFirst(a,!1,!1,!0))continue;return a}}}return null},e.prototype.findFirstGroupper=function(e,t){return this._findNextGroupper(e,function(e,t,i){var r;return void 0===i?(null===(r=e.getElement())||void 0===r?void 0:r.firstElementChild)||null:i?i.nextElementSibling:null},t)},e.prototype.findLastGroupper=function(e,t){return this._findNextGroupper(e,function(e,t,i){var r;return void 0===i?(null===(r=e.getElement())||void 0===r?void 0:r.lastElementChild)||null:i?i.previousElementSibling:null},t)},e.prototype.findNextGroupper=function(e,t){return this._findNextGroupper(e,function(e,t,i){return void 0===i?t.nextElementSibling:i?i.nextElementSibling:null},t)},e.prototype.findPrevGroupper=function(e,t){return this._findNextGroupper(e,function(e,t,i){return void 0===i?t.previousElementSibling:i?i.previousElementSibling:null},t)},e.prototype.getProps=function(e){var t=k(this._tabster,e);return t&&t.focusable||{}},e.prototype.setProps=function(e,t){var i=k(this._tabster,e),r=i&&i.focusable||{},o={};t&&(o.isDefault=t.isDefault,o.isIgnored=t.isIgnored,o.mover=t.mover,o.ignoreAriaDisabled=t.ignoreAriaDisabled),r.isDefault===o.isDefault&&r.isIgnored===o.isIgnored&&r.mover===o.mover&&r.ignoreAriaDisabled===o.ignoreAriaDisabled||C(this._tabster,e,{focusable:o})},e.prototype.isFocusable=function(e,t,i,r){return!(!F(e,We)||!t&&-1===e.tabIndex)&&((i||this.isVisible(e))&&(r||this.isAccessible(e)))},e.prototype.isVisible=function(e){if(!e.ownerDocument)return!1;if(null===e.offsetParent&&e.ownerDocument.body!==e)return!1;var t=e.ownerDocument.defaultView;if(!t)return!1;var i=e.ownerDocument.body.getBoundingClientRect();return(0!==i.width||0!==i.height)&&"hidden"!==t.getComputedStyle(e).visibility},e.prototype.isAccessible=function(e){for(var t,i=e;i;i=i.parentElement){var r=k(this._tabster,i);if(r&&r.modalizer&&!r.modalizer.isActive())return!0;var o=i.getAttribute("aria-hidden");if(o&&"true"===o.toLowerCase())return!1;if(o=i.getAttribute("aria-disabled"),!(null===(t=null===r||void 0===r?void 0:r.focusable)||void 0===t?void 0:t.ignoreAriaDisabled)&&o&&"true"===o.toLowerCase())return!1}return!0},e.prototype.findFirst=function(e,t,i,r){return this._findElement(e||this._getBody(),null,t,i,r,!1)},e.prototype.findLast=function(e,t,i,r){return this._findElement(e||this._getBody(),null,t,i,r,!0)},e.prototype.findNext=function(e,t,i,r,o){return this._findElement(t||this._getBody(),e,i,r,o,!1)},e.prototype.findPrev=function(e,t,i,r,o){return this._findElement(t||this._getBody(),e,i,r,o,!0)},e.prototype.findDefault=function(e,t,i,r){var o=this;return this._findElement(e||this._getBody(),null,t,i,r,!1,function(e){return o._tabster.focusable.isFocusable(e,t)&&!!o.getProps(e).isDefault})},e.prototype.findAll=function(e,t,i,r,o,n){var s=this,a=function(e){var r=s._tabster.focusable.isFocusable(e,i),o=t(e);return n?!!o:r&&!!o},u=c(e.ownerDocument,e,function(e){return s._acceptElement(e,a,r,o)}),l=null===u||void 0===u?void 0:u.filter;if(!u||!e||!l)return[];for(var d,h=[];d=u.nextNode();)h.push(d);return h},e.prototype._findElement=function(e,t,i,r,o,n,s){var a=this;if(!e)return null;if(!e.ownerDocument||t&&e!==t&&!e.contains(t))return null;s||(s=function(e){return a._tabster.focusable.isFocusable(e,i)});var u=c(e.ownerDocument,e,function(e){return a._acceptElement(e,s,r,o)});if(!u)return null;if(t)u.currentNode=t;else if(n){for(var l=null,d=e.lastElementChild;d;d=d.lastElementChild)l=d;if(!l)return null;if(this._acceptElement(l,s,r,o)===NodeFilter.FILTER_ACCEPT)return l;u.currentNode=l}return n?u.previousNode():u.nextNode()},e.prototype._acceptElement=function(e,t,i,r){var o=ge.getTabsterContext(this._tabster,e),n=o&&o.root.getCurrentModalizerId();return i||!o||!o.modalizer||void 0===n||n===o.modalizer.userId||o.modalizer.getBasicProps().isAlwaysAccessible?r||!1!==this._isInCurrentGroupper(e,!0)?t(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT:o?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP},e}(),Xe=["input","textarea","*[contenteditable]"].join(", "),$e=function(e){function t(i,r){var o=e.call(this)||this;return o._canOverrideNativeFocus=!1,o._init=function(){o._initTimer=void 0;var e=o._win();o._canOverrideNativeFocus=L(e),t.replaceFocus(o._win),e.document.addEventListener("focusin",o._onFocusIn,!0),e.document.addEventListener("focusout",o._onFocusOut,!0),e.document.addEventListener("mousedown",o._onMouseDown,!0),e.addEventListener("keydown",o._onKeyDown)},o._onFocusIn=function(e){o._setFocusedElement(e.target,e.relatedTarget||void 0)},o._onFocusOut=function(e){o._setFocusedElement(void 0,e.relatedTarget||void 0)},o._onMouseDown=function(e){var t=o._tabster.focusable.findGroupper(e.target);t&&o._tabster.focusable.setCurrentGroupper(t)},o._onKeyDown=function(e){var t,i,r,n,s,a,u,l,c,d=o.getVal();if(d&&d.ownerDocument){switch(e.keyCode){case _e.Enter:case _e.Esc:case _e.Tab:case _e.Down:case _e.Right:case _e.Up:case _e.Left:case _e.PageDown:case _e.PageUp:case _e.Home:case _e.End:break;default:return}var h=ge.getTabsterContext(o._tabster,d,{checkRtl:!0}),p=e.keyCode,f=p===_e.Tab;if((f||h&&h.mover&&!h.isGroupperFirst)&&p!==_e.Enter&&p!==_e.Esc){if(!h)return;var v=f&&e.shiftKey||!f&&(p===_e.Left&&!h.isRtl||p===_e.Right&&h.isRtl||p===_e.Up||p===_e.PageUp||p===_e.Home);if(h&&h.modalizer){var m=h.root.getCurrentModalizerId();if(m&&m!==h.modalizer.userId&&(h.modalizer=h.root.getModalizerById(m),h.modalizer&&!(d=h.modalizer.getElement())))return}var g=d;if(f&&h.mover&&(null===(t=h.moverOptions)||void 0===t?void 0:t.navigationType)===Z.Arrows){for(var y=h,w=h.mover;null===(i=null===y||void 0===y?void 0:y.mover)||void 0===i?void 0:i.parentElement;)w=y.mover,y=ge.getTabsterContext(o._tabster,y.mover.parentElement);g=v?o._tabster.focusable.findFirst(w):o._tabster.focusable.findLast(w)}if(!g)return;N=null;switch(p){case _e.Tab:case _e.Up:case _e.Down:case _e.Left:case _e.Right:N=v?o._tabster.focusable.findPrev(g):o._tabster.focusable.findNext(g);break;case _e.Home:N=(null===(r=h.mover)||void 0===r?void 0:r.contains(g))?o._tabster.focusable.findFirst(h.mover):N;break;case _e.End:N=(null===(n=h.mover)||void 0===n?void 0:n.contains(g))?o._tabster.focusable.findLast(h.mover):N;break;case _e.PageDown:case _e.PageUp:return}if(!f&&h.mover){var E=(p===_e.Left||p===_e.Right)&&(null===(s=h.moverOptions)||void 0===s?void 0:s.axis)===re.Vertical,T=(p===_e.Up||p===_e.Down)&&(null===(a=h.moverOptions)||void 0===a?void 0:a.axis)===re.Horizontal;if(E||T)return;if(!N||N&&!h.mover.contains(N)){if(e.preventDefault(),!(null===(u=h.moverOptions)||void 0===u?void 0:u.cyclic))return;N=v?o._tabster.focusable.findLast(h.mover):o._tabster.focusable.findFirst(h.mover)}}C=null===(O=null===h||void 0===h?void 0:h.groupper)||void 0===O?void 0:O.getElement();if(O&&C){var F=o._getFirstInGroupper(C,!1);if(!F||d===F||O.getBasicProps().isLimited!==ne.LimitedTrapFocus||N&&N!==F&&C.contains(N)){if(d===F&&C.parentElement){var I=null===(P=null===(l=ge.getTabsterContext(o._tabster,C.parentElement))||void 0===l?void 0:l.groupper)||void 0===P?void 0:P.getElement();P&&I&&!I.contains(N)&&P.getBasicProps().isLimited===ne.LimitedTrapFocus&&(N=d)}}else N=v?o._tabster.focusable.findLast(C):o._tabster.focusable.findNext(F,C)}if(h&&h.modalizer){var D=N&&ge.getTabsterContext(o._tabster,N);if((!D||h.root.uid!==D.root.uid||!D.modalizer||D.root.getCurrentModalizerId()!==D.modalizer.userId)&&h.modalizer.onBeforeFocusOut())return void e.preventDefault()}N?(e.preventDefault(),b(N)):h&&h.root.moveOutWithDefaultAction(v)}else{if((p===_e.Left||p===_e.Right)&&o._isInput(d))return;var O=null===h||void 0===h?void 0:h.groupper,C=null===O||void 0===O?void 0:O.getElement();if(!O||!C)return;var k=!0,N=null;switch(p){case _e.Enter:case _e.Esc:var x=O.getState();if(e.keyCode===_e.Enter)x.isLimited&&d===o._getFirstInGroupper(C,!0)?(O.setUnlimited(!0),N=o._tabster.focusable.findNext(d),C.contains(N)||(N=null),null===N&&(k=!1)):k=!1;else{if(x.isLimited&&C.parentElement){var P=null===(c=ge.getTabsterContext(o._tabster,C.parentElement))||void 0===c?void 0:c.groupper;P&&(C=P.getElement(),O=P,x=P.getState())}x.isLimited||(O.setUnlimited(!1),N=C||null)}break;case _e.Down:case _e.Right:case _e.Up:case _e.Left:N=o._findNextGroupper(C,e.keyCode,O.getBasicProps().nextDirection,null===h||void 0===h?void 0:h.isRtl);break;case _e.PageDown:(N=o._findPageDownGroupper(C))&&_(o._win,N,!0);break;case _e.PageUp:(N=o._findPageUpGroupper(C))&&_(o._win,N,!1);break;case _e.Home:C.parentElement&&(N=o._tabster.focusable.findFirstGroupper(C));break;case _e.End:C.parentElement&&(N=o._tabster.focusable.findLastGroupper(C))}k&&(e.preventDefault(),e.stopImmediatePropagation()),N&&(o._tabster.focusable.isFocusable(N)||(N=o._tabster.focusable.findFirst(N,!1,!1,!0)),N&&(o._tabster.focusable.setCurrentGroupper(N),ve.setVal(o._tabster.keyboardNavigation,!0),b(N)))}}},o._validateFocusedElement=function(e,t){var i=ge.getTabsterContext(o._tabster,e),r=i?i.root.getCurrentModalizerId():void 0;if(o._tabster.focusable.setCurrentGroupper(e),i&&i.modalizer){var n=i.modalizer;if(r!==n.userId)if(void 0===r||t.isFocusedProgrammatically)i.root.setCurrentModalizerId(n.userId);else if(n&&e.ownerDocument){var s=o._tabster.focusable.findFirst(i.root.getElement());if(s){if(e.compareDocumentPosition(s)&document.DOCUMENT_POSITION_PRECEDING&&!(s=o._tabster.focusable.findLast(e.ownerDocument.body)))throw new Error("Something went wrong.");o._tabster.focusedElement.focus(s)}else e.blur()}}},o._tabster=i,o._win=r,o._initTimer=r().setTimeout(o._init,0),o}return r(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this);var i=this._win();t.restoreFocus(i),this._initTimer&&(i.clearTimeout(this._initTimer),this._initTimer=void 0),i.document.removeEventListener("focusin",this._onFocusIn,!0),i.document.removeEventListener("focusout",this._onFocusOut,!0),i.document.removeEventListener("mousedown",this._onMouseDown,!0),i.removeEventListener("keydown",this._onKeyDown),delete t._lastFocusedProgrammatically,delete t._lastResetElement,delete this._nextVal,delete this._lastVal},t.dispose=function(e){e.dispose()},t.forgetMemorized=function(e,i){var r,o,n=t._lastFocusedProgrammatically,s=n&&n.get();s&&i.contains(s)&&delete t._lastFocusedProgrammatically,(s=(n=t._lastResetElement)&&n.get())&&i.contains(s)&&delete t._lastResetElement,(s=null===(o=null===(r=e._nextVal)||void 0===r?void 0:r.element)||void 0===o?void 0:o.get())&&i.contains(s)&&delete e._nextVal,(s=(n=e._lastVal)&&n.get())&&i.contains(s)&&delete e._lastVal},t.prototype.getFocusedElement=function(){return this.getVal()},t.prototype.getLastFocusedElement=function(){var e,t=null===(e=this._lastVal)||void 0===e?void 0:e.get();return(!t||t&&!T(t.ownerDocument,t))&&(this._lastVal=t=void 0),t},t.prototype.focus=function(e,i,r){return!!this._tabster.focusable.isFocusable(e,i,!1,r)&&(t._lastFocusedProgrammatically=new pe(this._win,e),e.focus(),!0)},t.prototype.focusDefault=function(e){var t=this._tabster.focusable.findDefault(e);return!!t&&(this._tabster.focusedElement.focus(t),!0)},t.prototype.focusFirst=function(e){var t=this._tabster.focusable.findFirst(e,!1,!0);return!!t&&(this.focus(t),!0)},t.prototype.resetFocus=function(e){if(!this._tabster.focusable.isVisible(e))return!1;if(this._tabster.focusable.isFocusable(e,!0,!0,!0))this.focus(e);else{var i=e.getAttribute("tabindex"),r=e.getAttribute("aria-hidden");e.tabIndex=-1,e.setAttribute("aria-hidden","true"),t._lastResetElement=new pe(this._win,e),this.focus(e,!0,!0),this._setOrRemoveAttribute(e,"tabindex",i),this._setOrRemoveAttribute(e,"aria-hidden",r)}return!0},t.prototype._setOrRemoveAttribute=function(e,t,i){null===i?e.removeAttribute(t):e.setAttribute(t,i)},t.prototype._setFocusedElement=function(e,i){var r,o,n={relatedTarget:i};if(e){var s=null===(r=t._lastResetElement)||void 0===r?void 0:r.get();if(t._lastResetElement=void 0,s===e||m(e))return;(this._canOverrideNativeFocus||t._lastFocusedProgrammatically)&&(n.isFocusedProgrammatically=e===(null===(o=t._lastFocusedProgrammatically)||void 0===o?void 0:o.get()),t._lastFocusedProgrammatically=void 0)}var a=this._nextVal={element:e?new pe(this._win,e):void 0,details:n};e&&e!==this._val&&this._validateFocusedElement(e,n),this._nextVal===a&&this.setVal(e,n),this._nextVal=void 0},t.prototype.setVal=function(t,i){e.prototype.setVal.call(this,t,i),t&&(this._lastVal=new pe(this._win,t))},t.replaceFocus=function(e){function i(){return t._lastFocusedProgrammatically=new pe(e,this),o.apply(this,arguments)}var r=e(),o=r.HTMLElement.prototype.focus;o.__tabsterFocus||(r.HTMLElement.prototype.focus=i,i.__tabsterFocus=o)},t.restoreFocus=function(e){var t=e.HTMLElement.prototype,i=t.focus.__tabsterFocus;i&&(t.focus=i)},t.prototype._getFirstInGroupper=function(e,t){return this._tabster.focusable.isFocusable(e)?e:this._tabster.focusable.findFirst(e,!1,!1,t)},t.prototype._findNextGroupper=function(e,t,i,r){if(i===se.Vertical&&(t===_e.Left||t===_e.Right))return null;if(i===se.Horizontal&&(t===_e.Up||t===_e.Down))return null;if(void 0===i||i===se.Both)return t===_e.Left&&!r||t===_e.Right&&r||t===_e.Up?this._tabster.focusable.findPrevGroupper(e):this._tabster.focusable.findNextGroupper(e);for(var o,n,s,a=e.getBoundingClientRect(),u=t===_e.Down||t===_e.Right?"findNextGroupper":"findPrevGroupper",l=this._tabster.focusable[u](e);l;l=this._tabster.focusable[u](l)){var c=l.getBoundingClientRect();if(t===_e.Up){if(c.top<a.top){if(void 0===s)s=c.top;else if(c.top<s)break;if(c.left<a.left){o||(o=l);break}o=l}}else if(t===_e.Down){if(c.top>a.top){if(void 0===s)s=c.top;else if(c.top>s)break;if(c.left>a.left){o||(o=l);break}o=l}}else if(t===_e.Left||t===_e.Right){o=l;break}n=l}return o||n||null},t.prototype._findPageUpGroupper=function(e){for(var t=this._tabster.focusable.findPrevGroupper(e),i=null;t;)i=t,t=h(this._win,t)?this._tabster.focusable.findPrevGroupper(t):null;return i},t.prototype._findPageDownGroupper=function(e){for(var t=this._tabster.focusable.findNextGroupper(e),i=null;t;)i=t,t=h(this._win,t)?this._tabster.focusable.findNextGroupper(t):null;return i},t.prototype._isInput=function(e){return F(e,Xe)},t}(fe),Qe=0,Ze=function(){function e(e,t,i,r,o){this._isAccessible=!0,this._isFocused=!1,this._tabster=t,this._win=i,this.internalId="ml"+ ++Qe,this.userId=r.id,this._element=new pe(i,e),this._basic=r,this._extended=o||{},this._setAccessibilityProps()}return e.prototype.setProps=function(e,t){e?(e.id&&(this.userId=e.id),this._basic=Q(Q({},this._basic),e)):null===e&&(this._basic={id:this.userId}),t?this._extended=Q(Q({},this._extended),t):null===t&&(this._extended={}),this._setAccessibilityProps()},e.prototype.dispose=function(){this._setAccessibleTimer&&(this._win().clearTimeout(this._setAccessibleTimer),this._setAccessibleTimer=void 0),this._isFocused&&this.setFocused(!1),this._remove(),this._extended={}},e.prototype.move=function(e){this._remove(),this._element=new pe(this._win,e),this._setAccessibilityProps(),this._isAccessible=!this._isAccessible,this._isActive=!this._isActive,this.setAccessible(!this._isAccessible),this.setActive(!this._isActive)},e.prototype.setAccessible=function(e){var t=this;if(e!==this._isAccessible){this._isAccessible=e,this._setAccessibleTimer&&(this._win().clearTimeout(this._setAccessibleTimer),this._setAccessibleTimer=void 0);var i=this._element.get();i&&(e?x(this._tabster,i,"aria-hidden"):this._setAccessibleTimer=this._win().setTimeout(function(){t._setAccessibleTimer=void 0,x(t._tabster,i,"aria-hidden","true")},0))}},e.prototype.setActive=function(e){e!==this._isActive&&(this._isActive=e)},e.prototype.isActive=function(){return!!this._isActive},e.prototype.getElement=function(){return this._element.get()},e.prototype.setFocused=function(e){this._isFocused!==e&&(this._isFocused=e,e?this._extended.onFocusIn&&this._extended.onFocusIn():this._extended.onFocusOut&&this._extended.onFocusOut(!1))},e.prototype.onBeforeFocusOut=function(){return!!this._extended.onFocusOut&&this._extended.onFocusOut(!0)},e.prototype.getBasicProps=function(){return this._basic},e.prototype.getExtendedProps=function(){return this._extended},e.prototype._remove=function(){},e.prototype._setAccessibilityProps=function(){},e}(),et=function(){function e(e){var t=this;this._init=function(){t._initTimer=void 0,t._tabster.focusedElement.subscribe(t._onFocus)},this._onFocus=function(e){t._focusOutTimer&&(t._win().clearTimeout(t._focusOutTimer),t._focusOutTimer=void 0);var i;if(e){var r=ge.getTabsterContext(t._tabster,e);r&&(i=r.modalizer)}i?(t._curModalizer&&i!==t._curModalizer&&t._curModalizer.setFocused(!1),t._curModalizer=i,t._curModalizer.setFocused(!0)):t._curModalizer&&(t._focusOutTimer=t._win().setTimeout(function(){t._focusOutTimer=void 0,t._curModalizer&&(t._curModalizer.setFocused(!1),t._curModalizer=void 0)},0))},this._tabster=e,this._win=e.getWindow,this._initTimer=this._win().setTimeout(this._init,0)}return e.prototype.dispose=function(){var e=this._win();this._initTimer&&(e.clearTimeout(this._initTimer),this._initTimer=void 0),this._focusOutTimer&&(e.clearTimeout(this._focusOutTimer),this._focusOutTimer=void 0),this._tabster.focusedElement.unsubscribe(this._onFocus),delete this._curModalizer},e.dispose=function(e){e.dispose()},e.prototype.add=function(e,t,i){var r=k(this._tabster,e);if(!r||!r.modalizer){var o=new Ze(e,this._tabster,this._win,t,i);C(this._tabster,e,{modalizer:o}),U(e,{modalizer:o})}},e.prototype.setProps=function(e,t,i){var r=k(this._tabster,e);r&&r.modalizer&&r.modalizer.setProps(t,i)},e.prototype.remove=function(e){var t=k(this._tabster,e),i=t&&t.modalizer;i&&(C(this._tabster,e,{modalizer:void 0}),U(e,{modalizer:i,removed:!0}),i.dispose())},e.prototype.move=function(e,t){var i=k(this._tabster,e),r=i&&i.modalizer;r&&(r.move(t),C(this._tabster,t,{modalizer:r}),C(this._tabster,e,{modalizer:void 0}),U(e,{modalizer:r,removed:!0}),U(t,{modalizer:r}))},e.prototype.focus=function(e,t,i){var r=ge.getTabsterContext(this._tabster,e);if(r&&r.modalizer){r.root.setCurrentModalizerId(r.modalizer.userId);var o=r.modalizer.getBasicProps(),n=r.modalizer.getElement();if(n){if(void 0===t&&(t=o.isNoFocusFirst),!t&&this._tabster.keyboardNavigation.isNavigatingWithKeyboard()&&this._tabster.focusedElement.focusFirst(n))return!0;if(void 0===i&&(i=o.isNoFocusDefault),!i&&this._tabster.focusedElement.focusDefault(n))return!0;this._tabster.focusedElement.resetFocus(n)}}return!1},e}(),tt=function(e){function t(t){var i=e.call(this)||this;return i._waiting={},i._lastRequestFocusId=0,i._observedById={},i._observedByName={},i._init=function(){i._initTimer=void 0,i._win().document.addEventListener(me,i._onMutation,!0)},i._onMutation=function(e){e.target&&e.details.observed&&i._onObservedElementUpdate(e.details.observed)},i._tabster=t,i._win=t.getWindow,i._initTimer=i._win().setTimeout(i._init,0),i}return r(t,e),t.prototype.dispose=function(){var e=this._win();this._initTimer&&(e.clearTimeout(this._initTimer),this._initTimer=void 0),e.document.removeEventListener(me,this._onMutation,!0);for(var t=0,i=Object.keys(this._waiting);t<i.length;t++){var r=i[t],o=this._waiting[r];o.timer&&e.clearTimeout(o.timer),o.reject&&o.reject(),delete this._waiting[r]}this._observedById={},this._observedByName={}},t.dispose=function(e){e.dispose()},t.prototype.add=function(e,t,i){var r=k(this._tabster,e);r&&r.observed||(C(this._tabster,e,{observed:Q(Q({},t),i)}),this._onObservedElementUpdate(e))},t.prototype.remove=function(e){var t=k(this._tabster,e);t&&t.observed&&(C(this._tabster,e,{observed:void 0}),this._onObservedElementUpdate(e))},t.prototype.move=function(e,t){var i=k(this._tabster,e),r=k(this._tabster,t),o=i&&i.observed;if(o){if(C(this._tabster,e,{observed:void 0}),this._onObservedElementUpdate(e),r&&r.observed)return;C(this._tabster,t,{observed:o}),this._onObservedElementUpdate(t)}},t.prototype.setProps=function(e,t,i){var r=k(this._tabster,e),o=r&&r.observed;o&&(C(this._tabster,e,{observed:Q(Q(Q({},o),t),i)}),this._onObservedElementUpdate(e))},t.prototype.getElement=function(e){var t=this._observedByName[e];if(t)for(var i=0,r=Object.keys(t);i<r.length;i++){var o=r[i],n=t[o].element.get()||null;return n||(delete t[o],delete this._observedById[o]),n}return null},t.prototype.waitElement=function(e,t){var i=this,r=this.getElement(e);if(r)return I(this._win).resolve(r);var o=this._waiting[e];if(o&&o.promise)return o.promise;o=this._waiting[e]={timer:this._win().setTimeout(function(){o.timer=void 0,delete i._waiting[e],o.resolve&&o.resolve(null)},t)};var n=new(I(this._win))(function(e,t){o.resolve=e,o.reject=t});return o.promise=n,n},t.prototype.requestFocus=function(e,t){return o(this,void 0,void 0,function(){var i,r=this;return n(this,function(o){return i=++this._lastRequestFocusId,[2,this.waitElement(e,t).then(function(e){return!(r._lastRequestFocusId!==i||!e)&&r._tabster.focusedElement.focus(e)})]})})},t.prototype._onObservedElementUpdate=function(e){var t=k(this._tabster,e),i=t&&t.observed,r=y(this._win,e),o=T(e.ownerDocument,e),n=this._observedById[r];if(i&&o){if(n||(n=this._observedById[r]={element:new pe(this._win,e)}),i.name&&i.name!==n.triggeredName){if(n.triggeredName){var s=this._observedByName[n.triggeredName];s&&s[r]&&(Object.keys(s).length>1?delete s[r]:delete this._observedByName[n.triggeredName])}n.triggeredName=i.name,(a=this._observedByName[n.triggeredName])||(a=this._observedByName[n.triggeredName]={}),a[r]=n,this._trigger(e,{name:i.name,details:i.details})}}else if(n){if(n.triggeredName){var a=this._observedByName[n.triggeredName];a&&a[r]&&(Object.keys(a).length>1?delete a[r]:delete this._observedByName[n.triggeredName])}delete this._observedById[r]}},t.prototype._trigger=function(e,t){this.trigger(e,t);var i=t.name,r=i&&this._waiting[i];r&&(r.timer&&this._win().clearTimeout(r.timer),delete this._waiting[i],r.resolve&&r.resolve(e))},t}(fe),it={areaClass:"tabster-focus-outline-area",outlineClass:"tabster-focus-outline",outlineColor:"#ff4500",outlineWidth:2,zIndex:2147483647},rt=it;"undefined"!=typeof document&&("onfullscreenchange"in document?(ce="fullscreenchange",de="fullscreenElement"):"onwebkitfullscreenchange"in document?(ce="webkitfullscreenchange",de="webkitFullscreenElement"):"onmozfullscreenchange"in document?(ce="mozfullscreenchange",de="mozFullScreenElement"):"onmsfullscreenchange"in document&&(ce="msfullscreenchange",de="msFullscreenElement"));var ot=function(){function e(e,t,i,r){this.left=e,this.top=t,this.right=i,this.bottom=r}return e.prototype.equalsTo=function(e){return this.left===e.left&&this.top===e.top&&this.right===e.right&&this.bottom===e.bottom},e.prototype.clone=function(){return new e(this.left,this.top,this.right,this.bottom)},e}(),nt=function(){function e(t){var i=this;this._isVisible=!1,this._allOutlineElements=[],this._init=function(){i._initTimer=void 0,i._tabster.keyboardNavigation.subscribe(i._onKeyboardNavigationStateChanged),i._tabster.focusedElement.subscribe(i._onFocus);var e=i._win();e.addEventListener("scroll",i._onScroll,!0),ce&&e.document.addEventListener(ce,i._onFullScreenChanged)},this._onFullScreenChanged=function(e){if(de&&e.target){var t=e.target.body||e.target,r=i._getDOM(t);if(t.ownerDocument&&r){var o=t.ownerDocument[de];o?(o.appendChild(r.container),i._fullScreenElement=o):(t.ownerDocument.body.appendChild(r.container),i._fullScreenElement=void 0)}}},this._onKeyboardNavigationStateChanged=function(){i._onFocus(i._tabster.focusedElement.getFocusedElement())},this._onFocus=function(e){!i._updateElement(e)&&i._isVisible&&i._setVisibility(!1)},this._onScroll=function(t){i._outlinedElement&&e._isParentChild(t.target,i._outlinedElement)&&(i._curPos=void 0,i._setOutlinePosition())},this._tabster=t,this._win=t.getWindow,this._win().setTimeout(this._init,0)}return e.prototype.setup=function(e){rt=Q(Q({},rt),e);var t=this._win();t.__tabsterOutline||(t.__tabsterOutline={}),t.__tabsterOutline.style||(t.__tabsterOutline.style=A(t.document,rt)),e&&e.areaClass?t.document.body.classList.remove(it.areaClass):t.document.body.classList.add(it.areaClass)},e.prototype.setProps=function(e,t){var i=k(this._tabster,e),r=i&&i.outline||{},o={};if(t)for(var n=0,s=Object.keys(t);n<s.length;n++){var a=s[n],u=t[a];u?o[a]=u:void 0===u&&r[a]&&(o[a]=r[a])}o.isIgnored!==r.isIgnored&&C(this._tabster,e,{outline:o})},e.prototype.dispose=function(){var e=this,t=this._win();this._initTimer&&(t.clearTimeout(this._initTimer),this._initTimer=void 0),this._updateTimer&&(t.clearTimeout(this._updateTimer),this._updateTimer=void 0),this._tabster.keyboardNavigation.unsubscribe(this._onKeyboardNavigationStateChanged),this._tabster.focusedElement.unsubscribe(this._onFocus),t.removeEventListener("scroll",this._onScroll,!0),ce&&t.document.removeEventListener(ce,this._onFullScreenChanged),this._allOutlineElements.forEach(function(t){return e._removeDOM(t.container)}),this._allOutlineElements=[],delete this._outlinedElement,delete this._curPos,delete this._curOutlineElements,delete this._fullScreenElement},e.dispose=function(e){e.dispose()},e.prototype._shouldShowCustomOutline=function(e){var t=k(this._tabster,e);if(t&&t.outline&&t.outline.isIgnored)return!1;for(var i=e;i;i=i.parentElement)if(i.classList&&i.classList.contains(rt.areaClass))return!0;return!1},e.prototype._updateElement=function(e){if(this._outlinedElement=void 0,this._updateTimer&&(this._win().clearTimeout(this._updateTimer),this._updateTimer=void 0),this._curPos=void 0,!this._tabster.keyboardNavigation.isNavigatingWithKeyboard())return!1;if(e){if("INPUT"===e.tagName){if(!(e.type in{button:!0,checkbox:!0,file:!0,image:!0,radio:!0,range:!0,reset:!0,submit:!0}))return!1}else if("TEXTAREA"===e.tagName||"true"===e.contentEditable||"IFRAME"===e.tagName)return!1;return!!this._shouldShowCustomOutline(e)&&(this._tabster.keyboardNavigation.isNavigatingWithKeyboard()&&(this._outlinedElement=e,this._updateOutline()),!0)}return!1},e.prototype._updateOutline=function(){var e=this;this._setOutlinePosition(),this._updateTimer&&(this._win().clearTimeout(this._updateTimer),this._updateTimer=void 0),this._outlinedElement&&(this._updateTimer=this._win().setTimeout(function(){e._updateTimer=void 0,e._updateOutline()},30))},e.prototype._setVisibility=function(e){this._isVisible=e,this._curOutlineElements&&(e?this._curOutlineElements.container.classList.add(rt.outlineClass+"_visible"):(this._curOutlineElements.container.classList.remove(rt.outlineClass+"_visible"),this._curPos=void 0))},e.prototype._setOutlinePosition=function(){if(this._outlinedElement){var e=d(this._win,this._outlinedElement),t=new ot(e.left,e.top,e.right,e.bottom);if(!this._curPos||!t.equalsTo(this._curPos)){var i=this._getDOM(this._outlinedElement),r=this._outlinedElement.ownerDocument&&this._outlinedElement.ownerDocument.defaultView;if(i&&r){this._curOutlineElements!==i&&(this._setVisibility(!1),this._curOutlineElements=i),this._curPos=t;var o=t.clone(),n=!1,s=!1,a=i.container,u=a&&a.ownerDocument&&a.ownerDocument.scrollingElement;if(u){for(var l=this._outlinedElement.parentElement;l&&l!==this._fullScreenElement;l=l.parentElement){e=d(this._win,l);var c=l.ownerDocument&&l.ownerDocument.defaultView;if(!c)return;var h=c.getComputedStyle(l),p=h.position;"absolute"===p?n=!0:"fixed"!==p&&"sticky"!==p||(s=!0),"visible"!==h.overflow&&((n||s)&&"hidden"!==h.overflow||(e.left>o.left&&(o.left=e.left),e.top>o.top&&(o.top=e.top),e.right<o.right&&(o.right=e.right),e.bottom<o.bottom&&(o.bottom=e.bottom)))}var _=d(this._win,u),f=_.left+_.right,v=_.top+_.bottom,m=rt.outlineWidth;o.left=o.left>m?o.left-m:0,o.top=o.top>m?o.top-m:0,o.right=o.right<f-m?o.right+m:f,o.bottom=o.bottom<v-m?o.bottom+m:v;var b=o.right-o.left,g=o.bottom-o.top;if(b>2*m&&g>2*m){var y=i.left,w=i.top,E=i.right,T=i.bottom,F=this._fullScreenElement||s?0:r.pageXOffset,I=this._fullScreenElement||s?0:r.pageYOffset;a.style.position=s?"fixed":"absolute",a.style.background=rt.outlineColor,y.style.width=E.style.width=w.style.height=T.style.height=rt.outlineWidth+"px",y.style.left=w.style.left=T.style.left=o.left+F+"px",E.style.left=o.left+F+b-m+"px",y.style.top=E.style.top=w.style.top=o.top+I+"px",T.style.top=o.top+I+g-m+"px",y.style.height=E.style.height=g+"px",w.style.width=T.style.width=b+"px",this._setVisibility(!0)}else this._setVisibility(!1)}}}}},e.prototype._getDOM=function(e){var t=e.ownerDocument,i=t&&t.defaultView;if(t&&i&&i.__tabsterOutline){if(i.__tabsterOutline.style||(i.__tabsterOutline.style=A(t,rt)),!i.__tabsterOutline.elements){var r={container:t.createElement("div"),left:t.createElement("div"),top:t.createElement("div"),right:t.createElement("div"),bottom:t.createElement("div")};r.container.className=rt.outlineClass,r.left.className=rt.outlineClass+"__left",r.top.className=rt.outlineClass+"__top",r.right.className=rt.outlineClass+"__right",r.bottom.className=rt.outlineClass+"__bottom",r.container.appendChild(r.left),r.container.appendChild(r.top),r.container.appendChild(r.right),r.container.appendChild(r.bottom),t.body.appendChild(r.container),i.__tabsterOutline.elements=r,this._allOutlineElements.push(r)}return i.__tabsterOutline.elements}},e.prototype._removeDOM=function(e){var t=e.ownerDocument&&e.ownerDocument.defaultView,i=t&&t.__tabsterOutline;if(i){i.style&&i.style.parentNode&&(i.style.parentNode.removeChild(i.style),delete i.style);var r=i&&i.elements;r&&(r.container.parentNode&&r.container.parentNode.removeChild(r.container),delete i.elements)}},e._isParentChild=function(e,t){return t===e||!!(e.compareDocumentPosition(t)&document.DOCUMENT_POSITION_CONTAINED_BY)},e}(),st=function(){function e(e,t){var i=this;this._forgetMemorizedElements=[],this.getWindow=function(){if(!i._win)throw new Error("Using disposed Tabster.");return i._win},this._storage={},this._win=e;var r=this.getWindow;e&&e.document&&(this._unobserve=P(e.document,this,N)),this.keyboardNavigation=new ve(this,r),this.focusedElement=new $e(this,r),this.focusable=new Ye(this,r),this.root=new ge(this,function(){Ye.forgetFocusedGrouppers(i.focusable)},null===t||void 0===t?void 0:t.autoRoot),u(r)}return e.prototype.dispose=function(){var e,t;this._unobserve&&(this._unobserve(),delete this._unobserve),this._forgetMemorizedElements=[],this._win&&this._forgetMemorizedTimer&&(this._win.clearTimeout(this._forgetMemorizedTimer),delete this._forgetMemorizedTimer),this.outlineDispose&&(this.outlineDispose(),delete this.outline,delete this.outlineDispose),this.crossOriginDispose&&(this.crossOriginDispose(),delete this.crossOrigin,delete this.crossOriginDispose),this.deloserDispose&&(this.deloserDispose(),delete this.deloser,delete this.deloserDispose),this.modalizerDispose&&(this.modalizerDispose(),delete this.modalizer,delete this.modalizerDispose),this.observedElementDispose&&(this.observedElementDispose(),delete this.observedElement,delete this.observedElementDispose),ve.dispose(this.keyboardNavigation),Ye.dispose(this.focusable),$e.dispose(this.focusedElement),ge.dispose(this.root),l(this.getWindow),E(this.getWindow),this._storage={},(null===(e=this._win)||void 0===e?void 0:e.__tabsterInstance)&&(null===(t=this._win)||void 0===t||delete t.__tabsterInstance),delete this._win},e.dispose=function(e){e.dispose()},e.prototype.storageEntry=function(e,t){var i=this._storage[e];return i?!1===t&&0===Object.keys(i).length&&delete this._storage[e]:!0===t&&(i=this._storage[e]={}),i},e.forceCleanup=function(e){e._win&&(e._forgetMemorizedElements.push(e._win.document.body),e._forgetMemorizedTimer||(e._forgetMemorizedTimer=e._win.setTimeout(function(){delete e._forgetMemorizedTimer;for(var t=e._forgetMemorizedElements.shift();t;t=e._forgetMemorizedElements.shift())E(e.getWindow,t),$e.forgetMemorized(e.focusedElement,t)},0),a(e.getWindow,!0)))},e}()}},[2782]);